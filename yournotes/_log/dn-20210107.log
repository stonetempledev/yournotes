2021-01-07 09:54:13,720 [31] INFO dn_lib.tools.log - reload core
2021-01-07 09:54:13,755 [31] INFO dn_lib.tools.log - reload config docs
2021-01-07 09:54:13,758 [31] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:54:13,759 [31] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:54:13,760 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:54:13,768 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:54:13,770 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:54:13,780 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:54:13,782 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:54:13,790 [31] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:54:13,792 [31] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:54:13,794 [31] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:54:13,795 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:54:13,796 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:54:13,797 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:54:13,798 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:54:13,798 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:54:13,799 [31] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:54:13,800 [31] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:54:13,807 [31] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:54:13,809 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:54:13,810 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:54:13,811 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:54:13,812 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:54:13,813 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:54:13,814 [31] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:54:13,816 [31] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 09:54:13,860 [28] INFO dn_lib.tools.log - reload config docs
2021-01-07 09:54:13,861 [28] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:54:13,862 [28] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:54:13,863 [28] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:54:13,864 [28] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:54:13,864 [28] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:54:13,865 [28] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:54:13,866 [28] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:54:13,867 [28] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:54:13,867 [28] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:54:13,868 [28] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:54:13,869 [28] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:54:13,869 [28] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:54:13,870 [28] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:54:13,871 [28] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:54:13,871 [28] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:54:13,872 [28] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:54:13,872 [28] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:54:13,873 [28] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:54:13,874 [28] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:54:13,874 [28] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:54:13,875 [28] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:54:13,875 [28] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:54:13,876 [28] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:54:13,876 [28] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:54:13,877 [28] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 09:54:13,911 [29] INFO dn_lib.tools.log - reload config docs
2021-01-07 09:54:13,912 [29] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:54:13,913 [29] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:54:13,914 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:54:13,914 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:54:13,915 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:54:13,916 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:54:13,917 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:54:13,918 [29] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:54:13,919 [29] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:54:13,919 [29] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:54:13,920 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:54:13,921 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:54:13,921 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:54:13,922 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:54:13,922 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:54:13,923 [29] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:54:13,924 [29] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:54:13,924 [29] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:54:13,925 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:54:13,926 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:54:13,927 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:54:13,927 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:54:13,928 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:54:13,928 [29] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:54:13,929 [29] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 09:54:13,950 [29] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 09:54:13,953 [29] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 09:54:13,956 [29] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 09:54:13,957 [29] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 09:54:13,958 [29] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 09:54:13,970 [29] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 09:54:13,980 [29] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1  and t3.stato = 'in_corso' or t3.diff_days = 1
2021-01-07 09:54:14,002 [29] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 09:54:14,010 [29] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 09:54:14,059 [29] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 09:54:14,062 [29] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 09:54:14,065 [29] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 09:57:20,130 [29] INFO dn_lib.tools.log - reload config docs
2021-01-07 09:57:20,131 [29] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:57:20,132 [29] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:57:20,132 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:57:20,133 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:57:20,134 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:57:20,135 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:57:20,136 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:57:20,136 [29] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:57:20,137 [29] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:57:20,138 [29] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:57:20,138 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:57:20,139 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:57:20,140 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:57:20,140 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:57:20,140 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:57:20,141 [29] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:57:20,141 [29] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:57:20,142 [29] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:57:20,143 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:57:20,143 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:57:20,144 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:57:20,144 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:57:20,145 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:57:20,145 [29] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:57:20,146 [29] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 09:57:20,166 [29] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 47
2021-01-07 09:57:20,168 [29] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path
      from vw_task_allegati a
      where a.task_id = 47
2021-01-07 09:57:26,476 [32] INFO dn_lib.tools.log - reload config docs
2021-01-07 09:57:26,478 [32] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:57:26,479 [32] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:57:26,479 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:57:26,480 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:57:26,480 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:57:26,481 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:57:26,481 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:57:26,482 [32] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:57:26,482 [32] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:57:26,483 [32] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:57:26,483 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:57:26,484 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:57:26,484 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:57:26,485 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:57:26,485 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:57:26,485 [32] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:57:26,486 [32] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:57:26,486 [32] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:57:26,487 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:57:26,487 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:57:26,487 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:57:26,488 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:57:26,488 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:57:26,489 [32] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:57:26,490 [32] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 09:57:42,988 [20] INFO dn_lib.tools.log - reload core
2021-01-07 09:57:43,015 [20] INFO dn_lib.tools.log - reload config docs
2021-01-07 09:57:43,016 [20] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:57:43,017 [20] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:57:43,018 [20] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:57:43,028 [20] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:57:43,030 [20] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:57:43,041 [20] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:57:43,043 [20] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:57:43,045 [20] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:57:43,046 [20] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:57:43,047 [20] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:57:43,047 [20] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:57:43,048 [20] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:57:43,049 [20] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:57:43,049 [20] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:57:43,050 [20] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:57:43,050 [20] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:57:43,051 [20] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:57:43,056 [20] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:57:43,058 [20] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:57:43,059 [20] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:57:43,060 [20] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:57:43,062 [20] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:57:43,062 [20] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:57:43,063 [20] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:57:43,063 [20] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 09:57:43,092 [32] INFO dn_lib.tools.log - reload config docs
2021-01-07 09:57:43,093 [32] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:57:43,094 [32] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:57:43,095 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:57:43,095 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:57:43,096 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:57:43,097 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:57:43,097 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:57:43,098 [32] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:57:43,099 [32] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:57:43,099 [32] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:57:43,100 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:57:43,101 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:57:43,101 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:57:43,102 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:57:43,102 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:57:43,103 [32] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:57:43,103 [32] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:57:43,104 [32] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:57:43,104 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:57:43,105 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:57:43,105 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:57:43,106 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:57:43,107 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:57:43,107 [32] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:57:43,108 [32] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 09:57:43,142 [29] INFO dn_lib.tools.log - reload config docs
2021-01-07 09:57:43,144 [29] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:57:43,144 [29] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:57:43,145 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:57:43,146 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:57:43,147 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:57:43,147 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:57:43,148 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:57:43,149 [29] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:57:43,149 [29] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:57:43,150 [29] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:57:43,150 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:57:43,151 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:57:43,151 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:57:43,152 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:57:43,153 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:57:43,154 [29] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:57:43,155 [29] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:57:43,155 [29] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:57:43,156 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:57:43,157 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:57:43,158 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:57:43,158 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:57:43,159 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:57:43,159 [29] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:57:43,162 [29] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 09:57:43,183 [29] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 09:57:43,187 [29] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 09:57:43,189 [29] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 09:57:43,191 [29] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 09:57:43,196 [29] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 09:57:43,205 [29] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 09:57:43,215 [29] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1  and t3.stato = 'in_corso' or t3.diff_days = 1
2021-01-07 09:57:43,242 [29] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 09:57:43,255 [29] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 09:57:43,337 [29] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 09:57:43,341 [29] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 09:57:43,345 [29] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 09:57:49,460 [31] INFO dn_lib.tools.log - reload config docs
2021-01-07 09:57:49,461 [31] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:57:49,463 [31] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:57:49,464 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:57:49,465 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:57:49,465 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:57:49,466 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:57:49,466 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:57:49,466 [31] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:57:49,467 [31] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:57:49,467 [31] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:57:49,468 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:57:49,468 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:57:49,468 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:57:49,469 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:57:49,470 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:57:49,470 [31] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:57:49,471 [31] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:57:49,471 [31] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:57:49,473 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:57:49,474 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:57:49,474 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:57:49,475 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:57:49,475 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:57:49,476 [31] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:57:49,477 [31] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 09:57:49,499 [23] INFO dn_lib.tools.log - reload config docs
2021-01-07 09:57:49,499 [23] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:57:49,500 [23] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:57:49,500 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:57:49,501 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:57:49,501 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:57:49,502 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:57:49,502 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:57:49,503 [23] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:57:49,503 [23] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:57:49,503 [23] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:57:49,504 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:57:49,504 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:57:49,504 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:57:49,505 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:57:49,506 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:57:49,506 [23] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:57:49,506 [23] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:57:49,507 [23] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:57:49,507 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:57:49,508 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:57:49,508 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:57:49,508 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:57:49,509 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:57:49,509 [23] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:57:49,510 [23] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 09:57:49,521 [22] INFO dn_lib.tools.log - reload config docs
2021-01-07 09:57:49,522 [22] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:57:49,522 [22] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:57:49,523 [22] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:57:49,524 [22] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:57:49,525 [22] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:57:49,525 [22] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:57:49,526 [22] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:57:49,526 [22] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:57:49,527 [22] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:57:49,527 [22] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:57:49,528 [22] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:57:49,528 [22] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:57:49,528 [22] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:57:49,529 [22] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:57:49,529 [22] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:57:49,529 [22] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:57:49,530 [22] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:57:49,530 [22] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:57:49,530 [22] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:57:49,531 [22] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:57:49,531 [22] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:57:49,532 [22] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:57:49,532 [22] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:57:49,532 [22] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:57:49,533 [22] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 09:57:49,542 [22] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'desi';
declare @sid varchar(100); set @sid = 'o2ug5aavcu50g3oaq1xi5w1e';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id
   from (select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 09:57:49,577 [22] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 09:57:49,579 [22] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 09:57:49,580 [22] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 09:57:49,581 [22] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 09:57:49,582 [22] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 09:57:49,597 [22] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 09:57:49,617 [22] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 5 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 09:57:49,632 [22] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 09:57:49,635 [22] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 09:57:49,636 [22] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 09:57:49,637 [22] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 09:57:49,638 [22] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 09:58:05,271 [31] INFO dn_lib.tools.log - reload config docs
2021-01-07 09:58:05,272 [31] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:58:05,273 [31] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:58:05,274 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:58:05,275 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:58:05,277 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:58:05,278 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:58:05,278 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:58:05,279 [31] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:58:05,280 [31] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:58:05,281 [31] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:58:05,281 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:58:05,282 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:58:05,282 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:58:05,283 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:58:05,283 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:58:05,284 [31] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:58:05,284 [31] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:58:05,285 [31] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:58:05,286 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:58:05,287 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:58:05,288 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:58:05,289 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:58:05,290 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:58:05,290 [31] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:58:05,291 [31] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 09:58:05,304 [49] INFO dn_lib.tools.log - reload config docs
2021-01-07 09:58:05,305 [49] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:58:05,306 [49] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:58:05,307 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:58:05,307 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:58:05,308 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:58:05,309 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:58:05,309 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:58:05,310 [49] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:58:05,310 [49] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:58:05,311 [49] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:58:05,311 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:58:05,312 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:58:05,312 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:58:05,312 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:58:05,313 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:58:05,313 [49] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:58:05,313 [49] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:58:05,314 [49] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:58:05,314 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:58:05,315 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:58:05,315 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:58:05,315 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:58:05,316 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:58:05,316 [49] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:58:05,317 [49] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 09:58:05,327 [49] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'desi';
declare @sid varchar(100); set @sid = 'o2ug5aavcu50g3oaq1xi5w1e';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id
   from (select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 09:58:05,328 [49] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 09:58:05,329 [49] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 09:58:05,330 [49] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 09:58:05,330 [49] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 09:58:05,331 [49] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(114, null) ft
      join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 09:58:05,345 [49] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(114, null) ft 
        join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 09:58:05,368 [49] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 5 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(114, null) ft 
	    where  ft.tp <> 'synch_folder' and  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 09:58:05,386 [49] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 09:58:05,387 [49] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 09:58:05,388 [49] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 09:58:05,389 [49] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 09:58:05,390 [49] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 09:59:36,593 [31] INFO dn_lib.tools.log - reload config docs
2021-01-07 09:59:36,594 [31] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:59:36,595 [31] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:59:36,595 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:59:36,596 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:59:36,597 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:59:36,598 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:59:36,599 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:59:36,599 [31] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:59:36,600 [31] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:59:36,601 [31] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:59:36,601 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:59:36,602 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:59:36,602 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:59:36,603 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:59:36,604 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:59:36,604 [31] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:59:36,605 [31] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:59:36,605 [31] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:59:36,606 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:59:36,607 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:59:36,607 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:59:36,607 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:59:36,608 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:59:36,608 [31] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:59:36,617 [31] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 09:59:36,638 [31] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'desi';
declare @sid varchar(100); set @sid = 'o2ug5aavcu50g3oaq1xi5w1e';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id
   from (select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 09:59:36,659 [31] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 09:59:36,661 [31] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 09:59:36,663 [31] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 09:59:36,664 [31] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 09:59:36,665 [31] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(114, null) ft
      join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 09:59:36,679 [31] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(114, null) ft 
        join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 09:59:36,700 [31] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 5 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(114, null) ft 
	    where  ft.tp <> 'synch_folder' and  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 09:59:36,720 [31] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 09:59:36,725 [31] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 09:59:36,727 [31] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 09:59:36,729 [31] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 09:59:36,731 [31] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 09:59:59,902 [40] INFO dn_lib.tools.log - reload config docs
2021-01-07 09:59:59,903 [40] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:59:59,904 [40] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:59:59,905 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:59:59,905 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:59:59,906 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:59:59,906 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:59:59,907 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:59:59,907 [40] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:59:59,908 [40] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:59:59,908 [40] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:59:59,909 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:59:59,909 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:59:59,910 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:59:59,910 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:59:59,911 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:59:59,911 [40] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:59:59,912 [40] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:59:59,912 [40] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:59:59,913 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:59:59,913 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:59:59,913 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:59:59,914 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:59:59,914 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:59:59,915 [40] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:59:59,915 [40] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 09:59:59,937 [20] INFO dn_lib.tools.log - reload config docs
2021-01-07 09:59:59,938 [20] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:59:59,938 [20] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:59:59,940 [20] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:59:59,940 [20] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:59:59,941 [20] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:59:59,942 [20] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:59:59,943 [20] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:59:59,944 [20] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:59:59,944 [20] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:59:59,945 [20] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:59:59,945 [20] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:59:59,946 [20] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:59:59,947 [20] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:59:59,948 [20] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:59:59,948 [20] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:59:59,949 [20] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:59:59,949 [20] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 09:59:59,949 [20] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 09:59:59,950 [20] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 09:59:59,951 [20] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 09:59:59,952 [20] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 09:59:59,952 [20] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 09:59:59,953 [20] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 09:59:59,954 [20] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 09:59:59,954 [20] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 09:59:59,964 [20] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'desi';
declare @sid varchar(100); set @sid = 'o2ug5aavcu50g3oaq1xi5w1e';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id
   from (select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 09:59:59,965 [20] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 09:59:59,966 [20] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 09:59:59,967 [20] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 09:59:59,968 [20] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 09:59:59,970 [20] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, 1) ft
      join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 09:59:59,982 [20] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
        join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 09:59:59,999 [20] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 5 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 10:00:00,020 [20] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:00:00,027 [20] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:00:00,028 [20] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:00:00,030 [20] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:00:00,030 [20] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:00:11,703 [32] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:00:11,704 [32] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:11,705 [32] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:11,707 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:11,708 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:11,708 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:11,709 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:11,710 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:11,710 [32] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:11,711 [32] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:11,712 [32] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:11,713 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:11,713 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:11,714 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:11,714 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:11,715 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:11,716 [32] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:11,717 [32] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:11,717 [32] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:11,718 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:11,718 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:11,719 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:11,719 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:11,720 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:11,720 [32] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:11,721 [32] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:00:11,740 [49] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:00:11,741 [49] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:11,742 [49] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:11,742 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:11,743 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:11,743 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:11,744 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:11,744 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:11,745 [49] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:11,745 [49] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:11,745 [49] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:11,746 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:11,746 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:11,747 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:11,747 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:11,747 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:11,748 [49] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:11,748 [49] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:11,749 [49] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:11,749 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:11,750 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:11,750 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:11,750 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:11,751 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:11,751 [49] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:11,752 [49] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:00:11,761 [49] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'desi';
declare @sid varchar(100); set @sid = 'o2ug5aavcu50g3oaq1xi5w1e';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id
   from (select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 10:00:11,762 [49] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:00:11,763 [49] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:00:11,764 [49] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:00:11,765 [49] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:00:11,766 [49] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(114, null) ft
      join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:00:11,767 [49] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(114, null) ft 
        join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:00:11,769 [49] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 5 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(114, null) ft 
	    where  ft.tp <> 'synch_folder' and  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 10:00:11,770 [49] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:00:11,771 [49] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:00:11,771 [49] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:00:11,772 [49] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:00:11,773 [49] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:00:14,505 [20] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:00:14,506 [20] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:14,507 [20] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:14,508 [20] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:14,509 [20] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:14,510 [20] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:14,510 [20] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:14,511 [20] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:14,512 [20] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:14,512 [20] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:14,513 [20] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:14,513 [20] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:14,514 [20] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:14,514 [20] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:14,516 [20] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:14,517 [20] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:14,518 [20] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:14,519 [20] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:14,519 [20] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:14,520 [20] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:14,520 [20] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:14,521 [20] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:14,521 [20] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:14,522 [20] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:14,522 [20] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:14,523 [20] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:00:14,535 [31] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:00:14,536 [31] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:14,537 [31] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:14,537 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:14,538 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:14,539 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:14,539 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:14,540 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:14,540 [31] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:14,541 [31] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:14,542 [31] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:14,542 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:14,543 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:14,543 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:14,544 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:14,544 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:14,545 [31] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:14,545 [31] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:14,545 [31] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:14,546 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:14,546 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:14,547 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:14,547 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:14,547 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:14,548 [31] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:14,550 [31] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:00:14,559 [31] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'desi';
declare @sid varchar(100); set @sid = 'o2ug5aavcu50g3oaq1xi5w1e';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id
   from (select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 10:00:14,560 [31] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:00:14,562 [31] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:00:14,563 [31] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:00:14,564 [31] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:00:14,565 [31] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, 1) ft
      join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:00:14,568 [31] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
        join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:00:14,569 [31] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 5 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 10:00:14,571 [31] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:00:14,574 [31] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:00:14,575 [31] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:00:14,576 [31] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:00:14,577 [31] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:00:21,767 [20] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:00:21,768 [20] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:21,769 [20] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:21,770 [20] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:21,771 [20] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:21,772 [20] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:21,772 [20] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:21,773 [20] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:21,774 [20] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:21,774 [20] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:21,774 [20] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:21,775 [20] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:21,775 [20] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:21,776 [20] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:21,776 [20] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:21,777 [20] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:21,777 [20] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:21,777 [20] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:21,778 [20] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:21,779 [20] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:21,779 [20] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:21,779 [20] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:21,780 [20] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:21,781 [20] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:21,782 [20] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:21,783 [20] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:00:21,797 [49] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:00:21,799 [49] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:21,799 [49] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:21,800 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:21,800 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:21,801 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:21,801 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:21,802 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:21,803 [49] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:21,803 [49] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:21,803 [49] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:21,804 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:21,804 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:21,805 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:21,805 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:21,805 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:21,806 [49] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:21,806 [49] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:21,807 [49] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:21,807 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:21,808 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:21,808 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:21,809 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:21,809 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:21,810 [49] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:21,810 [49] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:00:21,824 [23] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:00:21,825 [23] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:21,825 [23] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:21,826 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:21,827 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:21,827 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:21,828 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:21,828 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:21,829 [23] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:21,829 [23] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:21,830 [23] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:21,830 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:21,831 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:21,832 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:21,832 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:21,833 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:21,833 [23] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:21,834 [23] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:21,834 [23] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:21,834 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:21,835 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:21,835 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:21,836 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:21,836 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:21,836 [23] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:21,837 [23] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:00:21,846 [23] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'corno';
declare @sid varchar(100); set @sid = 'o2ug5aavcu50g3oaq1xi5w1e';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id
   from (select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 10:00:21,870 [23] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:00:21,872 [23] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:00:21,874 [23] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:00:21,875 [23] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:00:21,876 [23] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:00:21,891 [23] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:00:21,909 [23] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 5 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 10:00:21,928 [23] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:00:21,931 [23] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:00:21,934 [23] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:00:21,936 [23] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:00:21,938 [23] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:00:27,292 [20] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:00:27,293 [20] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:27,294 [20] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:27,296 [20] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:27,297 [20] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:27,298 [20] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:27,299 [20] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:27,300 [20] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:27,301 [20] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:27,301 [20] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:27,302 [20] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:27,303 [20] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:27,303 [20] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:27,304 [20] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:27,304 [20] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:27,305 [20] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:27,305 [20] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:27,306 [20] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:27,306 [20] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:27,307 [20] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:27,307 [20] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:27,308 [20] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:27,308 [20] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:27,309 [20] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:27,309 [20] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:27,309 [20] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:00:27,323 [23] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:00:27,324 [23] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:27,324 [23] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:27,325 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:27,326 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:27,326 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:27,327 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:27,328 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:27,328 [23] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:27,329 [23] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:27,329 [23] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:27,330 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:27,330 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:27,331 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:27,332 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:27,333 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:27,333 [23] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:27,334 [23] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:27,334 [23] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:27,335 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:27,335 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:27,336 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:27,336 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:27,337 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:27,337 [23] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:27,338 [23] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:00:27,349 [32] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:00:27,350 [32] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:27,351 [32] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:27,351 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:27,353 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:27,353 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:27,354 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:27,354 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:27,355 [32] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:27,355 [32] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:27,356 [32] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:27,356 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:27,357 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:27,357 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:27,357 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:27,358 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:27,358 [32] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:27,358 [32] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:27,359 [32] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:27,359 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:27,360 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:27,360 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:27,361 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:27,361 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:27,361 [32] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:27,362 [32] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:00:27,371 [32] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'desi';
declare @sid varchar(100); set @sid = 'o2ug5aavcu50g3oaq1xi5w1e';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id
   from (select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 10:00:27,404 [32] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:00:27,406 [32] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:00:27,407 [32] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:00:27,408 [32] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:00:27,409 [32] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:00:27,425 [32] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:00:27,443 [32] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 5 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 10:00:27,458 [32] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:00:27,462 [32] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:00:27,464 [32] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:00:27,467 [32] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:00:27,468 [32] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:00:42,805 [49] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:00:42,809 [49] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:42,810 [49] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:42,811 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:42,812 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:42,813 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:42,814 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:42,815 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:42,815 [49] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:42,816 [49] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:42,817 [49] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:42,817 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:42,818 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:42,818 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:42,819 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:42,819 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:42,819 [49] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:42,820 [49] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:42,820 [49] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:42,821 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:42,821 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:42,822 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:42,822 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:42,823 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:42,823 [49] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:42,824 [49] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:00:42,837 [48] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:00:42,838 [48] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:42,838 [48] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:42,839 [48] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:42,840 [48] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:42,840 [48] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:42,841 [48] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:42,841 [48] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:42,842 [48] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:42,842 [48] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:42,843 [48] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:42,843 [48] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:42,844 [48] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:42,845 [48] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:42,846 [48] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:42,846 [48] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:42,847 [48] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:42,847 [48] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:00:42,848 [48] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:00:42,848 [48] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:00:42,848 [48] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:00:42,849 [48] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:00:42,849 [48] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:00:42,850 [48] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:00:42,850 [48] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:00:42,850 [48] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:00:42,859 [48] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'desi';
declare @sid varchar(100); set @sid = 'o2ug5aavcu50g3oaq1xi5w1e';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id
   from (select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 10:00:42,861 [48] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:00:42,863 [48] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:00:42,864 [48] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:00:42,864 [48] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:00:42,865 [48] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, 1) ft
      join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:00:42,877 [48] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
        join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:00:42,895 [48] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 5 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 10:00:42,913 [48] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:00:42,915 [48] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:00:42,916 [48] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:00:42,917 [48] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:00:42,918 [48] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:16:01,435 [45] INFO dn_lib.tools.log - reload core
2021-01-07 10:16:01,465 [45] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:16:01,466 [45] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:16:01,467 [45] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:16:01,468 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:16:01,469 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:16:01,477 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:16:01,487 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:16:01,488 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:16:01,496 [45] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:16:01,497 [45] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:16:01,498 [45] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:16:01,499 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:16:01,500 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:16:01,501 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:16:01,501 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:16:01,503 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:16:01,504 [45] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:16:01,505 [45] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:16:01,511 [45] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:16:01,512 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:16:01,514 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:16:01,515 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:16:01,516 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:16:01,516 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:16:01,517 [45] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:16:01,522 [45] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:16:01,554 [45] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'desi';
declare @sid varchar(100); set @sid = 'o2ug5aavcu50g3oaq1xi5w1e';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id
   from (select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 10:16:01,575 [45] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:16:01,578 [45] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:16:01,581 [45] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:16:01,582 [45] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:16:01,586 [45] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, 1) ft
      join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:16:01,601 [45] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
        join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:16:01,621 [45] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 5 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 10:16:01,653 [45] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:16:01,665 [45] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:16:01,747 [45] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:16:01,749 [45] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:16:01,751 [45] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:16:32,458 [17] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:16:32,460 [17] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:16:32,461 [17] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:16:32,462 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:16:32,463 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:16:32,464 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:16:32,465 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:16:32,466 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:16:32,467 [17] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:16:32,468 [17] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:16:32,469 [17] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:16:32,470 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:16:32,471 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:16:32,471 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:16:32,472 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:16:32,473 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:16:32,473 [17] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:16:32,475 [17] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:16:32,476 [17] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:16:32,476 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:16:32,477 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:16:32,477 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:16:32,478 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:16:32,478 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:16:32,479 [17] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:16:32,480 [17] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:16:32,519 [17] DEBUG dn_lib.tools.log - SQL: select local_path, synch_folder_id, title as name 
        from synch_folders where synch_folder_id = 1
2021-01-07 10:16:32,521 [17] DEBUG dn_lib.tools.log - SQL: select free_txt, stato, priorita, tipo, stima, (case when [default] = 1 then '1' else '0' end) as [default]
        from dn_task_free_labels 
2021-01-07 10:16:32,536 [17] DEBUG dn_lib.tools.log - SQL: insert into dn_folders (synch_folder_id, parent_id, folder_name, dt_ins, readed, dt_upd)
    values (1, null, '210107.maremma.incorso.task', convert(datetime, convert(varchar, getdate(), 120), 120), 1, convert(datetime, convert(varchar, getdate(), 120), 120));select SCOPE_IDENTITY();
2021-01-07 10:16:32,538 [17] DEBUG dn_lib.tools.log - SQL: insert into dn_tasks (synch_folder_id, folder_id, title, [user], stato, dt_upd, readed, priorita, tipo, stima, dt_ins)
 select synch_folder_id, folder_id, 'maremma', NULL, 'in_corso', dt_upd, 1, NULL, NULL, NULL, dt_ins
  from dn_folders where folder_id = 121;select SCOPE_IDENTITY();
2021-01-07 10:16:32,541 [17] DEBUG dn_lib.tools.log - SQL: insert into dn_search_tasks (search_id, task_id, synch_folder_id, folder_id)
 select 5 as search_id, task_id, synch_folder_id, folder_id
 from dn_tasks where task_id = 50

insert into dn_search_folders (search_id, synch_folder_id, folder_id)
 select 5 as search_id, f.synch_folder_id, f.folder_id
 from dn_folders f
 join dn_tasks t on t.folder_id = f.folder_id
 where t.task_id = 50
2021-01-07 10:16:32,603 [50] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:16:32,604 [50] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:16:32,604 [50] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:16:32,605 [50] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:16:32,606 [50] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:16:32,607 [50] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:16:32,608 [50] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:16:32,609 [50] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:16:32,609 [50] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:16:32,609 [50] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:16:32,610 [50] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:16:32,610 [50] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:16:32,610 [50] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:16:32,611 [50] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:16:32,611 [50] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:16:32,612 [50] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:16:32,612 [50] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:16:32,613 [50] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:16:32,613 [50] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:16:32,613 [50] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:16:32,614 [50] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:16:32,614 [50] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:16:32,614 [50] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:16:32,615 [50] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:16:32,615 [50] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:16:32,616 [50] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:16:32,625 [50] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'desi';
declare @sid varchar(100); set @sid = 'o2ug5aavcu50g3oaq1xi5w1e';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id
   from (select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 10:16:32,626 [50] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:16:32,628 [50] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:16:32,628 [50] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:16:32,629 [50] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:16:32,630 [50] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, 1) ft
      join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:16:32,631 [50] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
        join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:16:32,633 [50] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 5 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 10:16:32,634 [50] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:16:32,638 [50] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:16:32,639 [50] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:16:32,640 [50] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:16:32,641 [50] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:26:52,413 [54] INFO dn_lib.tools.log - reload core
2021-01-07 10:26:52,443 [54] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:26:52,445 [54] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:26:52,446 [54] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:26:52,447 [54] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:26:52,449 [54] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:26:52,451 [54] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:26:52,460 [54] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:26:52,462 [54] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:26:52,464 [54] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:26:52,464 [54] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:26:52,466 [54] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:26:52,467 [54] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:26:52,468 [54] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:26:52,470 [54] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:26:52,471 [54] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:26:52,471 [54] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:26:52,472 [54] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:26:52,473 [54] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:26:52,480 [54] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:26:52,482 [54] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:26:52,483 [54] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:26:52,484 [54] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:26:52,485 [54] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:26:52,486 [54] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:26:52,486 [54] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:26:52,499 [54] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:26:52,531 [54] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'desi';
declare @sid varchar(100); set @sid = 'o2ug5aavcu50g3oaq1xi5w1e';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id
   from (select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 10:26:52,553 [54] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:26:52,557 [54] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:26:52,560 [54] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:26:52,561 [54] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:26:52,564 [54] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, 1) ft
      join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:26:52,579 [54] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
        join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:26:52,600 [54] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 5 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 10:26:52,627 [54] ERROR dn_lib.tools.log - error
System.Exception: la condizione 'add-folder' non  specificata per l'istruzione '{@cond_val='search','add-folder'}'
   in dn_lib.core.parse(String text, Dictionary`2 flds, DataRow dr, Dictionary`2 conds) in C:\root\todd\git\dn\dn_lib\core.cs:riga 212
2021-01-07 10:26:52,652 [54] ERROR dn_lib.tools.log - error
System.Exception: la condizione 'add-folder' non  specificata per l'istruzione '{@cond_val='search','add-folder'}'
   in dn_lib.core.parse(String text, Dictionary`2 flds, DataRow dr, Dictionary`2 conds) in C:\root\todd\git\dn\dn_lib\core.cs:riga 312
   in dn_lib.core.parse(String text, Dictionary`2 flds, DataRow dr, Dictionary`2 conds) in C:\root\todd\git\dn\dn_lib\core.cs:riga 268
2021-01-07 10:26:52,653 [54] ERROR dn_lib.tools.log - error
System.Exception: la condizione 'add-folder' non  specificata per l'istruzione '{@cond_val='search','add-folder'}'
   in dn_lib.core.parse(String text, Dictionary`2 flds, DataRow dr, Dictionary`2 conds) in C:\root\todd\git\dn\dn_lib\core.cs:riga 312
   in dn_lib.core.parse_html_block(String key, String[,] flds) in C:\root\todd\git\dn\dn_lib\core.cs:riga 148
   in _notes.parse_menu(List`1 sfs, Boolean open_home, String cmd, Nullable`1 search_id) in c:\root\todd\git\dn\deepanotes\notes.aspx.cs:riga 452
   in _notes.OnInit(EventArgs e) in c:\root\todd\git\dn\deepanotes\notes.aspx.cs:riga 272
2021-01-07 10:27:40,168 [45] INFO dn_lib.tools.log - reload core
2021-01-07 10:27:40,203 [45] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:27:40,205 [45] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:27:40,206 [45] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:27:40,207 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:27:40,209 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:27:40,210 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:27:40,222 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:27:40,224 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:27:40,225 [45] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:27:40,226 [45] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:27:40,227 [45] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:27:40,228 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:27:40,228 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:27:40,230 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:27:40,230 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:27:40,231 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:27:40,231 [45] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:27:40,232 [45] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:27:40,240 [45] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:27:40,241 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:27:40,242 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:27:40,243 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:27:40,244 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:27:40,244 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:27:40,244 [45] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:27:40,250 [45] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:27:40,283 [45] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'desi';
declare @sid varchar(100); set @sid = 'o2ug5aavcu50g3oaq1xi5w1e';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id
   from (select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 10:27:40,285 [45] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:27:40,287 [45] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:27:40,288 [45] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:27:40,289 [45] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:27:40,293 [45] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, 1) ft
      join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:27:40,296 [45] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
        join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:27:40,300 [45] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 5 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 10:27:40,310 [45] ERROR dn_lib.tools.log - error
System.Exception: la condizione 'add-folder' non  specificata per l'istruzione '{@cond_val='search','add-folder'}'
   in dn_lib.core.parse(String text, Dictionary`2 flds, DataRow dr, Dictionary`2 conds) in C:\root\todd\git\dn\dn_lib\core.cs:riga 212
2021-01-07 10:27:40,315 [45] ERROR dn_lib.tools.log - error
System.Exception: la condizione 'add-folder' non  specificata per l'istruzione '{@cond_val='search','add-folder'}'
   in dn_lib.core.parse(String text, Dictionary`2 flds, DataRow dr, Dictionary`2 conds) in C:\root\todd\git\dn\dn_lib\core.cs:riga 312
   in dn_lib.core.parse(String text, Dictionary`2 flds, DataRow dr, Dictionary`2 conds) in C:\root\todd\git\dn\dn_lib\core.cs:riga 268
2021-01-07 10:27:40,316 [45] ERROR dn_lib.tools.log - error
System.Exception: la condizione 'add-folder' non  specificata per l'istruzione '{@cond_val='search','add-folder'}'
   in dn_lib.core.parse(String text, Dictionary`2 flds, DataRow dr, Dictionary`2 conds) in C:\root\todd\git\dn\dn_lib\core.cs:riga 312
   in dn_lib.core.parse_html_block(String key, String[,] flds) in C:\root\todd\git\dn\dn_lib\core.cs:riga 148
   in _notes.parse_menu(List`1 sfs, Boolean open_home, String cmd, Nullable`1 search_id) in c:\root\todd\git\dn\deepanotes\notes.aspx.cs:riga 452
   in _notes.OnInit(EventArgs e) in c:\root\todd\git\dn\deepanotes\notes.aspx.cs:riga 272
2021-01-07 10:27:41,082 [85] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:27:41,084 [85] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:27:41,085 [85] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:27:41,085 [85] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:27:41,086 [85] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:27:41,087 [85] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:27:41,088 [85] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:27:41,089 [85] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:27:41,089 [85] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:27:41,090 [85] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:27:41,090 [85] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:27:41,091 [85] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:27:41,092 [85] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:27:41,092 [85] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:27:41,093 [85] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:27:41,093 [85] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:27:41,094 [85] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:27:41,094 [85] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:27:41,095 [85] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:27:41,095 [85] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:27:41,096 [85] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:27:41,096 [85] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:27:41,098 [85] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:27:41,098 [85] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:27:41,099 [85] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:27:41,100 [85] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:27:41,110 [85] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'desi';
declare @sid varchar(100); set @sid = 'o2ug5aavcu50g3oaq1xi5w1e';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id
   from (select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 10:27:41,112 [85] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:27:41,113 [85] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:27:41,114 [85] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:27:41,115 [85] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:27:41,116 [85] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, 1) ft
      join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:27:41,118 [85] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
        join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:27:41,119 [85] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 5 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 10:27:41,121 [85] ERROR dn_lib.tools.log - error
System.Exception: la condizione 'add-folder' non  specificata per l'istruzione '{@cond_val='search','add-folder'}'
   in dn_lib.core.parse(String text, Dictionary`2 flds, DataRow dr, Dictionary`2 conds) in C:\root\todd\git\dn\dn_lib\core.cs:riga 212
2021-01-07 10:27:41,122 [85] ERROR dn_lib.tools.log - error
System.Exception: la condizione 'add-folder' non  specificata per l'istruzione '{@cond_val='search','add-folder'}'
   in dn_lib.core.parse(String text, Dictionary`2 flds, DataRow dr, Dictionary`2 conds) in C:\root\todd\git\dn\dn_lib\core.cs:riga 312
   in dn_lib.core.parse(String text, Dictionary`2 flds, DataRow dr, Dictionary`2 conds) in C:\root\todd\git\dn\dn_lib\core.cs:riga 268
2021-01-07 10:27:41,122 [85] ERROR dn_lib.tools.log - error
System.Exception: la condizione 'add-folder' non  specificata per l'istruzione '{@cond_val='search','add-folder'}'
   in dn_lib.core.parse(String text, Dictionary`2 flds, DataRow dr, Dictionary`2 conds) in C:\root\todd\git\dn\dn_lib\core.cs:riga 312
   in dn_lib.core.parse_html_block(String key, String[,] flds) in C:\root\todd\git\dn\dn_lib\core.cs:riga 148
   in _notes.parse_menu(List`1 sfs, Boolean open_home, String cmd, Nullable`1 search_id) in c:\root\todd\git\dn\deepanotes\notes.aspx.cs:riga 452
   in _notes.OnInit(EventArgs e) in c:\root\todd\git\dn\deepanotes\notes.aspx.cs:riga 272
2021-01-07 10:31:40,197 [88] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:31:40,198 [88] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:31:40,199 [88] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:31:40,200 [88] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:31:40,200 [88] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:31:40,201 [88] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:31:40,202 [88] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:31:40,203 [88] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:31:40,203 [88] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:31:40,204 [88] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:31:40,205 [88] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:31:40,205 [88] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:31:40,206 [88] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:31:40,206 [88] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:31:40,207 [88] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:31:40,207 [88] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:31:40,208 [88] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:31:40,209 [88] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:31:40,210 [88] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:31:40,210 [88] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:31:40,211 [88] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:31:40,211 [88] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:31:40,212 [88] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:31:40,212 [88] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:31:40,212 [88] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:31:40,233 [88] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:31:40,241 [88] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'desi';
declare @sid varchar(100); set @sid = 'o2ug5aavcu50g3oaq1xi5w1e';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id
   from (select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 10:31:40,263 [88] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:31:40,265 [88] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:31:40,267 [88] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:31:40,268 [88] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:31:40,269 [88] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, 1) ft
      join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:31:40,283 [88] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
        join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:31:40,301 [88] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 5 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 10:31:40,319 [88] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:31:40,333 [88] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:31:40,411 [88] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:31:40,413 [88] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:31:40,415 [88] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:33:16,896 [37] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:33:16,897 [37] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:33:16,898 [37] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:33:16,899 [37] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:33:16,899 [37] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:33:16,900 [37] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:33:16,900 [37] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:33:16,901 [37] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:33:16,901 [37] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:33:16,902 [37] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:33:16,902 [37] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:33:16,903 [37] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:33:16,903 [37] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:33:16,904 [37] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:33:16,904 [37] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:33:16,905 [37] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:33:16,905 [37] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:33:16,905 [37] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:33:16,907 [37] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:33:16,908 [37] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:33:16,908 [37] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:33:16,909 [37] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:33:16,910 [37] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:33:16,910 [37] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:33:16,911 [37] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:33:16,924 [37] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:33:16,936 [37] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'desi';
declare @sid varchar(100); set @sid = 'o2ug5aavcu50g3oaq1xi5w1e';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id
   from (select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 10:33:16,962 [37] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:33:16,963 [37] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:33:16,965 [37] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:33:16,966 [37] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:33:16,967 [37] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, 1) ft
      join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:33:16,980 [37] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
        join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:33:16,999 [37] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 5 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 10:33:17,015 [37] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:33:17,020 [37] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:33:17,022 [37] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:33:17,025 [37] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:33:17,028 [37] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:33:28,112 [37] INFO dn_lib.tools.log - reload core
2021-01-07 10:33:28,143 [37] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:33:28,144 [37] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:33:28,146 [37] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:33:28,147 [37] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:33:28,149 [37] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:33:28,151 [37] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:33:28,171 [37] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:33:28,173 [37] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:33:28,176 [37] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:33:28,177 [37] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:33:28,178 [37] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:33:28,179 [37] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:33:28,179 [37] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:33:28,180 [37] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:33:28,180 [37] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:33:28,181 [37] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:33:28,182 [37] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:33:28,182 [37] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:33:28,187 [37] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:33:28,189 [37] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:33:28,190 [37] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:33:28,191 [37] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:33:28,193 [37] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:33:28,194 [37] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:33:28,194 [37] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:33:28,195 [37] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:33:28,227 [37] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'desi';
declare @sid varchar(100); set @sid = 'o2ug5aavcu50g3oaq1xi5w1e';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id
   from (select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 10:33:28,248 [37] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:33:28,249 [37] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:33:28,251 [37] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:33:28,252 [37] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:33:28,253 [37] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, 1) ft
      join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:33:28,268 [37] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
        join dn_search_folders sf on sf.search_id = 5 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:33:28,286 [37] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 5 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 10:33:28,304 [37] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:33:28,309 [37] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:33:28,358 [37] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:33:28,359 [37] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:33:28,361 [37] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:35:57,985 [70] INFO dn_lib.tools.log - reload core
2021-01-07 10:35:58,034 [70] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:35:58,035 [70] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:35:58,036 [70] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:35:58,037 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:35:58,039 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:35:58,041 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:35:58,054 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:35:58,056 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:35:58,057 [70] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:35:58,058 [70] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:35:58,058 [70] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:35:58,059 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:35:58,059 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:35:58,060 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:35:58,060 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:35:58,060 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:35:58,060 [70] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:35:58,061 [70] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:35:58,084 [70] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:35:58,087 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:35:58,088 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:35:58,089 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:35:58,090 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:35:58,090 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:35:58,091 [70] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:35:58,092 [70] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:35:58,173 [18] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:35:58,174 [18] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:35:58,175 [18] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:35:58,176 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:35:58,178 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:35:58,179 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:35:58,180 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:35:58,181 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:35:58,182 [18] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:35:58,183 [18] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:35:58,184 [18] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:35:58,185 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:35:58,186 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:35:58,186 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:35:58,187 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:35:58,187 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:35:58,188 [18] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:35:58,188 [18] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:35:58,189 [18] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:35:58,189 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:35:58,189 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:35:58,190 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:35:58,190 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:35:58,191 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:35:58,191 [18] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:35:58,192 [18] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:35:58,262 [45] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:35:58,263 [45] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:35:58,263 [45] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:35:58,264 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:35:58,265 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:35:58,267 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:35:58,268 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:35:58,269 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:35:58,269 [45] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:35:58,270 [45] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:35:58,271 [45] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:35:58,272 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:35:58,273 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:35:58,274 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:35:58,275 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:35:58,276 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:35:58,277 [45] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:35:58,277 [45] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:35:58,278 [45] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:35:58,279 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:35:58,279 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:35:58,280 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:35:58,281 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:35:58,281 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:35:58,283 [45] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:35:58,286 [45] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:35:58,322 [45] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:35:58,336 [45] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:35:58,340 [45] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:35:58,342 [45] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:35:58,343 [45] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:35:58,362 [45] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:35:58,372 [45] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1  and t3.stato = 'in_corso' or t3.diff_days = 1
2021-01-07 10:35:59,162 [45] ERROR dn_lib.tools.log - error
System.Exception: il campo 'search' specificato non  stato impostato!
   in dn_lib.core.get_obj(String par, Dictionary`2 flds, DataRow dr) in C:\root\todd\git\dn\dn_lib\core.cs:riga 333
   in dn_lib.core.get_val(String par, Dictionary`2 flds, DataRow dr, String def) in C:\root\todd\git\dn\dn_lib\core.cs:riga 317
   in dn_lib.core.parse(String text, Dictionary`2 flds, DataRow dr, Dictionary`2 conds) in C:\root\todd\git\dn\dn_lib\core.cs:riga 220
2021-01-07 10:35:59,189 [45] ERROR dn_lib.tools.log - error
System.Exception: il campo 'search' specificato non  stato impostato!
   in dn_lib.core.parse(String text, Dictionary`2 flds, DataRow dr, Dictionary`2 conds) in C:\root\todd\git\dn\dn_lib\core.cs:riga 312
   in dn_lib.core.parse(String text, Dictionary`2 flds, DataRow dr, Dictionary`2 conds) in C:\root\todd\git\dn\dn_lib\core.cs:riga 268
2021-01-07 10:35:59,207 [45] ERROR dn_lib.tools.log - error
System.Exception: il campo 'search' specificato non  stato impostato!
   in dn_lib.core.parse(String text, Dictionary`2 flds, DataRow dr, Dictionary`2 conds) in C:\root\todd\git\dn\dn_lib\core.cs:riga 312
   in dn_lib.core.parse_html_block(String key, String[,] flds) in C:\root\todd\git\dn\dn_lib\core.cs:riga 148
   in _notes.parse_folders_menu(List`1 fs, Int32 lvl, String cmd) in c:\root\todd\git\dn\deepanotes\notes.aspx.cs:riga 488
   in _notes.parse_folders_menu(List`1 fs, Int32 lvl, String cmd) in c:\root\todd\git\dn\deepanotes\notes.aspx.cs:riga 488
   in _notes.parse_menu(List`1 sfs, Boolean open_home, String cmd, Nullable`1 search_id) in c:\root\todd\git\dn\deepanotes\notes.aspx.cs:riga 452
   in _notes.OnInit(EventArgs e) in c:\root\todd\git\dn\deepanotes\notes.aspx.cs:riga 272
2021-01-07 10:37:32,743 [70] INFO dn_lib.tools.log - reload core
2021-01-07 10:37:32,775 [70] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:37:32,777 [70] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:37:32,778 [70] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:37:32,779 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:37:32,781 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:37:32,783 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:37:32,796 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:37:32,798 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:37:32,801 [70] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:37:32,802 [70] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:37:32,804 [70] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:37:32,805 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:37:32,806 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:37:32,807 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:37:32,808 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:37:32,809 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:37:32,810 [70] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:37:32,811 [70] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:37:32,824 [70] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:37:32,826 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:37:32,827 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:37:32,827 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:37:32,828 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:37:32,828 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:37:32,829 [70] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:37:32,830 [70] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:37:32,880 [45] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:37:32,881 [45] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:37:32,882 [45] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:37:32,883 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:37:32,883 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:37:32,884 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:37:32,884 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:37:32,885 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:37:32,886 [45] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:37:32,886 [45] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:37:32,886 [45] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:37:32,887 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:37:32,887 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:37:32,888 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:37:32,888 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:37:32,888 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:37:32,889 [45] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:37:32,889 [45] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:37:32,890 [45] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:37:32,890 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:37:32,890 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:37:32,891 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:37:32,891 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:37:32,892 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:37:32,892 [45] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:37:32,893 [45] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:37:32,968 [18] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:37:32,969 [18] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:37:32,969 [18] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:37:32,970 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:37:32,971 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:37:32,971 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:37:32,972 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:37:32,972 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:37:32,973 [18] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:37:32,973 [18] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:37:32,974 [18] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:37:32,974 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:37:32,974 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:37:32,975 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:37:32,975 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:37:32,975 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:37:32,976 [18] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:37:32,976 [18] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:37:32,977 [18] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:37:32,977 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:37:32,977 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:37:32,978 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:37:32,978 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:37:32,978 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:37:32,979 [18] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:37:32,982 [18] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:37:33,004 [18] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:37:33,009 [18] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:37:33,012 [18] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:37:33,013 [18] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:37:33,019 [18] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:37:33,031 [18] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:37:33,041 [18] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1  and t3.stato = 'in_corso' or t3.diff_days = 1
2021-01-07 10:37:42,077 [18] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:37:42,093 [18] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:37:42,177 [18] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:37:42,180 [18] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:37:42,183 [18] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:38:28,952 [70] INFO dn_lib.tools.log - reload core
2021-01-07 10:38:28,997 [70] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:38:28,999 [70] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:38:29,000 [70] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:38:29,000 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:38:29,002 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:38:29,004 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:38:29,020 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:38:29,023 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:38:29,029 [70] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:38:29,030 [70] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:38:29,032 [70] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:38:29,033 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:38:29,034 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:38:29,036 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:38:29,036 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:38:29,037 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:38:29,038 [70] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:38:29,039 [70] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:38:29,063 [70] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:38:29,066 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:38:29,067 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:38:29,069 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:38:29,071 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:38:29,072 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:38:29,073 [70] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:38:29,075 [70] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:38:29,133 [18] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:38:29,134 [18] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:38:29,134 [18] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:38:29,135 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:38:29,136 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:38:29,136 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:38:29,137 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:38:29,137 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:38:29,138 [18] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:38:29,138 [18] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:38:29,139 [18] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:38:29,139 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:38:29,140 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:38:29,140 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:38:29,141 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:38:29,141 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:38:29,142 [18] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:38:29,142 [18] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:38:29,143 [18] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:38:29,143 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:38:29,144 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:38:29,144 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:38:29,145 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:38:29,145 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:38:29,146 [18] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:38:29,147 [18] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:38:29,213 [45] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:38:29,214 [45] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:38:29,215 [45] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:38:29,216 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:38:29,216 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:38:29,217 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:38:29,218 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:38:29,219 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:38:29,219 [45] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:38:29,220 [45] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:38:29,220 [45] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:38:29,220 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:38:29,221 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:38:29,221 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:38:29,221 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:38:29,222 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:38:29,222 [45] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:38:29,222 [45] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:38:29,223 [45] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:38:29,223 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:38:29,224 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:38:29,224 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:38:29,225 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:38:29,226 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:38:29,227 [45] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:38:29,231 [45] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:38:29,255 [45] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:38:29,261 [45] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:38:29,263 [45] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:38:29,264 [45] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:38:39,140 [45] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:38:41,719 [45] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:38:44,837 [45] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1  and t3.stato = 'in_corso' or t3.diff_days = 1
2021-01-07 10:39:17,318 [45] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:39:17,336 [45] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:39:17,448 [45] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:39:17,451 [45] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:39:17,454 [45] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:40:13,154 [70] INFO dn_lib.tools.log - reload core
2021-01-07 10:40:13,190 [70] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:40:13,192 [70] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:40:13,193 [70] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:40:13,194 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:40:13,196 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:40:13,197 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:40:13,205 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:40:13,207 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:40:13,209 [70] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:40:13,210 [70] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:40:13,212 [70] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:40:13,212 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:40:13,213 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:40:13,214 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:40:13,215 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:40:13,215 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:40:13,216 [70] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:40:13,217 [70] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:40:13,232 [70] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:40:13,233 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:40:13,234 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:40:13,235 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:40:13,236 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:40:13,237 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:40:13,237 [70] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:40:13,239 [70] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:40:13,291 [45] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:40:13,292 [45] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:40:13,293 [45] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:40:13,293 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:40:13,294 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:40:13,295 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:40:13,295 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:40:13,296 [45] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:40:13,297 [45] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:40:13,298 [45] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:40:13,299 [45] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:40:13,300 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:40:13,300 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:40:13,300 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:40:13,301 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:40:13,301 [45] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:40:13,302 [45] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:40:13,302 [45] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:40:13,303 [45] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:40:13,303 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:40:13,304 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:40:13,304 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:40:13,305 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:40:13,305 [45] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:40:13,305 [45] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:40:13,306 [45] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:40:13,369 [18] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:40:13,370 [18] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:40:13,370 [18] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:40:13,371 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:40:13,371 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:40:13,372 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:40:13,372 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:40:13,373 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:40:13,374 [18] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:40:13,375 [18] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:40:13,375 [18] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:40:13,376 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:40:13,376 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:40:13,376 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:40:13,377 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:40:13,377 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:40:13,377 [18] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:40:13,378 [18] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:40:13,378 [18] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:40:13,379 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:40:13,380 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:40:13,380 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:40:13,381 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:40:13,382 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:40:13,383 [18] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:40:13,389 [18] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:40:13,415 [18] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:40:13,420 [18] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:40:13,423 [18] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:40:13,425 [18] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:40:14,097 [18] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:40:14,527 [18] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:40:15,071 [18] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1  and t3.stato = 'in_corso' or t3.diff_days = 1
2021-01-07 10:40:42,878 [18] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:40:42,899 [18] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:40:43,015 [18] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:40:43,017 [18] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:40:43,020 [18] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:42:56,236 [121] INFO dn_lib.tools.log - reload core
2021-01-07 10:42:56,275 [121] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:42:56,277 [121] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:42:56,278 [121] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:42:56,279 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:42:56,282 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:42:56,284 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:42:56,296 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:42:56,298 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:42:56,300 [121] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:42:56,300 [121] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:42:56,302 [121] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:42:56,302 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:42:56,303 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:42:56,304 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:42:56,305 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:42:56,306 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:42:56,306 [121] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:42:56,306 [121] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:42:56,312 [121] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:42:56,315 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:42:56,316 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:42:56,317 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:42:56,318 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:42:56,319 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:42:56,320 [121] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:42:56,321 [121] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:42:56,351 [106] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:42:56,353 [106] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:42:56,353 [106] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:42:56,354 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:42:56,355 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:42:56,355 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:42:56,356 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:42:56,357 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:42:56,357 [106] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:42:56,358 [106] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:42:56,358 [106] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:42:56,359 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:42:56,359 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:42:56,360 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:42:56,360 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:42:56,360 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:42:56,361 [106] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:42:56,361 [106] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:42:56,362 [106] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:42:56,362 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:42:56,363 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:42:56,363 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:42:56,364 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:42:56,364 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:42:56,365 [106] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:42:56,366 [106] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:42:56,396 [107] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:42:56,397 [107] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:42:56,399 [107] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:42:56,399 [107] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:42:56,400 [107] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:42:56,401 [107] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:42:56,402 [107] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:42:56,404 [107] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:42:56,405 [107] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:42:56,406 [107] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:42:56,407 [107] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:42:56,407 [107] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:42:56,408 [107] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:42:56,408 [107] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:42:56,409 [107] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:42:56,409 [107] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:42:56,410 [107] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:42:56,410 [107] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:42:56,411 [107] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:42:56,411 [107] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:42:56,412 [107] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:42:56,412 [107] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:42:56,413 [107] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:42:56,413 [107] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:42:56,414 [107] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:42:56,427 [107] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:42:56,451 [107] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:42:56,456 [107] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:42:56,459 [107] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:42:56,460 [107] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:42:56,464 [107] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:42:56,477 [107] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:42:56,488 [107] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1  and t3.stato = 'in_corso' or t3.diff_days = 1
2021-01-07 10:42:56,516 [107] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:42:56,531 [107] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:42:56,622 [107] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:42:56,624 [107] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:42:56,627 [107] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:43:09,470 [104] INFO dn_lib.tools.log - reload core
2021-01-07 10:43:09,504 [104] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:43:09,506 [104] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:09,507 [104] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:09,508 [104] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:09,508 [104] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:09,509 [104] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:09,510 [104] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:09,511 [104] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:09,511 [104] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:09,512 [104] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:09,514 [104] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:09,515 [104] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:09,515 [104] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:09,517 [104] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:09,517 [104] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:09,518 [104] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:09,518 [104] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:09,519 [104] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:09,525 [104] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:09,527 [104] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:09,529 [104] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:09,531 [104] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:09,532 [104] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:09,532 [104] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:09,532 [104] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:09,535 [104] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:43:09,567 [110] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:43:09,568 [110] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:09,569 [110] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:09,570 [110] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:09,570 [110] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:09,570 [110] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:09,571 [110] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:09,572 [110] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:09,572 [110] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:09,573 [110] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:09,573 [110] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:09,575 [110] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:09,575 [110] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:09,575 [110] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:09,576 [110] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:09,577 [110] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:09,577 [110] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:09,578 [110] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:09,578 [110] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:09,579 [110] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:09,580 [110] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:09,580 [110] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:09,581 [110] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:09,581 [110] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:09,582 [110] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:09,582 [110] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:43:09,619 [106] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:43:09,620 [106] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:09,621 [106] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:09,621 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:09,622 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:09,623 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:09,624 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:09,625 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:09,625 [106] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:09,626 [106] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:09,627 [106] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:09,627 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:09,628 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:09,629 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:09,630 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:09,631 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:09,632 [106] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:09,633 [106] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:09,633 [106] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:09,634 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:09,635 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:09,635 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:09,636 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:09,637 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:09,638 [106] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:09,641 [106] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:43:09,675 [106] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:43:09,681 [106] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:43:09,683 [106] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:43:09,685 [106] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:43:09,689 [106] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:43:09,704 [106] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:43:09,713 [106] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1  and t3.stato = 'in_corso' or t3.diff_days = 1
2021-01-07 10:43:09,741 [106] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:43:09,758 [106] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:43:09,844 [106] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:43:09,848 [106] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:43:09,850 [106] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:43:51,597 [121] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:43:51,598 [121] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:51,599 [121] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:51,601 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:51,601 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:51,602 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:51,603 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:51,603 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:51,604 [121] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:51,606 [121] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:51,607 [121] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:51,607 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:51,608 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:51,609 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:51,609 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:51,610 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:51,610 [121] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:51,611 [121] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:51,612 [121] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:51,612 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:51,613 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:51,613 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:51,614 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:51,614 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:51,615 [121] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:51,615 [121] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:43:51,629 [108] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:43:51,630 [108] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:51,631 [108] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:51,632 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:51,633 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:51,634 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:51,635 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:51,636 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:51,636 [108] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:51,637 [108] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:51,638 [108] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:51,638 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:51,640 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:51,640 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:51,641 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:51,642 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:51,642 [108] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:51,643 [108] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:51,644 [108] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:51,644 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:51,645 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:51,645 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:51,646 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:51,646 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:51,647 [108] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:51,648 [108] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:43:51,663 [70] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:43:51,664 [70] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:51,664 [70] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:51,665 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:51,666 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:51,667 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:51,667 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:51,668 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:51,669 [70] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:51,669 [70] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:51,670 [70] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:51,670 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:51,671 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:51,672 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:51,673 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:51,673 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:51,674 [70] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:51,674 [70] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:51,675 [70] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:51,676 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:51,676 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:51,677 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:51,677 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:51,678 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:51,678 [70] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:51,679 [70] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:43:51,690 [70] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:43:51,692 [70] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:43:51,694 [70] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:43:51,696 [70] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:43:51,696 [70] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:43:51,706 [70] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:43:51,714 [70] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1  and t3.stato = 'in_corso' or t3.diff_days = 1
2021-01-07 10:43:51,733 [70] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:43:51,739 [70] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:43:51,742 [70] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:43:51,744 [70] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:43:51,746 [70] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:43:58,792 [18] INFO dn_lib.tools.log - reload core
2021-01-07 10:43:58,817 [18] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:43:58,818 [18] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:58,819 [18] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:58,820 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:58,821 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:58,822 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:58,823 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:58,824 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:58,825 [18] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:58,825 [18] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:58,826 [18] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:58,827 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:58,827 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:58,828 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:58,829 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:58,829 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:58,830 [18] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:58,830 [18] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:58,835 [18] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:58,838 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:58,839 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:58,840 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:58,841 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:58,841 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:58,842 [18] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:58,843 [18] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:43:58,875 [108] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:43:58,876 [108] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:58,877 [108] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:58,878 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:58,878 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:58,879 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:58,880 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:58,881 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:58,882 [108] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:58,883 [108] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:58,883 [108] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:58,884 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:58,885 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:58,885 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:58,886 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:58,886 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:58,888 [108] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:58,889 [108] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:58,889 [108] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:58,890 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:58,891 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:58,891 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:58,892 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:58,892 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:58,893 [108] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:58,893 [108] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:43:58,915 [70] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:43:58,916 [70] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:58,917 [70] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:58,918 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:58,919 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:58,920 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:58,921 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:58,922 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:58,923 [70] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:58,923 [70] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:58,924 [70] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:58,925 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:58,925 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:58,926 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:58,926 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:58,927 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:58,927 [70] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:58,928 [70] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:43:58,928 [70] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:43:58,929 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:43:58,929 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:43:58,930 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:43:58,931 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:43:58,931 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:43:58,932 [70] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:43:58,933 [70] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:43:58,953 [70] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:43:58,959 [70] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:43:58,961 [70] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:43:58,962 [70] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:43:58,963 [70] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:43:58,965 [70] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:43:58,967 [70] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1  and t3.stato = 'in_corso' or t3.diff_days = 1
2021-01-07 10:43:58,977 [70] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:43:58,983 [70] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:43:59,035 [70] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:43:59,036 [70] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:43:59,038 [70] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:44:10,336 [121] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:44:10,337 [121] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:44:10,338 [121] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:44:10,339 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:44:10,340 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:44:10,340 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:44:10,341 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:44:10,341 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:44:10,342 [121] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:44:10,342 [121] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:44:10,343 [121] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:44:10,343 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:44:10,344 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:44:10,344 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:44:10,345 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:44:10,345 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:44:10,345 [121] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:44:10,346 [121] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:44:10,346 [121] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:44:10,347 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:44:10,347 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:44:10,348 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:44:10,348 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:44:10,349 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:44:10,349 [121] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:44:10,350 [121] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:44:10,364 [106] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:44:10,366 [106] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:44:10,366 [106] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:44:10,367 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:44:10,368 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:44:10,368 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:44:10,369 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:44:10,371 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:44:10,371 [106] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:44:10,372 [106] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:44:10,372 [106] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:44:10,373 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:44:10,373 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:44:10,373 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:44:10,374 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:44:10,374 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:44:10,375 [106] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:44:10,375 [106] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:44:10,376 [106] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:44:10,376 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:44:10,377 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:44:10,377 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:44:10,378 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:44:10,378 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:44:10,379 [106] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:44:10,379 [106] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:44:10,391 [110] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:44:10,392 [110] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:44:10,393 [110] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:44:10,394 [110] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:44:10,394 [110] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:44:10,394 [110] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:44:10,395 [110] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:44:10,395 [110] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:44:10,396 [110] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:44:10,396 [110] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:44:10,397 [110] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:44:10,397 [110] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:44:10,398 [110] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:44:10,398 [110] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:44:10,398 [110] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:44:10,399 [110] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:44:10,399 [110] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:44:10,399 [110] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:44:10,400 [110] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:44:10,400 [110] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:44:10,401 [110] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:44:10,401 [110] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:44:10,402 [110] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:44:10,403 [110] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:44:10,403 [110] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:44:10,404 [110] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:44:10,413 [110] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'desi';
declare @sid varchar(100); set @sid = 'tsenz3h4twlf2ack0wemaa10';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id
   from (select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 10:44:10,445 [110] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:44:10,446 [110] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:44:10,447 [110] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:44:10,448 [110] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:44:10,449 [110] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 6 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:44:10,463 [110] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 6 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:44:10,482 [110] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 6 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 10:44:10,497 [110] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:44:10,501 [110] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:44:10,502 [110] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:44:10,503 [110] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:44:10,504 [110] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:44:16,418 [121] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:44:16,419 [121] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:44:16,420 [121] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:44:16,421 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:44:16,422 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:44:16,423 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:44:16,424 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:44:16,424 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:44:16,425 [121] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:44:16,425 [121] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:44:16,425 [121] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:44:16,426 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:44:16,426 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:44:16,426 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:44:16,427 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:44:16,427 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:44:16,427 [121] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:44:16,428 [121] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:44:16,428 [121] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:44:16,429 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:44:16,429 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:44:16,429 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:44:16,430 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:44:16,430 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:44:16,431 [121] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:44:16,431 [121] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:44:16,444 [106] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:44:16,445 [106] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:44:16,446 [106] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:44:16,447 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:44:16,447 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:44:16,448 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:44:16,448 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:44:16,449 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:44:16,449 [106] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:44:16,450 [106] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:44:16,450 [106] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:44:16,451 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:44:16,452 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:44:16,453 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:44:16,453 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:44:16,454 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:44:16,454 [106] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:44:16,455 [106] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:44:16,455 [106] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:44:16,456 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:44:16,456 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:44:16,456 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:44:16,457 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:44:16,457 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:44:16,458 [106] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:44:16,458 [106] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:44:16,467 [106] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'desi';
declare @sid varchar(100); set @sid = 'tsenz3h4twlf2ack0wemaa10';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id
   from (select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 10:44:16,489 [106] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:44:16,490 [106] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:44:16,491 [106] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:44:16,493 [106] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:44:16,494 [106] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, 1) ft
      join dn_search_folders sf on sf.search_id = 6 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:44:16,509 [106] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
        join dn_search_folders sf on sf.search_id = 6 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:44:16,530 [106] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 6 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 10:44:16,547 [106] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:44:16,551 [106] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:44:16,553 [106] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:44:16,556 [106] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:44:16,558 [106] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:44:45,175 [107] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:44:45,176 [107] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:44:45,177 [107] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:44:45,178 [107] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:44:45,179 [107] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:44:45,179 [107] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:44:45,180 [107] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:44:45,181 [107] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:44:45,182 [107] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:44:45,182 [107] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:44:45,183 [107] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:44:45,183 [107] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:44:45,184 [107] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:44:45,185 [107] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:44:45,185 [107] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:44:45,186 [107] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:44:45,186 [107] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:44:45,187 [107] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:44:45,187 [107] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:44:45,188 [107] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:44:45,188 [107] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:44:45,189 [107] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:44:45,189 [107] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:44:45,190 [107] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:44:45,190 [107] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:44:45,191 [107] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:44:45,235 [107] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 47
2021-01-07 10:44:45,237 [107] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path
      from vw_task_allegati a
      where a.task_id = 47
2021-01-07 10:44:54,221 [121] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:44:54,223 [121] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:44:54,223 [121] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:44:54,224 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:44:54,225 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:44:54,226 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:44:54,226 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:44:54,227 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:44:54,228 [121] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:44:54,229 [121] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:44:54,230 [121] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:44:54,231 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:44:54,232 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:44:54,232 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:44:54,233 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:44:54,233 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:44:54,234 [121] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:44:54,234 [121] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:44:54,234 [121] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:44:54,235 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:44:54,235 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:44:54,236 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:44:54,236 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:44:54,237 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:44:54,237 [121] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:44:54,238 [121] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:44:54,248 [121] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:44:54,250 [121] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:44:54,252 [121] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:44:54,253 [121] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:44:54,254 [121] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, 1) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:44:54,262 [121] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:44:54,272 [121] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1  and t3.stato = 'in_corso' or t3.diff_days = 1
2021-01-07 10:44:54,292 [121] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:44:54,299 [121] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:44:54,302 [121] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:44:54,304 [121] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:44:54,306 [121] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:45:00,791 [104] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:45:00,792 [104] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:00,794 [104] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:00,795 [104] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:00,796 [104] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:00,796 [104] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:00,797 [104] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:00,798 [104] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:00,799 [104] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:00,800 [104] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:00,800 [104] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:00,801 [104] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:00,802 [104] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:00,802 [104] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:00,803 [104] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:00,803 [104] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:00,804 [104] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:00,804 [104] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:00,805 [104] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:00,805 [104] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:00,806 [104] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:00,806 [104] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:00,807 [104] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:00,807 [104] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:00,807 [104] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:00,808 [104] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:45:00,821 [106] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:45:00,822 [106] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:00,823 [106] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:00,823 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:00,824 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:00,824 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:00,825 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:00,825 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:00,826 [106] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:00,826 [106] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:00,827 [106] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:00,827 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:00,828 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:00,829 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:00,830 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:00,830 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:00,831 [106] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:00,831 [106] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:00,831 [106] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:00,832 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:00,832 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:00,833 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:00,833 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:00,834 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:00,834 [106] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:00,835 [106] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:45:00,847 [108] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:45:00,848 [108] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:00,849 [108] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:00,849 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:00,850 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:00,850 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:00,851 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:00,851 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:00,852 [108] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:00,852 [108] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:00,852 [108] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:00,853 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:00,853 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:00,853 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:00,854 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:00,854 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:00,855 [108] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:00,855 [108] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:00,856 [108] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:00,856 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:00,857 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:00,857 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:00,857 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:00,858 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:00,858 [108] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:00,859 [108] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:45:00,868 [108] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'vaib';
declare @sid varchar(100); set @sid = 'tsenz3h4twlf2ack0wemaa10';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id
   from (select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 10:45:00,900 [108] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:45:00,901 [108] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:45:00,902 [108] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:45:00,902 [108] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:45:00,903 [108] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 6 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:45:00,917 [108] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 6 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:45:00,936 [108] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 6 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 10:45:00,952 [108] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:45:00,954 [108] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:45:00,955 [108] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:45:00,956 [108] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:45:00,957 [108] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:45:11,723 [107] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:45:11,723 [107] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:11,724 [107] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:11,725 [107] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:11,726 [107] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:11,727 [107] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:11,728 [107] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:11,728 [107] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:11,729 [107] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:11,729 [107] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:11,730 [107] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:11,730 [107] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:11,731 [107] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:11,731 [107] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:11,731 [107] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:11,732 [107] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:11,732 [107] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:11,733 [107] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:11,733 [107] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:11,734 [107] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:11,734 [107] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:11,735 [107] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:11,735 [107] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:11,736 [107] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:11,736 [107] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:11,737 [107] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:45:11,748 [110] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:45:11,749 [110] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:11,749 [110] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:11,750 [110] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:11,750 [110] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:11,751 [110] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:11,751 [110] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:11,752 [110] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:11,752 [110] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:11,753 [110] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:11,753 [110] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:11,753 [110] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:11,754 [110] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:11,754 [110] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:11,755 [110] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:11,755 [110] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:11,755 [110] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:11,756 [110] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:11,756 [110] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:11,757 [110] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:11,757 [110] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:11,757 [110] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:11,758 [110] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:11,758 [110] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:11,759 [110] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:11,760 [110] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:45:11,770 [18] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:45:11,771 [18] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:11,771 [18] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:11,772 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:11,772 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:11,773 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:11,773 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:11,774 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:11,774 [18] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:11,774 [18] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:11,775 [18] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:11,775 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:11,776 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:11,776 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:11,777 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:11,777 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:11,777 [18] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:11,778 [18] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:11,778 [18] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:11,779 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:11,779 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:11,780 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:11,780 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:11,780 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:11,781 [18] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:11,781 [18] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:45:11,790 [18] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:45:11,790 [18] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:45:11,791 [18] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:45:11,792 [18] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:45:11,793 [18] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:45:11,800 [18] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:45:11,807 [18] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1  and t3.stato = 'in_corso' or t3.diff_days = 1
2021-01-07 10:45:11,825 [18] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:45:11,831 [18] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:45:11,832 [18] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:45:11,833 [18] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:45:11,834 [18] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:45:27,243 [108] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:45:27,244 [108] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:27,245 [108] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:27,246 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:27,246 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:27,247 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:27,247 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:27,248 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:27,249 [108] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:27,249 [108] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:27,249 [108] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:27,250 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:27,250 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:27,251 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:27,251 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:27,252 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:27,252 [108] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:27,253 [108] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:27,253 [108] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:27,254 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:27,254 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:27,255 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:27,255 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:27,256 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:27,256 [108] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:27,257 [108] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:45:27,266 [108] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 47
2021-01-07 10:45:27,268 [108] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path
      from vw_task_allegati a
      where a.task_id = 47
2021-01-07 10:45:32,202 [18] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:45:32,204 [18] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:32,205 [18] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:32,207 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:32,208 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:32,209 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:32,210 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:32,211 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:32,212 [18] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:32,213 [18] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:32,214 [18] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:32,215 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:32,216 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:32,217 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:32,217 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:32,218 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:32,219 [18] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:32,219 [18] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:32,220 [18] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:32,220 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:32,221 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:32,221 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:32,222 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:32,222 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:32,223 [18] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:32,223 [18] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:45:36,723 [98] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:45:36,725 [98] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:36,726 [98] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:36,728 [98] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:36,729 [98] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:36,730 [98] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:36,730 [98] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:36,731 [98] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:36,732 [98] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:36,732 [98] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:36,733 [98] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:36,734 [98] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:36,734 [98] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:36,735 [98] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:36,736 [98] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:36,736 [98] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:36,737 [98] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:36,737 [98] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:36,738 [98] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:36,739 [98] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:36,739 [98] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:36,740 [98] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:36,740 [98] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:36,740 [98] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:36,741 [98] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:36,741 [98] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:45:36,752 [98] DEBUG dn_lib.tools.log - SQL: select t.task_id, t.synch_folder_id, t.folder_id, t.file_id, t.title, t.dt_upd, t.dt_readed, sf.local_path as synch_local_path
		    , replace(dbo.folder_path(isnull(t.folder_id, f.folder_id)), '/', '\') as folder_path, f.file_id as file_notes_id, f.file_name
       from dn_tasks t
       join synch_folders sf on sf.synch_folder_id = t.synch_folder_id
       left join dn_files f on f.file_id = t.file_id
	   where t.task_id = 47
2021-01-07 10:45:36,756 [98] DEBUG dn_lib.tools.log - SQL: select f.folder_id, replace((select local_path from synch_folders where synch_folder_id = f.synch_folder_id) 
        + isnull(dbo.folder_path(f.folder_id), '\') + f.file_name , '/', '\') as file_path
       from dn_files f where f.file_id = 13
2021-01-07 10:45:36,761 [98] DEBUG dn_lib.tools.log - SQL: declare @id int;
      insert into dn_files (synch_folder_id, folder_id, file_name, dt_ins , readed, dt_upd, extension)
   select 1 as synch_folder_id, 119 as folder_id, 'vibe2.txt' as file_name
    , convert(datetime, convert(varchar, getdate(), 120), 120) as dt_ins, readed, convert(datetime, convert(varchar, getdate(), 120), 120) as dt_upd, extension
   from dn_files where file_id = 13;
 
   select @id = @@IDENTITY;  
 
   insert into dn_files_contents (file_id, extension, content, dt_ins, dt_upd)
   select @id as file_id, extension, content, convert(datetime, convert(varchar, getdate(), 120), 120) as dt_ins 
    , convert(datetime, convert(varchar, getdate(), 120), 120) as dt_upd
    from dn_files_contents where file_id = 13;
2021-01-07 10:45:37,000 [104] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:45:37,001 [104] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:37,002 [104] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:37,004 [104] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:37,005 [104] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:37,006 [104] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:37,007 [104] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:37,009 [104] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:37,009 [104] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:37,010 [104] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:37,011 [104] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:37,012 [104] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:37,012 [104] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:37,013 [104] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:37,014 [104] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:37,014 [104] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:37,015 [104] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:37,016 [104] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:37,017 [104] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:37,017 [104] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:37,018 [104] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:37,018 [104] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:37,019 [104] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:37,020 [104] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:37,020 [104] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:37,021 [104] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:45:37,030 [104] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 47
2021-01-07 10:45:37,031 [104] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path
      from vw_task_allegati a
      where a.task_id = 47
2021-01-07 10:45:54,331 [18] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:45:54,333 [18] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:54,334 [18] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:54,336 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:54,338 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:54,339 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:54,341 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:54,342 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:54,344 [18] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:54,345 [18] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:54,346 [18] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:54,347 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:54,348 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:54,348 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:54,349 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:54,350 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:54,351 [18] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:54,351 [18] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:45:54,352 [18] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:45:54,352 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:45:54,353 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:45:54,354 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:45:54,354 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:45:54,355 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:45:54,355 [18] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:45:54,356 [18] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:45:54,366 [18] DEBUG dn_lib.tools.log - SQL: select f.folder_id, replace((select local_path from synch_folders where synch_folder_id = f.synch_folder_id) 
        + isnull(dbo.folder_path(f.folder_id), '\') + f.file_name , '/', '\') as file_path
       from dn_files f where f.file_id = 16
2021-01-07 10:45:54,370 [18] DEBUG dn_lib.tools.log - SQL: update dn_files set file_name = left('brendon.txt', 150)
        where file_id = 16
2021-01-07 10:46:01,833 [106] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:46:01,834 [106] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:46:01,835 [106] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:46:01,836 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:46:01,837 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:46:01,838 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:46:01,839 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:46:01,839 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:46:01,840 [106] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:46:01,841 [106] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:46:01,842 [106] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:46:01,842 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:46:01,843 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:46:01,844 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:46:01,844 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:46:01,845 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:46:01,845 [106] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:46:01,846 [106] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:46:01,846 [106] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:46:01,847 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:46:01,847 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:46:01,848 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:46:01,848 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:46:01,849 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:46:01,849 [106] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:46:01,850 [106] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:46:01,855 [106] DEBUG dn_lib.tools.log - SQL: select f.folder_id, replace((select local_path from synch_folders where synch_folder_id = f.synch_folder_id) 
        + isnull(dbo.folder_path(f.folder_id), '\') + f.file_name , '/', '\') as file_path
       from dn_files f where f.file_id = 16
2021-01-07 10:46:01,859 [106] DEBUG dn_lib.tools.log - SQL: delete from dn_files_contents where file_id = 16;
        insert into dn_files_contents (file_id, extension, content, dt_ins, dt_upd)
          values (16, '.txt', @content, convert(datetime, '2021-01-07 10:46:01', 120), convert(datetime, '2021-01-07 10:46:01', 120));
2021-01-07 10:46:35,164 [110] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:46:35,164 [110] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:46:35,165 [110] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:46:35,166 [110] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:46:35,167 [110] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:46:35,168 [110] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:46:35,169 [110] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:46:35,170 [110] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:46:35,170 [110] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:46:35,171 [110] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:46:35,172 [110] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:46:35,173 [110] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:46:35,174 [110] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:46:35,174 [110] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:46:35,175 [110] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:46:35,176 [110] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:46:35,176 [110] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:46:35,177 [110] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:46:35,178 [110] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:46:35,178 [110] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:46:35,179 [110] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:46:35,180 [110] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:46:35,180 [110] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:46:35,181 [110] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:46:35,181 [110] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:46:35,182 [110] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:46:35,671 [104] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:46:35,673 [104] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:46:35,674 [104] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:46:35,675 [104] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:46:35,676 [104] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:46:35,677 [104] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:46:35,677 [104] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:46:35,678 [104] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:46:35,679 [104] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:46:35,680 [104] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:46:35,680 [104] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:46:35,681 [104] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:46:35,682 [104] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:46:35,682 [104] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:46:35,683 [104] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:46:35,684 [104] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:46:35,684 [104] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:46:35,685 [104] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:46:35,685 [104] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:46:35,686 [104] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:46:35,686 [104] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:46:35,688 [104] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:46:35,688 [104] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:46:35,689 [104] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:46:35,689 [104] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:46:35,690 [104] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:46:35,711 [106] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:46:35,712 [106] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:46:35,713 [106] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:46:35,714 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:46:35,715 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:46:35,715 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:46:35,716 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:46:35,717 [106] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:46:35,718 [106] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:46:35,718 [106] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:46:35,719 [106] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:46:35,720 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:46:35,720 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:46:35,720 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:46:35,721 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:46:35,721 [106] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:46:35,722 [106] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:46:35,722 [106] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:46:35,723 [106] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:46:35,723 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:46:35,724 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:46:35,724 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:46:35,725 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:46:35,725 [106] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:46:35,726 [106] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:46:35,726 [106] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:46:35,737 [108] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:46:35,738 [108] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:46:35,739 [108] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:46:35,739 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:46:35,740 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:46:35,741 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:46:35,742 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:46:35,742 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:46:35,743 [108] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:46:35,744 [108] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:46:35,744 [108] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:46:35,745 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:46:35,745 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:46:35,746 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:46:35,746 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:46:35,747 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:46:35,747 [108] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:46:35,748 [108] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:46:35,748 [108] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:46:35,749 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:46:35,749 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:46:35,750 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:46:35,750 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:46:35,751 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:46:35,751 [108] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:46:35,752 [108] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:46:35,760 [108] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'brendon';
declare @sid varchar(100); set @sid = 'lkbj4j2y1ng3vrv4lvs4svjo';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id
   from (select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id 
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 10:46:35,782 [108] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:46:35,784 [108] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:46:35,786 [108] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:46:35,787 [108] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:46:35,788 [108] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 7 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:46:35,802 [108] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 7 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:46:35,819 [108] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 7 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 10:46:35,834 [108] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:46:35,837 [108] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:46:35,839 [108] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:46:35,842 [108] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:46:35,844 [108] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:46:39,249 [18] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:46:39,250 [18] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:46:39,251 [18] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:46:39,251 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:46:39,252 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:46:39,253 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:46:39,254 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:46:39,255 [18] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:46:39,256 [18] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:46:39,256 [18] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:46:39,257 [18] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:46:39,258 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:46:39,258 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:46:39,259 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:46:39,260 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:46:39,260 [18] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:46:39,261 [18] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:46:39,262 [18] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:46:39,262 [18] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:46:39,263 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:46:39,263 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:46:39,264 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:46:39,264 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:46:39,265 [18] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:46:39,265 [18] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:46:39,266 [18] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:46:39,275 [18] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 47
2021-01-07 10:46:39,276 [18] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path
      from vw_task_allegati a
      where a.task_id = 47
2021-01-07 10:53:12,684 [70] INFO dn_lib.tools.log - reload core
2021-01-07 10:53:12,718 [70] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:53:12,719 [70] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:53:12,719 [70] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:53:12,720 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:53:12,721 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:53:12,722 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:53:12,724 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:53:12,725 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:53:12,726 [70] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:53:12,726 [70] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:53:12,727 [70] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:53:12,727 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:53:12,728 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:53:12,729 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:53:12,729 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:53:12,731 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:53:12,732 [70] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:53:12,732 [70] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:53:12,737 [70] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:53:12,739 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:53:12,740 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:53:12,741 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:53:12,741 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:53:12,742 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:53:12,743 [70] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:53:12,745 [70] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:53:12,779 [89] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:53:12,780 [89] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:53:12,781 [89] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:53:12,783 [89] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:53:12,783 [89] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:53:12,784 [89] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:53:12,785 [89] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:53:12,786 [89] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:53:12,786 [89] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:53:12,787 [89] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:53:12,787 [89] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:53:12,788 [89] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:53:12,788 [89] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:53:12,789 [89] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:53:12,789 [89] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:53:12,789 [89] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:53:12,790 [89] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:53:12,790 [89] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:53:12,791 [89] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:53:12,791 [89] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:53:12,792 [89] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:53:12,792 [89] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:53:12,793 [89] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:53:12,793 [89] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:53:12,794 [89] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:53:12,794 [89] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:53:12,815 [93] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:53:12,816 [93] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:53:12,817 [93] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:53:12,818 [93] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:53:12,819 [93] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:53:12,820 [93] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:53:12,821 [93] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:53:12,822 [93] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:53:12,822 [93] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:53:12,823 [93] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:53:12,823 [93] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:53:12,824 [93] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:53:12,825 [93] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:53:12,825 [93] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:53:12,826 [93] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:53:12,827 [93] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:53:12,828 [93] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:53:12,828 [93] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:53:12,829 [93] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:53:12,829 [93] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:53:12,830 [93] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:53:12,831 [93] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:53:12,831 [93] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:53:12,832 [93] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:53:12,833 [93] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:53:12,842 [93] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:53:12,866 [93] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:53:12,871 [93] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:53:12,873 [93] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:53:12,874 [93] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:53:12,875 [93] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:53:12,888 [93] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:53:12,895 [93] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1  and t3.stato = 'in_corso' or t3.diff_days = 1
2021-01-07 10:53:12,921 [93] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:53:12,927 [93] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:53:12,980 [93] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:53:12,982 [93] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:53:12,984 [93] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:53:16,245 [91] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:53:16,246 [91] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:53:16,247 [91] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:53:16,248 [91] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:53:16,249 [91] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:53:16,249 [91] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:53:16,250 [91] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:53:16,251 [91] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:53:16,252 [91] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:53:16,253 [91] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:53:16,253 [91] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:53:16,254 [91] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:53:16,254 [91] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:53:16,255 [91] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:53:16,256 [91] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:53:16,256 [91] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:53:16,257 [91] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:53:16,257 [91] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:53:16,258 [91] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:53:16,258 [91] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:53:16,259 [91] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:53:16,259 [91] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:53:16,260 [91] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:53:16,260 [91] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:53:16,261 [91] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:53:16,261 [91] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:53:16,271 [91] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 47
2021-01-07 10:53:16,273 [91] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path
      from vw_task_allegati a
      where a.task_id = 47
2021-01-07 10:53:26,165 [94] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:53:26,167 [94] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:53:26,168 [94] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:53:26,169 [94] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:53:26,169 [94] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:53:26,170 [94] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:53:26,171 [94] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:53:26,171 [94] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:53:26,172 [94] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:53:26,173 [94] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:53:26,173 [94] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:53:26,174 [94] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:53:26,174 [94] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:53:26,175 [94] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:53:26,175 [94] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:53:26,176 [94] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:53:26,176 [94] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:53:26,177 [94] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:53:26,177 [94] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:53:26,178 [94] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:53:26,179 [94] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:53:26,179 [94] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:53:26,180 [94] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:53:26,180 [94] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:53:26,181 [94] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:53:26,181 [94] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:53:26,193 [94] DEBUG dn_lib.tools.log - SQL: select t.synch_folder_id, t.task_id, t.title, f.folder_id as parent_folder_id, t.folder_id
  , sf.local_path + isnull(replace(dbo.folder_path(t.folder_id), '/', '\'), '') as folder_path
  , t.file_id, ft.type_content, ft.open_comment, ft.close_comment
  , sf.local_path + replace(isnull(dbo.folder_path(f.folder_id), '\') + f.file_name, '/', '\') as file_path
  , tn.file_id as file_id_notes
  , sf.local_path + replace(isnull(dbo.folder_path(fn.folder_id), '\') + fn.file_name, '/', '\') as file_path_notes
 from dn_tasks t
 left join synch_folders sf on sf.synch_folder_id = t.synch_folder_id
 left join dn_files f on f.file_id = t.file_id
 left join dn_files_types ft on ft.extension = f.extension
 left join dn_tasks_notes tn on tn.task_id = t.task_id
 left join dn_files fn on fn.file_id = tn.file_id
 where t.task_id = 47
2021-01-07 10:53:26,205 [94] DEBUG dn_lib.tools.log - SQL: delete from dn_files_contents where file_id = 15;
        insert into dn_files_contents (file_id, extension, content, dt_ins, dt_upd)
          values (15, '.txt', @content, convert(datetime, '2021-01-07 10:53:26', 120), convert(datetime, '2021-01-07 10:53:26', 120));
2021-01-07 10:53:26,219 [94] DEBUG dn_lib.tools.log - SQL: delete from dn_tasks_notes where task_id = 47;
      insert into dn_tasks_notes (task_id, file_id, content, dt_ins, dt_upd)
        values (47, 15, @content
          , convert(datetime, convert(varchar, getdate(), 120), 120), convert(datetime, convert(varchar, getdate(), 120), 120));
      update dn_tasks set dt_upd = convert(datetime, convert(varchar, getdate(), 120), 120) where task_id = 47;
2021-01-07 10:53:31,903 [96] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:53:31,904 [96] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:53:31,905 [96] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:53:31,906 [96] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:53:31,907 [96] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:53:31,907 [96] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:53:31,908 [96] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:53:31,908 [96] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:53:31,909 [96] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:53:31,909 [96] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:53:31,910 [96] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:53:31,910 [96] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:53:31,911 [96] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:53:31,912 [96] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:53:31,913 [96] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:53:31,913 [96] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:53:31,914 [96] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:53:31,914 [96] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:53:31,915 [96] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:53:31,915 [96] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:53:31,916 [96] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:53:31,916 [96] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:53:31,917 [96] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:53:31,917 [96] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:53:31,918 [96] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:53:31,918 [96] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:53:31,930 [121] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:53:31,931 [121] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:53:31,932 [121] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:53:31,932 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:53:31,933 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:53:31,933 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:53:31,934 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:53:31,934 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:53:31,935 [121] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:53:31,935 [121] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:53:31,935 [121] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:53:31,936 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:53:31,936 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:53:31,936 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:53:31,937 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:53:31,937 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:53:31,937 [121] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:53:31,938 [121] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:53:31,938 [121] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:53:31,939 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:53:31,939 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:53:31,939 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:53:31,940 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:53:31,940 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:53:31,940 [121] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:53:31,941 [121] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:53:31,953 [70] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:53:31,954 [70] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:53:31,955 [70] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:53:31,955 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:53:31,956 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:53:31,956 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:53:31,957 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:53:31,957 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:53:31,958 [70] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:53:31,958 [70] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:53:31,959 [70] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:53:31,959 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:53:31,959 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:53:31,960 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:53:31,961 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:53:31,962 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:53:31,962 [70] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:53:31,963 [70] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:53:31,963 [70] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:53:31,964 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:53:31,964 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:53:31,964 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:53:31,965 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:53:31,965 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:53:31,965 [70] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:53:31,966 [70] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:53:31,975 [70] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'brendon';
declare @sid varchar(100); set @sid = 'hqnkig3t23gul2f1o3qwtsy0';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id, file_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id, t2.file_id
   from (select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 10:53:32,019 [70] ERROR dn_lib.tools.log - declare @txt varchar(max); set @txt = 'brendon';
declare @sid varchar(100); set @sid = 'hqnkig3t23gul2f1o3qwtsy0';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id, file_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id, t2.file_id
   from (select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 10:53:32,020 [70] ERROR dn_lib.tools.log - error
System.Data.SqlClient.SqlException (0x80131904): Non  possibile inserire la riga di chiave duplicata nell'oggetto 'dbo.dn_search_tasks' con indice univoco 'idx_dn_search_tasks'. Valore della chiave duplicata: (8, 47).
L'istruzione  stata interrotta.
   in System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   in System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   in System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   in System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   in System.Data.SqlClient.SqlDataReader.get_MetaData()
   in System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString, Boolean isInternal, Boolean forDescribeParameterEncryption, Boolean shouldCacheForAlwaysEncrypted)
   in System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, Boolean inRetry, SqlDataReader ds, Boolean describeParameterEncryptionRequest)
   in System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry)
   in System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   in System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)
   in System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   in System.Data.Common.DbDataAdapter.Fill(DataTable[] dataTables, Int32 startRecord, Int32 maxRecords, IDbCommand command, CommandBehavior behavior)
   in System.Data.Common.DbDataAdapter.Fill(DataTable dataTable)
   in dn_lib.db.db_provider.open_set(String sql, Boolean throwerr, Boolean dataset, String table_name, Boolean open_key) in C:\root\todd\git\dn\dn_lib\db\db_provider.cs:riga 289
ClientConnectionId:7e45800a-a0f7-4f04-bd00-8f150fe1e383
Error Number:2601,State:1,Class:14
2021-01-07 10:53:32,036 [70] ERROR dn_lib.tools.log - error
System.Data.SqlClient.SqlException (0x80131904): Non  possibile inserire la riga di chiave duplicata nell'oggetto 'dbo.dn_search_tasks' con indice univoco 'idx_dn_search_tasks'. Valore della chiave duplicata: (8, 47).
L'istruzione  stata interrotta.
   in dn_lib.db.db_provider.open_set(String sql, Boolean throwerr, Boolean dataset, String table_name, Boolean open_key) in C:\root\todd\git\dn\dn_lib\db\db_provider.cs:riga 291
   in dn_lib.db.db_provider.data_table(String sql, String table_name, Boolean throwerr, Boolean open_key) in C:\root\todd\git\dn\dn_lib\db\db_provider.cs:riga 267
   in dn_lib.db.db_provider.dt_table(String sql, Boolean throwerr, Boolean open_key) in C:\root\todd\git\dn\dn_lib\db\db_provider.cs:riga 242
   in dn_lib.db.db_provider.first_row(String sql, Boolean throwerr, Boolean open_key) in C:\root\todd\git\dn\dn_lib\db\db_provider.cs:riga 246
   in deepanotes.notes.search_task(String text, String session_id, Int32& cc) in c:\root\todd\git\dn\deepanotes\App_Code\notes.cs:riga 711
   in _notes.OnInit(EventArgs e) in c:\root\todd\git\dn\deepanotes\notes.aspx.cs:riga 259
ClientConnectionId:7e45800a-a0f7-4f04-bd00-8f150fe1e383
Error Number:2601,State:1,Class:14
2021-01-07 10:54:19,758 [94] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:54:19,758 [94] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:19,759 [94] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:19,760 [94] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:19,761 [94] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:19,761 [94] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:19,762 [94] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:19,763 [94] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:19,764 [94] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:19,765 [94] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:19,765 [94] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:19,766 [94] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:19,768 [94] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:19,768 [94] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:19,768 [94] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:19,769 [94] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:19,770 [94] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:19,771 [94] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:19,771 [94] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:19,772 [94] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:19,772 [94] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:19,773 [94] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:19,773 [94] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:19,774 [94] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:19,775 [94] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:19,775 [94] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:54:19,786 [94] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'brendon';
declare @sid varchar(100); set @sid = 'hqnkig3t23gul2f1o3qwtsy0';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id, file_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id, t2.file_id
   from (select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 10:54:19,806 [94] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:54:19,808 [94] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:54:19,810 [94] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:54:19,811 [94] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:54:19,813 [94] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 8 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:54:19,827 [94] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 8 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:54:19,849 [94] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 8 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 10:54:19,864 [94] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:54:19,866 [94] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:54:19,868 [94] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:54:19,871 [94] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:54:19,874 [94] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:54:24,312 [96] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:54:24,314 [96] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:24,315 [96] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:24,316 [96] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:24,317 [96] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:24,317 [96] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:24,318 [96] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:24,319 [96] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:24,320 [96] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:24,321 [96] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:24,321 [96] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:24,322 [96] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:24,323 [96] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:24,323 [96] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:24,324 [96] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:24,325 [96] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:24,325 [96] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:24,326 [96] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:24,326 [96] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:24,327 [96] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:24,327 [96] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:24,328 [96] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:24,328 [96] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:24,329 [96] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:24,329 [96] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:24,330 [96] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:54:24,340 [96] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'brendon';
declare @sid varchar(100); set @sid = 'hqnkig3t23gul2f1o3qwtsy0';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id, file_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id, t2.file_id
   from (select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 10:54:24,341 [96] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:54:24,342 [96] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:54:24,343 [96] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:54:24,344 [96] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:54:24,344 [96] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 8 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:54:24,345 [96] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 8 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:54:24,347 [96] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 8 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 10:54:24,348 [96] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:54:24,349 [96] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:54:24,349 [96] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:54:24,350 [96] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:54:24,351 [96] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:54:34,260 [93] INFO dn_lib.tools.log - reload core
2021-01-07 10:54:34,283 [93] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:54:34,284 [93] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:34,285 [93] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:34,286 [93] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:34,287 [93] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:34,287 [93] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:34,288 [93] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:34,289 [93] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:34,289 [93] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:34,290 [93] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:34,290 [93] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:34,290 [93] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:34,291 [93] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:34,291 [93] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:34,292 [93] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:34,292 [93] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:34,293 [93] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:34,293 [93] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:34,297 [93] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:34,299 [93] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:34,299 [93] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:34,301 [93] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:34,302 [93] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:34,302 [93] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:34,303 [93] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:34,304 [93] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:54:34,335 [89] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:54:34,336 [89] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:34,336 [89] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:34,337 [89] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:34,338 [89] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:34,339 [89] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:34,340 [89] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:34,340 [89] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:34,341 [89] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:34,342 [89] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:34,342 [89] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:34,343 [89] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:34,344 [89] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:34,344 [89] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:34,345 [89] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:34,345 [89] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:34,346 [89] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:34,346 [89] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:34,346 [89] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:34,347 [89] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:34,347 [89] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:34,348 [89] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:34,348 [89] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:34,349 [89] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:34,349 [89] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:34,350 [89] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:54:34,370 [108] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:54:34,371 [108] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:34,372 [108] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:34,373 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:34,374 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:34,374 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:34,375 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:34,375 [108] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:34,376 [108] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:34,376 [108] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:34,377 [108] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:34,377 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:34,378 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:34,378 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:34,379 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:34,379 [108] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:34,379 [108] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:34,380 [108] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:34,380 [108] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:34,381 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:34,381 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:34,382 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:34,382 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:34,383 [108] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:34,383 [108] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:34,385 [108] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:54:34,407 [108] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:54:34,409 [108] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:54:34,411 [108] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:54:34,411 [108] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:54:34,412 [108] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:54:34,421 [108] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:54:34,428 [108] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1  and t3.stato = 'in_corso' or t3.diff_days = 1
2021-01-07 10:54:34,445 [108] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:54:34,450 [108] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:54:34,492 [108] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:54:34,494 [108] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:54:34,495 [108] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:54:38,893 [70] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:54:38,895 [70] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:38,896 [70] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:38,897 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:38,898 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:38,898 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:38,899 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:38,900 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:38,901 [70] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:38,902 [70] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:38,902 [70] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:38,903 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:38,903 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:38,903 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:38,904 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:38,904 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:38,904 [70] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:38,905 [70] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:38,905 [70] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:38,905 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:38,906 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:38,906 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:38,907 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:38,907 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:38,907 [70] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:38,908 [70] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:54:38,921 [121] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:54:38,921 [121] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:38,922 [121] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:38,923 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:38,923 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:38,924 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:38,924 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:38,925 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:38,926 [121] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:38,926 [121] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:38,927 [121] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:38,927 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:38,928 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:38,928 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:38,929 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:38,929 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:38,930 [121] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:38,930 [121] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:38,931 [121] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:38,931 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:38,931 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:38,932 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:38,932 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:38,933 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:38,933 [121] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:38,935 [121] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:54:38,945 [96] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:54:38,946 [96] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:38,947 [96] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:38,947 [96] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:38,948 [96] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:38,948 [96] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:38,949 [96] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:38,951 [96] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:38,951 [96] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:38,952 [96] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:38,953 [96] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:38,953 [96] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:38,954 [96] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:38,955 [96] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:38,955 [96] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:38,956 [96] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:38,956 [96] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:38,957 [96] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:38,957 [96] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:38,958 [96] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:38,958 [96] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:38,959 [96] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:38,959 [96] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:38,959 [96] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:38,960 [96] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:38,960 [96] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:54:38,970 [96] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'brendon';
declare @sid varchar(100); set @sid = 'sdgwdzxfgenko304v145mi5c';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id, file_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id, t2.file_id
   from (select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%') t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 10:54:39,012 [96] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:54:39,014 [96] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:54:39,015 [96] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:54:39,016 [96] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:54:39,017 [96] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 9 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:54:39,033 [96] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 9 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:54:39,055 [96] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 9 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 10:54:39,071 [96] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:54:39,075 [96] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:54:39,076 [96] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:54:39,077 [96] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:54:39,078 [96] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:54:58,555 [89] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:54:58,557 [89] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:58,558 [89] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:58,558 [89] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:58,559 [89] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:58,559 [89] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:58,560 [89] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:58,561 [89] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:58,561 [89] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:58,562 [89] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:58,562 [89] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:58,563 [89] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:58,563 [89] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:58,564 [89] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:58,564 [89] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:58,565 [89] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:58,565 [89] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:58,567 [89] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:54:58,567 [89] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:54:58,568 [89] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:54:58,568 [89] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:54:58,568 [89] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:54:58,569 [89] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:54:58,569 [89] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:54:58,570 [89] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:54:58,571 [89] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:54:58,580 [89] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 47
2021-01-07 10:54:58,582 [89] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path
      from vw_task_allegati a
      where a.task_id = 47
2021-01-07 10:59:36,342 [84] INFO dn_lib.tools.log - reload core
2021-01-07 10:59:36,373 [84] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:59:36,374 [84] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:59:36,375 [84] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:59:36,375 [84] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:59:36,376 [84] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:59:36,377 [84] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:59:36,377 [84] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:59:36,378 [84] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:59:36,379 [84] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:59:36,379 [84] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:59:36,380 [84] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:59:36,380 [84] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:59:36,380 [84] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:59:36,381 [84] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:59:36,381 [84] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:59:36,381 [84] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:59:36,382 [84] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:59:36,382 [84] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:59:36,387 [84] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:59:36,389 [84] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:59:36,390 [84] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:59:36,390 [84] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:59:36,391 [84] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:59:36,392 [84] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:59:36,393 [84] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:59:36,394 [84] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:59:36,424 [89] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:59:36,425 [89] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:59:36,426 [89] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:59:36,427 [89] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:59:36,428 [89] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:59:36,428 [89] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:59:36,429 [89] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:59:36,429 [89] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:59:36,430 [89] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:59:36,431 [89] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:59:36,431 [89] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:59:36,432 [89] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:59:36,433 [89] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:59:36,433 [89] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:59:36,434 [89] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:59:36,435 [89] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:59:36,436 [89] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:59:36,437 [89] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:59:36,438 [89] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:59:36,439 [89] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:59:36,440 [89] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:59:36,441 [89] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:59:36,441 [89] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:59:36,442 [89] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:59:36,442 [89] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:59:36,443 [89] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:59:36,465 [87] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:59:36,466 [87] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:59:36,467 [87] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:59:36,468 [87] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:59:36,469 [87] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:59:36,469 [87] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:59:36,470 [87] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:59:36,471 [87] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:59:36,471 [87] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:59:36,471 [87] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:59:36,472 [87] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:59:36,472 [87] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:59:36,473 [87] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:59:36,473 [87] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:59:36,473 [87] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:59:36,474 [87] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:59:36,474 [87] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:59:36,475 [87] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:59:36,475 [87] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:59:36,475 [87] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:59:36,476 [87] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:59:36,476 [87] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:59:36,477 [87] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:59:36,477 [87] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:59:36,477 [87] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:59:36,486 [87] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:59:36,508 [87] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:59:36,511 [87] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:59:36,513 [87] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:59:36,515 [87] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:59:36,516 [87] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:59:36,527 [87] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:59:36,534 [87] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1  and t3.stato = 'in_corso' or t3.diff_days = 1
2021-01-07 10:59:36,553 [87] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:59:36,559 [87] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:59:36,608 [87] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:59:36,610 [87] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:59:36,613 [87] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 10:59:50,781 [121] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:59:50,783 [121] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:59:50,785 [121] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:59:50,786 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:59:50,786 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:59:50,787 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:59:50,788 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:59:50,788 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:59:50,789 [121] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:59:50,789 [121] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:59:50,790 [121] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:59:50,790 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:59:50,790 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:59:50,791 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:59:50,791 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:59:50,792 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:59:50,792 [121] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:59:50,793 [121] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:59:50,793 [121] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:59:50,794 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:59:50,794 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:59:50,795 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:59:50,795 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:59:50,796 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:59:50,796 [121] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:59:50,797 [121] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:59:50,811 [85] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:59:50,812 [85] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:59:50,813 [85] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:59:50,813 [85] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:59:50,814 [85] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:59:50,815 [85] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:59:50,816 [85] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:59:50,818 [85] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:59:50,818 [85] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:59:50,819 [85] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:59:50,819 [85] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:59:50,820 [85] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:59:50,820 [85] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:59:50,821 [85] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:59:50,821 [85] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:59:50,821 [85] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:59:50,822 [85] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:59:50,822 [85] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:59:50,822 [85] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:59:50,823 [85] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:59:50,823 [85] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:59:50,824 [85] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:59:50,824 [85] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:59:50,824 [85] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:59:50,825 [85] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:59:50,825 [85] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:59:50,835 [87] INFO dn_lib.tools.log - reload config docs
2021-01-07 10:59:50,836 [87] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:59:50,837 [87] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:59:50,837 [87] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:59:50,838 [87] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:59:50,839 [87] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:59:50,840 [87] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:59:50,840 [87] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:59:50,841 [87] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:59:50,841 [87] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:59:50,842 [87] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:59:50,842 [87] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:59:50,843 [87] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:59:50,843 [87] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:59:50,843 [87] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:59:50,844 [87] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:59:50,844 [87] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:59:50,844 [87] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 10:59:50,845 [87] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 10:59:50,845 [87] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 10:59:50,846 [87] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 10:59:50,846 [87] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 10:59:50,846 [87] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 10:59:50,847 [87] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 10:59:50,847 [87] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 10:59:50,848 [87] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 10:59:50,857 [87] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'brendon';
declare @sid varchar(100); set @sid = 'nw1kiumdkmjvxjfbjrkvwzeq';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id, file_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id, t2.file_id
   from (select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)) t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 10:59:50,895 [87] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 10:59:50,897 [87] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:59:50,899 [87] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:59:50,901 [87] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 10:59:50,903 [87] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 10 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 10:59:50,920 [87] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 10 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 10:59:50,943 [87] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 10 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 10:59:50,961 [87] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 10:59:50,964 [87] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 10:59:50,966 [87] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 10:59:50,970 [87] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 10:59:50,971 [87] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 11:02:45,123 [92] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:02:45,124 [92] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:02:45,125 [92] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:02:45,126 [92] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:02:45,127 [92] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:02:45,128 [92] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:02:45,128 [92] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:02:45,129 [92] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:02:45,129 [92] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:02:45,131 [92] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:02:45,131 [92] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:02:45,131 [92] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:02:45,131 [92] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:02:45,132 [92] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:02:45,132 [92] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:02:45,133 [92] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:02:45,133 [92] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:02:45,134 [92] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:02:45,134 [92] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:02:45,135 [92] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:02:45,135 [92] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:02:45,136 [92] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:02:45,137 [92] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:02:45,138 [92] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:02:45,139 [92] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:02:45,139 [92] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:02:45,148 [92] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'brendon';
declare @sid varchar(100); set @sid = 'nw1kiumdkmjvxjfbjrkvwzeq';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id, file_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id, t2.file_id
   from (select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)) t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 11:02:45,172 [92] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 11:02:45,175 [92] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:02:45,178 [92] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:02:45,179 [92] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:02:45,180 [92] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 10 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 11:02:45,196 [92] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 10 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 11:02:45,217 [92] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 10 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 11:02:45,236 [92] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 11:02:45,241 [92] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 11:02:45,243 [92] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 11:02:45,245 [92] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 11:02:45,247 [92] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 11:02:45,938 [89] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:02:45,939 [89] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:02:45,940 [89] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:02:45,940 [89] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:02:45,941 [89] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:02:45,942 [89] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:02:45,943 [89] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:02:45,944 [89] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:02:45,945 [89] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:02:45,945 [89] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:02:45,946 [89] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:02:45,946 [89] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:02:45,947 [89] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:02:45,948 [89] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:02:45,948 [89] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:02:45,949 [89] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:02:45,950 [89] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:02:45,950 [89] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:02:45,951 [89] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:02:45,951 [89] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:02:45,952 [89] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:02:45,952 [89] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:02:45,953 [89] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:02:45,953 [89] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:02:45,954 [89] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:02:45,955 [89] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:02:45,964 [89] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'brendon';
declare @sid varchar(100); set @sid = 'nw1kiumdkmjvxjfbjrkvwzeq';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id, file_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id, t2.file_id
   from (select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)) t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 11:02:45,966 [89] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 11:02:45,967 [89] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:02:45,968 [89] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:02:45,969 [89] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:02:45,970 [89] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 10 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 11:02:45,972 [89] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 10 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 11:02:45,974 [89] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join dn_search_tasks st on st.search_id = 10 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 11:02:45,976 [89] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 11:02:45,979 [89] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 11:02:45,980 [89] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 11:02:45,981 [89] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 11:02:45,982 [89] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 11:03:02,472 [121] INFO dn_lib.tools.log - reload core
2021-01-07 11:03:02,504 [121] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:03:02,506 [121] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:03:02,507 [121] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:03:02,508 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:03:02,509 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:03:02,510 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:03:02,519 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:03:02,520 [121] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:03:02,522 [121] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:03:02,523 [121] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:03:02,524 [121] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:03:02,526 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:03:02,526 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:03:02,527 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:03:02,528 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:03:02,529 [121] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:03:02,530 [121] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:03:02,530 [121] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:03:02,537 [121] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:03:02,538 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:03:02,539 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:03:02,540 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:03:02,541 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:03:02,542 [121] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:03:02,543 [121] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:03:02,547 [121] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:03:02,577 [121] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'brendon';
declare @sid varchar(100); set @sid = 'nw1kiumdkmjvxjfbjrkvwzeq';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id, file_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id, t2.file_id
   from (select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)) t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 11:03:02,602 [121] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 11:03:02,606 [121] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:03:02,608 [121] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:03:02,609 [121] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:03:02,613 [121] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 10 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 11:03:02,631 [121] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 10 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 11:03:02,655 [121] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join (select distinct search_id, task_id from dn_search_tasks) st on st.search_id = 10 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 11:03:02,678 [121] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 11:03:02,689 [121] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 11:03:02,765 [121] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 11:03:02,768 [121] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 11:03:02,771 [121] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 11:03:11,132 [70] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:03:11,133 [70] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:03:11,134 [70] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:03:11,136 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:03:11,136 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:03:11,136 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:03:11,137 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:03:11,138 [70] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:03:11,139 [70] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:03:11,140 [70] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:03:11,140 [70] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:03:11,141 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:03:11,141 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:03:11,142 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:03:11,142 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:03:11,143 [70] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:03:11,143 [70] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:03:11,144 [70] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:03:11,144 [70] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:03:11,145 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:03:11,145 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:03:11,146 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:03:11,146 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:03:11,147 [70] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:03:11,147 [70] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:03:11,148 [70] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:03:11,189 [70] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 47
2021-01-07 11:03:11,191 [70] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path
      from vw_task_allegati a
      where a.task_id = 47
2021-01-07 11:24:15,607 [7] INFO dn_lib.tools.log - reload core
2021-01-07 11:24:15,638 [7] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:24:15,640 [7] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:24:15,641 [7] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:24:15,642 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:24:15,643 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:24:15,650 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:24:15,659 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:24:15,661 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:24:15,663 [7] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:24:15,664 [7] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:24:15,665 [7] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:24:15,666 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:24:15,667 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:24:15,668 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:24:15,669 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:24:15,669 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:24:15,670 [7] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:24:15,671 [7] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:24:15,676 [7] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:24:15,678 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:24:15,680 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:24:15,681 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:24:15,683 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:24:15,684 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:24:15,685 [7] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:24:15,697 [7] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:24:15,752 [7] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'brendon';
declare @sid varchar(100); set @sid = 'nw1kiumdkmjvxjfbjrkvwzeq';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id, file_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id, t2.file_id
   from (select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)) t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 11:24:15,776 [7] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 11:24:15,781 [7] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:24:15,783 [7] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:24:15,784 [7] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:24:15,788 [7] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 10 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 11:24:15,807 [7] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , (select top 1 1 from dn_search_tasks where search_id = 10 and file_id = f.file_id) as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 10 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 11:24:15,840 [7] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join (select distinct search_id, task_id from dn_search_tasks) st on st.search_id = 10 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 11:24:15,874 [7] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 11:24:15,891 [7] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 11:24:15,982 [7] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 11:24:15,985 [7] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 11:24:15,989 [7] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 11:24:18,173 [7] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:24:18,175 [7] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:24:18,176 [7] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:24:18,177 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:24:18,178 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:24:18,179 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:24:18,180 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:24:18,180 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:24:18,181 [7] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:24:18,181 [7] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:24:18,182 [7] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:24:18,182 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:24:18,183 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:24:18,183 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:24:18,184 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:24:18,184 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:24:18,185 [7] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:24:18,185 [7] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:24:18,186 [7] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:24:18,186 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:24:18,187 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:24:18,187 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:24:18,188 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:24:18,188 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:24:18,190 [7] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:24:18,190 [7] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:24:18,236 [7] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 47
2021-01-07 11:24:18,238 [7] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path , (select top 1 1 from dn_search_tasks where search_id = 10 and file_id = f.file_id) as found_file       
      from vw_task_allegati a
      where a.task_id = 47
2021-01-07 11:24:18,250 [7] ERROR dn_lib.tools.log - select a.file_id, a.file_name, a.extension, a.http_path , (select top 1 1 from dn_search_tasks where search_id = 10 and file_id = f.file_id) as found_file       
      from vw_task_allegati a
      where a.task_id = 47
2021-01-07 11:24:18,251 [7] ERROR dn_lib.tools.log - error
System.Data.SqlClient.SqlException (0x80131904): Impossibile associare l'identificatore in pi parti "f.file_id".
   in System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   in System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   in System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   in System.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   in System.Data.SqlClient.SqlDataReader.get_MetaData()
   in System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString, Boolean isInternal, Boolean forDescribeParameterEncryption, Boolean shouldCacheForAlwaysEncrypted)
   in System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async, Int32 timeout, Task& task, Boolean asyncWrite, Boolean inRetry, SqlDataReader ds, Boolean describeParameterEncryptionRequest)
   in System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry)
   in System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   in System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)
   in System.Data.Common.DbDataAdapter.FillInternal(DataSet dataset, DataTable[] datatables, Int32 startRecord, Int32 maxRecords, String srcTable, IDbCommand command, CommandBehavior behavior)
   in System.Data.Common.DbDataAdapter.Fill(DataTable[] dataTables, Int32 startRecord, Int32 maxRecords, IDbCommand command, CommandBehavior behavior)
   in System.Data.Common.DbDataAdapter.Fill(DataTable dataTable)
   in dn_lib.db.db_provider.open_set(String sql, Boolean throwerr, Boolean dataset, String table_name, Boolean open_key) in C:\root\todd\git\dn\dn_lib\db\db_provider.cs:riga 289
ClientConnectionId:1caaacb1-d6d5-4ef2-bcab-b088b6c15cd6
Error Number:4104,State:1,Class:16
2021-01-07 11:24:18,268 [7] ERROR dn_lib.tools.log - error
System.Data.SqlClient.SqlException (0x80131904): Impossibile associare l'identificatore in pi parti "f.file_id".
   in dn_lib.db.db_provider.open_set(String sql, Boolean throwerr, Boolean dataset, String table_name, Boolean open_key) in C:\root\todd\git\dn\dn_lib\db\db_provider.cs:riga 291
   in dn_lib.db.db_provider.data_table(String sql, String table_name, Boolean throwerr, Boolean open_key) in C:\root\todd\git\dn\dn_lib\db\db_provider.cs:riga 267
   in dn_lib.db.db_provider.dt_table(String sql, Boolean throwerr, Boolean open_key) in C:\root\todd\git\dn\dn_lib\db\db_provider.cs:riga 242
   in deepanotes.notes.get_task_allegati(Int32 task_id, Nullable`1 search_id) in c:\root\todd\git\dn\deepanotes\App_Code\notes.cs:riga 356
   in _notes.OnInit(EventArgs e) in c:\root\todd\git\dn\deepanotes\notes.aspx.cs:riga 227
ClientConnectionId:1caaacb1-d6d5-4ef2-bcab-b088b6c15cd6
Error Number:4104,State:1,Class:16
2021-01-07 11:24:55,394 [9] INFO dn_lib.tools.log - reload core
2021-01-07 11:24:55,425 [9] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:24:55,426 [9] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:24:55,428 [9] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:24:55,428 [9] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:24:55,429 [9] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:24:55,431 [9] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:24:55,432 [9] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:24:55,433 [9] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:24:55,434 [9] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:24:55,435 [9] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:24:55,436 [9] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:24:55,437 [9] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:24:55,438 [9] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:24:55,439 [9] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:24:55,440 [9] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:24:55,440 [9] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:24:55,441 [9] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:24:55,442 [9] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:24:55,447 [9] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:24:55,449 [9] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:24:55,450 [9] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:24:55,451 [9] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:24:55,452 [9] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:24:55,453 [9] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:24:55,453 [9] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:24:55,458 [9] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:24:55,491 [9] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'brendon';
declare @sid varchar(100); set @sid = 'nw1kiumdkmjvxjfbjrkvwzeq';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id, file_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id, t2.file_id
   from (select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)) t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 11:24:55,518 [9] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 11:24:55,522 [9] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:24:55,524 [9] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:24:55,525 [9] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:24:55,529 [9] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 10 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 11:24:55,547 [9] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , (select top 1 1 from dn_search_tasks where search_id = 10 and file_id = f.file_id) as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 10 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 11:24:55,571 [9] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join (select distinct search_id, task_id from dn_search_tasks) st on st.search_id = 10 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 11:24:55,595 [9] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 11:24:55,605 [9] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 11:24:55,687 [9] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 11:24:55,691 [9] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 11:24:55,694 [9] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 11:24:57,836 [13] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:24:57,837 [13] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:24:57,839 [13] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:24:57,840 [13] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:24:57,841 [13] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:24:57,842 [13] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:24:57,843 [13] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:24:57,844 [13] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:24:57,844 [13] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:24:57,845 [13] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:24:57,846 [13] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:24:57,846 [13] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:24:57,847 [13] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:24:57,847 [13] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:24:57,848 [13] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:24:57,849 [13] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:24:57,849 [13] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:24:57,850 [13] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:24:57,850 [13] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:24:57,851 [13] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:24:57,851 [13] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:24:57,852 [13] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:24:57,852 [13] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:24:57,853 [13] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:24:57,853 [13] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:24:57,854 [13] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:24:57,898 [13] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 47
2021-01-07 11:24:57,901 [13] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path , (select top 1 1 from dn_search_tasks where search_id = 10 and file_id = a.file_id) as found_file       
      from vw_task_allegati a
      where a.task_id = 47
2021-01-07 11:28:21,757 [11] INFO dn_lib.tools.log - reload core
2021-01-07 11:28:21,791 [11] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:28:21,793 [11] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:28:21,794 [11] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:28:21,795 [11] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:28:21,797 [11] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:28:21,798 [11] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:28:21,809 [11] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:28:21,811 [11] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:28:21,812 [11] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:28:21,813 [11] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:28:21,814 [11] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:28:21,815 [11] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:28:21,816 [11] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:28:21,817 [11] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:28:21,818 [11] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:28:21,818 [11] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:28:21,819 [11] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:28:21,819 [11] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:28:21,826 [11] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:28:21,828 [11] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:28:21,829 [11] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:28:21,830 [11] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:28:21,830 [11] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:28:21,831 [11] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:28:21,831 [11] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:28:21,843 [11] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:28:21,875 [11] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'brendon';
declare @sid varchar(100); set @sid = 'nw1kiumdkmjvxjfbjrkvwzeq';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id, file_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id, t2.file_id
   from (select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)) t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 11:28:21,900 [11] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 11:28:21,904 [11] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:28:21,907 [11] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:28:21,908 [11] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:28:21,913 [11] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 10 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 11:28:21,931 [11] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , (select top 1 1 from dn_search_tasks where search_id = 10 and file_id = f.file_id) as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 10 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 11:28:21,959 [11] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join (select distinct search_id, task_id from dn_search_tasks) st on st.search_id = 10 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 11:28:21,985 [11] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 11:28:21,998 [11] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 11:28:22,083 [11] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 11:28:22,086 [11] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 11:28:22,089 [11] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 11:28:23,928 [32] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:28:23,929 [32] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:28:23,930 [32] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:28:23,930 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:28:23,931 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:28:23,932 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:28:23,932 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:28:23,933 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:28:23,933 [32] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:28:23,934 [32] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:28:23,934 [32] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:28:23,935 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:28:23,935 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:28:23,936 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:28:23,937 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:28:23,937 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:28:23,938 [32] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:28:23,939 [32] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:28:23,940 [32] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:28:23,940 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:28:23,941 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:28:23,941 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:28:23,942 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:28:23,943 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:28:23,943 [32] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:28:23,944 [32] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:28:23,991 [32] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 47
2021-01-07 11:28:23,993 [32] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path , (select top 1 1 from dn_search_tasks where search_id = 10 and file_id = a.file_id) as found_file       
      from vw_task_allegati a
      where a.task_id = 47
2021-01-07 11:28:28,426 [31] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:28:28,428 [31] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:28:28,429 [31] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:28:28,431 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:28:28,432 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:28:28,434 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:28:28,435 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:28:28,437 [31] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:28:28,438 [31] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:28:28,439 [31] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:28:28,440 [31] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:28:28,441 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:28:28,442 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:28:28,442 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:28:28,443 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:28:28,444 [31] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:28:28,445 [31] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:28:28,445 [31] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:28:28,445 [31] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:28:28,446 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:28:28,446 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:28:28,447 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:28:28,447 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:28:28,448 [31] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:28:28,448 [31] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:28:28,449 [31] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:28:31,769 [32] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:28:31,771 [32] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:28:31,773 [32] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:28:31,774 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:28:31,776 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:28:31,777 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:28:31,778 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:28:31,779 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:28:31,780 [32] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:28:31,781 [32] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:28:31,782 [32] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:28:31,782 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:28:31,783 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:28:31,784 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:28:31,784 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:28:31,785 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:28:31,785 [32] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:28:31,786 [32] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:28:31,786 [32] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:28:31,787 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:28:31,788 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:28:31,788 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:28:31,789 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:28:31,789 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:28:31,790 [32] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:28:31,790 [32] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:28:35,172 [9] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:28:35,174 [9] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:28:35,176 [9] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:28:35,177 [9] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:28:35,179 [9] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:28:35,180 [9] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:28:35,181 [9] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:28:35,182 [9] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:28:35,183 [9] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:28:35,184 [9] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:28:35,184 [9] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:28:35,185 [9] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:28:35,185 [9] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:28:35,187 [9] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:28:35,187 [9] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:28:35,187 [9] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:28:35,188 [9] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:28:35,188 [9] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:28:35,189 [9] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:28:35,190 [9] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:28:35,190 [9] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:28:35,191 [9] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:28:35,191 [9] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:28:35,193 [9] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:28:35,193 [9] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:28:35,194 [9] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:28:39,117 [14] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:28:39,118 [14] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:28:39,120 [14] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:28:39,122 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:28:39,123 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:28:39,125 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:28:39,126 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:28:39,126 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:28:39,127 [14] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:28:39,128 [14] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:28:39,129 [14] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:28:39,130 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:28:39,130 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:28:39,130 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:28:39,131 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:28:39,132 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:28:39,132 [14] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:28:39,133 [14] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:28:39,133 [14] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:28:39,134 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:28:39,134 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:28:39,135 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:28:39,135 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:28:39,136 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:28:39,137 [14] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:28:39,137 [14] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:34:51,807 [33] INFO dn_lib.tools.log - reload core
2021-01-07 11:34:51,842 [33] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:34:51,844 [33] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:34:51,845 [33] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:34:51,846 [33] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:34:51,847 [33] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:34:51,849 [33] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:34:51,859 [33] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:34:51,861 [33] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:34:51,862 [33] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:34:51,863 [33] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:34:51,865 [33] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:34:51,866 [33] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:34:51,866 [33] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:34:51,868 [33] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:34:51,868 [33] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:34:51,869 [33] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:34:51,870 [33] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:34:51,870 [33] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:34:51,877 [33] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:34:51,879 [33] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:34:51,880 [33] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:34:51,881 [33] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:34:51,882 [33] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:34:51,883 [33] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:34:51,883 [33] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:34:51,885 [33] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:34:51,922 [36] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:34:51,923 [36] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:34:51,924 [36] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:34:51,924 [36] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:34:51,925 [36] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:34:51,925 [36] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:34:51,926 [36] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:34:51,926 [36] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:34:51,927 [36] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:34:51,927 [36] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:34:51,928 [36] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:34:51,929 [36] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:34:51,929 [36] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:34:51,929 [36] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:34:51,930 [36] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:34:51,930 [36] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:34:51,931 [36] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:34:51,931 [36] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:34:51,931 [36] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:34:51,932 [36] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:34:51,932 [36] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:34:51,932 [36] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:34:51,933 [36] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:34:51,933 [36] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:34:51,934 [36] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:34:51,934 [36] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:34:51,966 [34] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:34:51,967 [34] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:34:51,968 [34] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:34:51,969 [34] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:34:51,970 [34] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:34:51,971 [34] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:34:51,972 [34] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:34:51,973 [34] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:34:51,975 [34] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:34:51,976 [34] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:34:51,976 [34] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:34:51,977 [34] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:34:51,978 [34] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:34:51,979 [34] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:34:51,980 [34] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:34:51,980 [34] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:34:51,981 [34] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:34:51,981 [34] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:34:51,982 [34] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:34:51,983 [34] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:34:51,984 [34] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:34:51,985 [34] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:34:51,985 [34] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:34:51,986 [34] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:34:51,986 [34] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:34:51,990 [34] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:34:52,013 [34] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 11:34:52,018 [34] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:34:52,020 [34] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:34:52,021 [34] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:34:52,026 [34] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 0 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 11:34:52,043 [34] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 0 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 11:34:52,066 [34] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join (select distinct search_id, task_id from dn_search_tasks) st on st.search_id = 0 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1  and t3.stato = 'in_corso' or t3.diff_days = 1
2021-01-07 11:34:52,085 [34] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 11:34:52,091 [34] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 11:34:52,170 [34] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 11:34:52,173 [34] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 11:34:52,175 [34] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 11:34:57,354 [9] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:34:57,355 [9] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:34:57,356 [9] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:34:57,357 [9] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:34:57,358 [9] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:34:57,359 [9] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:34:57,360 [9] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:34:57,360 [9] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:34:57,361 [9] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:34:57,362 [9] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:34:57,362 [9] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:34:57,363 [9] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:34:57,364 [9] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:34:57,364 [9] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:34:57,365 [9] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:34:57,366 [9] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:34:57,366 [9] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:34:57,367 [9] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:34:57,368 [9] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:34:57,368 [9] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:34:57,369 [9] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:34:57,369 [9] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:34:57,370 [9] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:34:57,370 [9] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:34:57,371 [9] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:34:57,372 [9] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:34:57,418 [9] DEBUG dn_lib.tools.log - SQL: if not exists (select top 1 1 from users_cache where [user_id] = 0 and var_name = 'active-task-filter')
        insert into users_cache ([user_id], var_name, var_value)
          values (0, 'active-task-filter', '6')
        else update users_cache set var_value = substring('6', 1, 500), dt_upd = getdate()
          where [user_id] = 0 and var_name = 'active-task-filter'
2021-01-07 11:34:57,490 [14] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:34:57,491 [14] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:34:57,492 [14] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:34:57,493 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:34:57,494 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:34:57,495 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:34:57,495 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:34:57,496 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:34:57,497 [14] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:34:57,498 [14] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:34:57,498 [14] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:34:57,500 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:34:57,500 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:34:57,501 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:34:57,501 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:34:57,501 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:34:57,502 [14] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:34:57,502 [14] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:34:57,503 [14] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:34:57,503 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:34:57,504 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:34:57,504 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:34:57,505 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:34:57,506 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:34:57,508 [14] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:34:57,509 [14] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:34:57,519 [14] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 11:34:57,520 [14] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:34:57,521 [14] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 0 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 11:34:57,524 [14] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 0 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 11:34:57,526 [14] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join (select distinct search_id, task_id from dn_search_tasks) st on st.search_id = 0 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 11:34:57,542 [14] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 11:34:57,544 [14] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 11:34:57,545 [14] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 11:34:57,547 [14] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 11:34:57,548 [14] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 11:35:01,753 [23] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:35:01,755 [23] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:35:01,756 [23] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:35:01,757 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:35:01,758 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:35:01,759 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:35:01,760 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:35:01,761 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:35:01,761 [23] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:35:01,762 [23] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:35:01,763 [23] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:35:01,763 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:35:01,764 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:35:01,765 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:35:01,766 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:35:01,766 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:35:01,767 [23] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:35:01,768 [23] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:35:01,769 [23] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:35:01,769 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:35:01,770 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:35:01,770 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:35:01,771 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:35:01,772 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:35:01,772 [23] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:35:01,773 [23] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:35:01,781 [23] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 11:35:01,783 [23] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:35:01,784 [23] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 0 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 11:35:01,785 [23] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 0 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 11:35:01,786 [23] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join (select distinct search_id, task_id from dn_search_tasks) st on st.search_id = 0 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 11:35:01,787 [23] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 11:35:01,789 [23] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 11:35:01,791 [23] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 11:35:01,792 [23] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 11:35:01,793 [23] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 11:35:02,909 [30] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:35:02,911 [30] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:35:02,911 [30] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:35:02,912 [30] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:35:02,912 [30] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:35:02,913 [30] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:35:02,914 [30] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:35:02,914 [30] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:35:02,915 [30] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:35:02,915 [30] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:35:02,916 [30] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:35:02,916 [30] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:35:02,917 [30] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:35:02,917 [30] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:35:02,918 [30] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:35:02,918 [30] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:35:02,919 [30] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:35:02,919 [30] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:35:02,919 [30] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:35:02,920 [30] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:35:02,920 [30] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:35:02,921 [30] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:35:02,922 [30] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:35:02,923 [30] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:35:02,923 [30] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:35:02,924 [30] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:35:02,934 [30] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 11:35:02,935 [30] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:35:02,936 [30] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 0 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 11:35:02,937 [30] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 0 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 11:35:02,939 [30] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join (select distinct search_id, task_id from dn_search_tasks) st on st.search_id = 0 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 11:35:02,941 [30] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 11:35:02,942 [30] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 11:35:02,942 [30] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 11:35:02,943 [30] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 11:35:02,944 [30] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 11:35:15,832 [34] INFO dn_lib.tools.log - reload core
2021-01-07 11:35:15,859 [34] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:35:15,860 [34] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:35:15,861 [34] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:35:15,862 [34] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:35:15,863 [34] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:35:15,865 [34] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:35:15,875 [34] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:35:15,876 [34] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:35:15,877 [34] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:35:15,878 [34] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:35:15,879 [34] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:35:15,880 [34] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:35:15,880 [34] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:35:15,881 [34] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:35:15,882 [34] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:35:15,882 [34] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:35:15,883 [34] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:35:15,884 [34] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:35:15,889 [34] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:35:15,891 [34] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:35:15,892 [34] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:35:15,893 [34] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:35:15,893 [34] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:35:15,894 [34] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:35:15,895 [34] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:35:15,896 [34] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:35:15,926 [33] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:35:15,927 [33] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:35:15,927 [33] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:35:15,928 [33] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:35:15,928 [33] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:35:15,929 [33] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:35:15,930 [33] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:35:15,930 [33] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:35:15,931 [33] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:35:15,931 [33] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:35:15,932 [33] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:35:15,932 [33] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:35:15,933 [33] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:35:15,934 [33] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:35:15,934 [33] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:35:15,935 [33] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:35:15,936 [33] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:35:15,936 [33] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:35:15,937 [33] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:35:15,938 [33] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:35:15,938 [33] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:35:15,939 [33] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:35:15,939 [33] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:35:15,940 [33] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:35:15,940 [33] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:35:15,941 [33] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:35:15,963 [23] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:35:15,964 [23] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:35:15,965 [23] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:35:15,965 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:35:15,966 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:35:15,967 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:35:15,968 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:35:15,970 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:35:15,970 [23] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:35:15,971 [23] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:35:15,972 [23] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:35:15,973 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:35:15,974 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:35:15,975 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:35:15,975 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:35:15,976 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:35:15,976 [23] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:35:15,977 [23] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:35:15,977 [23] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:35:15,978 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:35:15,979 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:35:15,979 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:35:15,980 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:35:15,980 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:35:15,981 [23] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:35:15,982 [23] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:35:16,005 [23] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 11:35:16,010 [23] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:35:16,015 [23] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 0 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 11:35:16,016 [23] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 0 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 11:35:16,018 [23] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join (select distinct search_id, task_id from dn_search_tasks) st on st.search_id = 0 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 11:35:16,020 [23] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 11:35:16,021 [23] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 11:35:16,073 [23] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 11:35:16,074 [23] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 11:35:16,075 [23] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 11:36:44,431 [25] INFO dn_lib.tools.log - reload core
2021-01-07 11:36:44,481 [25] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:36:44,482 [25] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:36:44,485 [25] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:36:44,486 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:36:44,489 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:36:44,491 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:36:44,506 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:36:44,508 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:36:44,509 [25] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:36:44,510 [25] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:36:44,511 [25] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:36:44,511 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:36:44,512 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:36:44,513 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:36:44,513 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:36:44,514 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:36:44,514 [25] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:36:44,515 [25] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:36:44,534 [25] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:36:44,536 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:36:44,538 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:36:44,539 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:36:44,541 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:36:44,541 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:36:44,542 [25] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:36:44,544 [25] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:36:44,620 [14] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:36:44,622 [14] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:36:44,624 [14] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:36:44,625 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:36:44,626 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:36:44,627 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:36:44,628 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:36:44,629 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:36:44,629 [14] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:36:44,630 [14] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:36:44,631 [14] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:36:44,631 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:36:44,632 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:36:44,632 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:36:44,633 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:36:44,634 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:36:44,635 [14] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:36:44,636 [14] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:36:44,637 [14] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:36:44,638 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:36:44,640 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:36:44,640 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:36:44,641 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:36:44,642 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:36:44,642 [14] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:36:44,643 [14] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:36:44,709 [25] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:36:44,710 [25] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:36:44,710 [25] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:36:44,711 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:36:44,712 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:36:44,712 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:36:44,713 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:36:44,714 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:36:44,714 [25] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:36:44,715 [25] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:36:44,715 [25] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:36:44,716 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:36:44,716 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:36:44,717 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:36:44,717 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:36:44,718 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:36:44,719 [25] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:36:44,720 [25] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:36:44,721 [25] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:36:44,722 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:36:44,723 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:36:44,724 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:36:44,725 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:36:44,726 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:36:44,727 [25] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:36:44,728 [25] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:36:44,755 [25] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 11:36:44,761 [25] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:36:50,647 [25] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 0 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 11:36:50,663 [25] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 0 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 11:37:27,073 [25] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join (select distinct search_id, task_id from dn_search_tasks) st on st.search_id = 0 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 11:37:27,096 [25] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 11:37:27,102 [25] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 11:37:27,184 [25] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 11:37:27,187 [25] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 11:37:27,190 [25] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 11:38:06,786 [25] INFO dn_lib.tools.log - reload core
2021-01-07 11:38:06,812 [25] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:38:06,813 [25] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:38:06,814 [25] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:38:06,815 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:38:06,816 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:38:06,818 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:38:06,828 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:38:06,829 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:38:06,831 [25] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:38:06,831 [25] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:38:06,832 [25] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:38:06,833 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:38:06,834 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:38:06,834 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:38:06,835 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:38:06,835 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:38:06,836 [25] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:38:06,836 [25] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:38:06,841 [25] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:38:06,843 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:38:06,844 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:38:06,845 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:38:06,847 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:38:06,847 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:38:06,847 [25] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:38:06,849 [25] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:38:06,883 [50] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:38:06,884 [50] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:38:06,885 [50] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:38:06,886 [50] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:38:06,887 [50] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:38:06,888 [50] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:38:06,889 [50] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:38:06,889 [50] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:38:06,890 [50] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:38:06,891 [50] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:38:06,893 [50] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:38:06,894 [50] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:38:06,894 [50] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:38:06,895 [50] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:38:06,896 [50] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:38:06,896 [50] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:38:06,897 [50] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:38:06,898 [50] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:38:06,898 [50] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:38:06,899 [50] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:38:06,899 [50] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:38:06,900 [50] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:38:06,900 [50] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:38:06,901 [50] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:38:06,901 [50] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:38:06,902 [50] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:38:06,924 [14] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:38:06,926 [14] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:38:06,926 [14] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:38:06,927 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:38:06,928 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:38:06,929 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:38:06,929 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:38:06,930 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:38:06,930 [14] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:38:06,931 [14] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:38:06,932 [14] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:38:06,932 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:38:06,933 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:38:06,933 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:38:06,933 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:38:06,934 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:38:06,935 [14] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:38:06,935 [14] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:38:06,936 [14] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:38:06,936 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:38:06,937 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:38:06,937 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:38:06,938 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:38:06,938 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:38:06,939 [14] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:38:06,942 [14] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:38:06,963 [14] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 11:38:06,966 [14] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:38:06,970 [14] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 0 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 11:38:06,987 [14] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 0 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 11:38:07,018 [14] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 11:38:07,054 [14] ERROR dn_lib.tools.log - error
System.InvalidOperationException: La sequenza non contiene elementi corrispondenti
   in System.Linq.Enumerable.First[TSource](IEnumerable`1 source, Func`2 predicate)
   in deepanotes.notes.load_objects(Nullable`1 folder_id, Nullable`1 synch_folder_id, task_filter tf, Nullable`1 search_id) in c:\root\todd\git\dn\deepanotes\App_Code\notes.cs:riga 52
   in _notes.OnInit(EventArgs e) in c:\root\todd\git\dn\deepanotes\notes.aspx.cs:riga 272
2021-01-07 11:38:30,645 [53] INFO dn_lib.tools.log - reload core
2021-01-07 11:38:30,678 [53] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:38:30,680 [53] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:38:30,681 [53] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:38:30,682 [53] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:38:30,683 [53] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:38:30,684 [53] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:38:30,694 [53] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:38:30,696 [53] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:38:30,697 [53] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:38:30,698 [53] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:38:30,700 [53] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:38:30,700 [53] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:38:30,701 [53] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:38:30,702 [53] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:38:30,702 [53] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:38:30,702 [53] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:38:30,703 [53] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:38:30,704 [53] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:38:30,710 [53] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:38:30,712 [53] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:38:30,713 [53] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:38:30,713 [53] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:38:30,714 [53] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:38:30,715 [53] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:38:30,716 [53] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:38:30,721 [53] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:38:30,751 [53] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 11:38:30,756 [53] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:38:30,760 [53] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 0 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 11:38:30,762 [53] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 0 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 11:38:30,766 [53] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 11:38:30,772 [53] ERROR dn_lib.tools.log - error
System.InvalidOperationException: La sequenza non contiene elementi corrispondenti
   in System.Linq.Enumerable.First[TSource](IEnumerable`1 source, Func`2 predicate)
   in deepanotes.notes.load_objects(Nullable`1 folder_id, Nullable`1 synch_folder_id, task_filter tf, Nullable`1 search_id) in c:\root\todd\git\dn\deepanotes\App_Code\notes.cs:riga 52
   in _notes.OnInit(EventArgs e) in c:\root\todd\git\dn\deepanotes\notes.aspx.cs:riga 272
2021-01-07 11:38:45,666 [52] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:38:45,668 [52] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:38:45,670 [52] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:38:45,671 [52] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:38:45,672 [52] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:38:45,673 [52] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:38:45,674 [52] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:38:45,675 [52] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:38:45,677 [52] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:38:45,677 [52] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:38:45,678 [52] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:38:45,679 [52] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:38:45,679 [52] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:38:45,680 [52] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:38:45,680 [52] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:38:45,681 [52] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:38:45,682 [52] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:38:45,682 [52] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:38:45,683 [52] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:38:45,683 [52] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:38:45,684 [52] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:38:45,684 [52] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:38:45,685 [52] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:38:45,686 [52] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:38:45,686 [52] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:38:45,687 [52] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:38:45,696 [52] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 11:38:45,697 [52] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:38:45,699 [52] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 0 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 11:38:45,700 [52] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 0 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 11:38:45,702 [52] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join (select distinct search_id, task_id from dn_search_tasks) st on st.search_id = 0 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 11:38:45,719 [52] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 11:38:45,725 [52] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 11:38:45,814 [52] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 11:38:45,816 [52] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 11:38:45,819 [52] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 11:39:18,733 [52] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:39:18,734 [52] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:39:18,735 [52] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:39:18,736 [52] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:39:18,737 [52] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:39:18,739 [52] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:39:18,749 [52] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:39:18,750 [52] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:39:18,751 [52] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:39:18,752 [52] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:39:18,752 [52] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:39:18,753 [52] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:39:18,753 [52] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:39:18,754 [52] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:39:18,754 [52] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:39:18,755 [52] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:39:18,755 [52] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:39:18,756 [52] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:39:18,756 [52] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:39:18,757 [52] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:39:18,757 [52] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:39:18,759 [52] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:39:18,760 [52] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:39:18,760 [52] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:39:18,761 [52] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:39:18,762 [52] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:39:18,772 [52] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 11:39:18,774 [52] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:39:18,776 [52] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 0 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 11:39:18,792 [52] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 0 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 11:39:18,815 [52] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 11:39:18,834 [52] ERROR dn_lib.tools.log - error
System.InvalidOperationException: La sequenza non contiene elementi corrispondenti
   in System.Linq.Enumerable.First[TSource](IEnumerable`1 source, Func`2 predicate)
   in deepanotes.notes.load_objects(Nullable`1 folder_id, Nullable`1 synch_folder_id, task_filter tf, Nullable`1 search_id) in c:\root\todd\git\dn\deepanotes\App_Code\notes.cs:riga 52
   in _notes.OnInit(EventArgs e) in c:\root\todd\git\dn\deepanotes\notes.aspx.cs:riga 272
2021-01-07 11:41:49,384 [14] INFO dn_lib.tools.log - reload core
2021-01-07 11:41:49,415 [14] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:41:49,417 [14] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:41:49,418 [14] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:41:49,419 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:41:49,428 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:41:49,430 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:41:49,431 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:41:49,432 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:41:49,433 [14] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:41:49,434 [14] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:41:49,436 [14] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:41:49,437 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:41:49,437 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:41:49,439 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:41:49,440 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:41:49,441 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:41:49,442 [14] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:41:49,443 [14] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:41:49,459 [14] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:41:49,461 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:41:49,462 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:41:49,463 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:41:49,464 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:41:49,465 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:41:49,466 [14] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:41:49,467 [14] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:41:49,524 [25] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:41:49,525 [25] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:41:49,526 [25] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:41:49,527 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:41:49,528 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:41:49,528 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:41:49,529 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:41:49,530 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:41:49,530 [25] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:41:49,531 [25] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:41:49,531 [25] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:41:49,531 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:41:49,532 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:41:49,533 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:41:49,533 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:41:49,534 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:41:49,534 [25] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:41:49,535 [25] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:41:49,535 [25] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:41:49,536 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:41:49,537 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:41:49,537 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:41:49,538 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:41:49,539 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:41:49,539 [25] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:41:49,540 [25] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:41:49,615 [50] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:41:49,616 [50] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:41:49,617 [50] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:41:49,618 [50] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:41:49,619 [50] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:41:49,620 [50] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:41:49,622 [50] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:41:49,624 [50] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:41:49,625 [50] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:41:49,625 [50] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:41:49,626 [50] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:41:49,627 [50] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:41:49,628 [50] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:41:49,629 [50] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:41:49,630 [50] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:41:49,631 [50] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:41:49,631 [50] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:41:49,632 [50] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:41:49,633 [50] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:41:49,634 [50] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:41:49,636 [50] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:41:49,636 [50] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:41:49,637 [50] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:41:49,638 [50] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:41:49,640 [50] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:41:49,644 [50] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:41:49,667 [50] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 11:41:49,673 [50] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:42:00,410 [50] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 0 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 11:42:05,079 [50] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 0 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 11:42:06,702 [50] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join (select distinct search_id, task_id from dn_search_tasks) st on st.search_id = 0 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 11:42:06,723 [50] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 11:42:06,729 [50] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 11:42:06,817 [50] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 11:42:06,819 [50] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 11:42:06,821 [50] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 11:42:25,296 [14] INFO dn_lib.tools.log - reload core
2021-01-07 11:42:25,351 [14] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:42:25,354 [14] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:42:25,355 [14] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:42:25,356 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:42:25,358 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:42:25,360 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:42:25,361 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:42:25,363 [14] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:42:25,364 [14] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:42:25,365 [14] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:42:25,368 [14] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:42:25,369 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:42:25,370 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:42:25,372 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:42:25,372 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:42:25,373 [14] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:42:25,374 [14] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:42:25,374 [14] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:42:25,394 [14] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:42:25,396 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:42:25,399 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:42:25,400 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:42:25,402 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:42:25,403 [14] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:42:25,404 [14] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:42:25,406 [14] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:42:25,498 [50] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:42:25,499 [50] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:42:25,500 [50] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:42:25,502 [50] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:42:25,503 [50] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:42:25,503 [50] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:42:25,504 [50] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:42:25,505 [50] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:42:25,506 [50] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:42:25,507 [50] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:42:25,507 [50] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:42:25,508 [50] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:42:25,509 [50] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:42:25,510 [50] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:42:25,511 [50] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:42:25,511 [50] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:42:25,512 [50] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:42:25,513 [50] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:42:25,514 [50] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:42:25,514 [50] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:42:25,515 [50] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:42:25,517 [50] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:42:25,518 [50] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:42:25,519 [50] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:42:25,520 [50] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:42:25,521 [50] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:42:25,614 [25] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:42:25,616 [25] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:42:25,617 [25] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:42:25,618 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:42:25,619 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:42:25,620 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:42:25,622 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:42:25,623 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:42:25,624 [25] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:42:25,625 [25] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:42:25,626 [25] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:42:25,627 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:42:25,628 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:42:25,629 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:42:25,630 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:42:25,631 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:42:25,633 [25] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:42:25,634 [25] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:42:25,635 [25] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:42:25,636 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:42:25,637 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:42:25,638 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:42:25,638 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:42:25,639 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:42:25,639 [25] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:42:25,644 [25] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:42:25,673 [25] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 11:42:25,680 [25] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:42:48,942 [25] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 0 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 11:43:14,198 [25] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 0 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 11:43:14,232 [25] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join (select distinct search_id, task_id from dn_search_tasks) st on st.search_id = 0 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 11:43:14,266 [25] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 11:43:14,275 [25] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 11:43:14,376 [25] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 11:43:14,379 [25] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 11:43:14,382 [25] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 11:43:57,307 [26] INFO dn_lib.tools.log - reload core
2021-01-07 11:43:57,342 [26] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:43:57,344 [26] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:43:57,345 [26] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:43:57,346 [26] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:43:57,347 [26] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:43:57,355 [26] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:43:57,357 [26] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:43:57,358 [26] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:43:57,359 [26] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:43:57,360 [26] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:43:57,361 [26] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:43:57,362 [26] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:43:57,363 [26] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:43:57,364 [26] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:43:57,365 [26] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:43:57,365 [26] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:43:57,366 [26] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:43:57,367 [26] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:43:57,374 [26] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:43:57,376 [26] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:43:57,377 [26] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:43:57,378 [26] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:43:57,379 [26] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:43:57,380 [26] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:43:57,381 [26] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:43:57,383 [26] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:43:57,413 [19] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:43:57,414 [19] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:43:57,415 [19] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:43:57,415 [19] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:43:57,416 [19] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:43:57,416 [19] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:43:57,417 [19] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:43:57,419 [19] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:43:57,419 [19] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:43:57,420 [19] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:43:57,420 [19] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:43:57,420 [19] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:43:57,420 [19] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:43:57,421 [19] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:43:57,421 [19] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:43:57,422 [19] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:43:57,422 [19] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:43:57,423 [19] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:43:57,423 [19] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:43:57,424 [19] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:43:57,424 [19] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:43:57,425 [19] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:43:57,425 [19] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:43:57,426 [19] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:43:57,426 [19] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:43:57,427 [19] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:43:57,460 [25] INFO dn_lib.tools.log - reload config docs
2021-01-07 11:43:57,461 [25] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:43:57,461 [25] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:43:57,462 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:43:57,462 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:43:57,463 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:43:57,464 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:43:57,464 [25] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:43:57,465 [25] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:43:57,465 [25] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:43:57,466 [25] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:43:57,467 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:43:57,468 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:43:57,469 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:43:57,469 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:43:57,470 [25] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:43:57,470 [25] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:43:57,471 [25] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 11:43:57,471 [25] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 11:43:57,472 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 11:43:57,472 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 11:43:57,473 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 11:43:57,473 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 11:43:57,474 [25] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 11:43:57,475 [25] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 11:43:57,479 [25] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 11:43:57,503 [25] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 11:43:57,508 [25] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 11:43:57,513 [25] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 11:43:57,526 [25] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 11:43:57,537 [25] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 11:43:57,568 [25] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 11:43:57,583 [25] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 11:43:57,675 [25] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 11:43:57,678 [25] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 11:43:57,681 [25] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 15:11:24,094 [7] INFO dn_lib.tools.log - reload core
2021-01-07 15:11:24,128 [7] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:11:24,131 [7] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:11:24,132 [7] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:11:24,134 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:11:24,135 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:11:24,136 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:11:24,145 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:11:24,153 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:11:24,155 [7] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:11:24,156 [7] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:11:24,158 [7] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:11:24,158 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:11:24,158 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:11:24,159 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:11:24,161 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:11:24,161 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:11:24,162 [7] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:11:24,162 [7] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:11:24,169 [7] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:11:24,170 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:11:24,172 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:11:24,175 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:11:24,175 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:11:24,176 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:11:24,177 [7] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:11:24,179 [7] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:11:24,240 [7] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:11:24,241 [7] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:11:24,242 [7] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:11:24,243 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:11:24,243 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:11:24,244 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:11:24,244 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:11:24,245 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:11:24,245 [7] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:11:24,246 [7] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:11:24,246 [7] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:11:24,246 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:11:24,247 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:11:24,247 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:11:24,248 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:11:24,248 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:11:24,249 [7] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:11:24,250 [7] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:11:24,250 [7] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:11:24,251 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:11:24,252 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:11:24,253 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:11:24,254 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:11:24,255 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:11:24,256 [7] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:11:24,258 [7] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:11:24,293 [7] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:11:24,294 [7] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:11:24,295 [7] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:11:24,295 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:11:24,296 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:11:24,297 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:11:24,297 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:11:24,298 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:11:24,298 [7] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:11:24,299 [7] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:11:24,300 [7] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:11:24,300 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:11:24,301 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:11:24,301 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:11:24,302 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:11:24,302 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:11:24,303 [7] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:11:24,303 [7] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:11:24,303 [7] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:11:24,304 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:11:24,305 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:11:24,306 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:11:24,306 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:11:24,307 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:11:24,307 [7] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:11:24,311 [7] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:11:24,334 [7] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 15:11:24,343 [7] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 15:11:24,349 [7] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 15:11:24,365 [7] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 15:11:24,376 [7] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 15:11:24,409 [7] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 15:11:24,433 [7] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 15:11:24,515 [7] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 15:11:24,518 [7] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 15:11:24,521 [7] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 15:11:35,026 [8] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:11:35,027 [8] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:11:35,028 [8] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:11:35,029 [8] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:11:35,030 [8] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:11:35,031 [8] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:11:35,032 [8] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:11:35,032 [8] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:11:35,033 [8] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:11:35,034 [8] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:11:35,034 [8] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:11:35,035 [8] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:11:35,035 [8] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:11:35,037 [8] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:11:35,037 [8] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:11:35,038 [8] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:11:35,039 [8] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:11:35,039 [8] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:11:35,040 [8] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:11:35,041 [8] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:11:35,042 [8] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:11:35,042 [8] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:11:35,043 [8] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:11:35,043 [8] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:11:35,044 [8] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:11:35,045 [8] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:11:35,068 [7] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:11:35,069 [7] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:11:35,070 [7] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:11:35,071 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:11:35,072 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:11:35,073 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:11:35,074 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:11:35,074 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:11:35,075 [7] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:11:35,076 [7] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:11:35,076 [7] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:11:35,078 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:11:35,078 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:11:35,080 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:11:35,080 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:11:35,081 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:11:35,082 [7] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:11:35,083 [7] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:11:35,084 [7] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:11:35,084 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:11:35,085 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:11:35,086 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:11:35,087 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:11:35,088 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:11:35,089 [7] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:11:35,090 [7] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:11:35,106 [7] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:11:35,107 [7] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:11:35,108 [7] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:11:35,108 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:11:35,109 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:11:35,109 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:11:35,110 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:11:35,111 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:11:35,111 [7] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:11:35,112 [7] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:11:35,112 [7] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:11:35,113 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:11:35,113 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:11:35,114 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:11:35,114 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:11:35,115 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:11:35,115 [7] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:11:35,116 [7] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:11:35,116 [7] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:11:35,117 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:11:35,118 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:11:35,118 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:11:35,119 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:11:35,120 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:11:35,120 [7] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:11:35,121 [7] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:11:35,131 [7] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'des';
declare @sid varchar(100); set @sid = 'xf0oefj20m1erwiqf5e1fi52';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id, file_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id, t2.file_id
   from (select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)) t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 15:11:35,161 [7] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 15:11:35,162 [7] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 15:11:35,163 [7] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 11 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 15:11:35,178 [7] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , (select top 1 1 from dn_search_tasks where search_id = 11 and file_id = f.file_id) as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 11 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 15:11:35,200 [7] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join (select distinct search_id, task_id from dn_search_tasks) st on st.search_id = 11 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 15:11:35,220 [7] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 15:11:35,224 [7] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 15:11:35,226 [7] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 15:11:35,227 [7] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 15:11:35,228 [7] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 15:42:04,625 [7] INFO dn_lib.tools.log - reload core
2021-01-07 15:42:04,674 [7] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:42:04,677 [7] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:04,678 [7] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:04,679 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:04,680 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:04,681 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:04,866 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:04,866 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:04,867 [7] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:04,867 [7] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:04,869 [7] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:04,870 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:04,870 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:04,873 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:04,873 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:04,874 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:04,874 [7] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:04,875 [7] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:04,880 [7] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:04,882 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:04,883 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:04,883 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:04,884 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:04,885 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:04,886 [7] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:04,888 [7] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:42:05,011 [7] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:42:05,012 [7] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:05,013 [7] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:05,014 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:05,015 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:05,015 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:05,016 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:05,017 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:05,018 [7] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:05,019 [7] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:05,020 [7] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:05,020 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:05,021 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:05,023 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:05,023 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:05,024 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:05,025 [7] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:05,026 [7] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:05,026 [7] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:05,027 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:05,028 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:05,029 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:05,029 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:05,030 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:05,031 [7] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:05,032 [7] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:42:05,116 [7] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:42:05,116 [7] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:05,117 [7] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:05,118 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:05,119 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:05,119 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:05,120 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:05,121 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:05,123 [7] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:05,124 [7] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:05,124 [7] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:05,125 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:05,126 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:05,127 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:05,129 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:05,130 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:05,130 [7] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:05,131 [7] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:05,132 [7] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:05,133 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:05,134 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:05,135 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:05,136 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:05,137 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:05,139 [7] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:05,146 [7] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:42:05,186 [7] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 15:42:05,194 [7] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 15:42:05,201 [7] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 15:42:05,299 [7] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 15:42:05,369 [7] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 15:42:05,516 [7] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 15:42:05,787 [7] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 15:42:05,877 [7] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 15:42:05,879 [7] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 15:42:05,881 [7] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 15:42:14,727 [7] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:42:14,728 [7] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:14,729 [7] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:14,730 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:14,730 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:14,731 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:14,732 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:14,732 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:14,733 [7] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:14,733 [7] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:14,734 [7] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:14,735 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:14,735 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:14,736 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:14,737 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:14,737 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:14,738 [7] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:14,738 [7] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:14,739 [7] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:14,739 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:14,740 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:14,740 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:14,741 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:14,741 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:14,741 [7] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:14,742 [7] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:42:14,773 [7] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:42:14,774 [7] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:14,775 [7] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:14,775 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:14,776 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:14,776 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:14,777 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:14,777 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:14,778 [7] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:14,778 [7] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:14,779 [7] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:14,779 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:14,780 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:14,780 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:14,781 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:14,781 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:14,782 [7] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:14,782 [7] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:14,783 [7] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:14,783 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:14,783 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:14,784 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:14,784 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:14,785 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:14,785 [7] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:14,786 [7] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:42:14,819 [8] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:42:14,820 [8] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:14,821 [8] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:14,822 [8] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:14,822 [8] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:14,823 [8] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:14,824 [8] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:14,824 [8] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:14,825 [8] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:14,825 [8] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:14,825 [8] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:14,826 [8] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:14,826 [8] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:14,827 [8] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:14,827 [8] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:14,828 [8] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:14,828 [8] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:14,828 [8] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:14,829 [8] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:14,829 [8] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:14,830 [8] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:14,830 [8] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:14,831 [8] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:14,831 [8] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:14,832 [8] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:14,832 [8] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:42:14,843 [8] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'lavorazio';
declare @sid varchar(100); set @sid = 'uuluzis4zmktppx0qysjj2lj';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id, file_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id, t2.file_id
   from (select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)) t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 15:42:15,320 [8] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 15:42:15,321 [8] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 15:42:15,322 [8] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 12 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 15:42:15,371 [8] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , (select top 1 1 from dn_search_tasks where search_id = 12 and file_id = f.file_id) as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 12 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 15:42:15,425 [8] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join (select distinct search_id, task_id from dn_search_tasks) st on st.search_id = 12 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 15:42:15,496 [8] ERROR dn_lib.tools.log - error
System.NullReferenceException: Riferimento a un oggetto non impostato su un'istanza di oggetto.
   in deepanotes.notes.load_objects(Nullable`1 folder_id, Nullable`1 synch_folder_id, task_filter tf, Nullable`1 search_id) in c:\root\todd\git\dn\deepanotes\App_Code\notes.cs:riga 53
   in _notes.OnInit(EventArgs e) in c:\root\todd\git\dn\deepanotes\notes.aspx.cs:riga 272
2021-01-07 15:42:52,954 [23] INFO dn_lib.tools.log - reload core
2021-01-07 15:42:52,979 [23] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:42:52,982 [23] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:52,983 [23] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:52,984 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:52,985 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:52,986 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:52,987 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:52,988 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:52,989 [23] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:52,989 [23] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:52,990 [23] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:52,991 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:52,991 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:52,992 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:52,993 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:52,994 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:52,994 [23] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:52,995 [23] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:53,003 [23] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:53,005 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:53,006 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:53,226 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:53,227 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:53,228 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:53,229 [23] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:53,230 [23] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:42:54,040 [5] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:42:54,043 [5] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:54,044 [5] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:54,045 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:54,048 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:54,055 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:54,056 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:54,057 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:54,058 [5] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:54,059 [5] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:54,059 [5] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:54,060 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:54,060 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:54,061 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:54,062 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:54,062 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:54,063 [5] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:54,064 [5] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:54,065 [5] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:54,066 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:54,066 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:54,067 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:54,068 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:54,068 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:54,069 [5] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:54,070 [5] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:42:54,132 [8] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:42:54,133 [8] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:54,134 [8] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:54,134 [8] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:54,135 [8] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:54,135 [8] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:54,136 [8] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:54,136 [8] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:54,137 [8] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:54,138 [8] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:54,138 [8] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:54,139 [8] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:54,139 [8] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:54,140 [8] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:54,140 [8] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:54,141 [8] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:54,141 [8] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:54,142 [8] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:54,142 [8] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:54,143 [8] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:54,144 [8] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:54,144 [8] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:54,145 [8] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:54,145 [8] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:54,146 [8] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:54,148 [8] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:42:54,168 [8] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 15:42:54,173 [8] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 15:42:59,011 [8] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 15:42:59,012 [5] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:42:59,016 [5] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:59,018 [5] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:59,019 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:59,020 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:59,021 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:59,022 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:59,022 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:59,023 [5] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:59,024 [5] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:59,025 [5] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:59,026 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:59,027 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:59,027 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:59,029 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:59,030 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:59,031 [5] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:59,032 [5] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:59,033 [5] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:59,034 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:59,035 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:59,036 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:59,036 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:59,037 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:59,038 [5] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:59,038 [5] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:42:59,067 [17] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:42:59,068 [17] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:59,069 [17] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:59,070 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:59,070 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:59,071 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:59,072 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:59,073 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:59,073 [17] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:59,074 [17] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:59,074 [17] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:59,075 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:59,075 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:59,076 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:59,076 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:59,077 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:59,077 [17] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:59,078 [17] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:59,079 [17] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:59,080 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:59,081 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:59,082 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:59,083 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:59,084 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:59,085 [17] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:59,086 [17] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:42:59,121 [8] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 15:42:59,123 [5] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:42:59,123 [5] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:59,124 [5] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:59,124 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:59,125 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:59,126 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:59,126 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:59,127 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:59,128 [5] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:59,128 [5] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:59,129 [5] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:59,129 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:59,130 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:59,130 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:59,131 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:59,131 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:59,132 [5] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:59,132 [5] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:42:59,133 [5] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:42:59,133 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:42:59,134 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:42:59,134 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:42:59,135 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:42:59,135 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:42:59,136 [5] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:42:59,136 [5] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:42:59,146 [5] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 15:42:59,148 [5] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 15:43:00,115 [5] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 15:43:00,126 [8] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 15:43:00,185 [5] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 15:43:00,239 [5] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 15:43:00,244 [8] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 15:43:00,327 [5] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 15:43:00,468 [8] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 15:43:00,517 [8] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 15:43:00,518 [8] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 15:43:00,519 [8] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 15:43:00,569 [5] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 15:43:00,571 [5] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 15:43:00,572 [5] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 15:43:00,573 [5] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 15:43:07,135 [8] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:43:07,139 [8] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:43:07,140 [8] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:43:07,141 [8] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:43:07,142 [8] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:43:07,142 [8] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:43:07,143 [8] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:43:07,144 [8] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:43:07,144 [8] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:43:07,145 [8] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:43:07,146 [8] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:43:07,146 [8] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:43:07,147 [8] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:43:07,147 [8] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:43:07,148 [8] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:43:07,148 [8] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:43:07,149 [8] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:43:07,150 [8] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:43:07,150 [8] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:43:07,151 [8] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:43:07,151 [8] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:43:07,151 [8] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:43:07,152 [8] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:43:07,152 [8] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:43:07,153 [8] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:43:07,154 [8] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:43:07,184 [5] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:43:07,185 [5] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:43:07,185 [5] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:43:07,186 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:43:07,186 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:43:07,187 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:43:07,188 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:43:07,188 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:43:07,189 [5] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:43:07,189 [5] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:43:07,190 [5] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:43:07,190 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:43:07,190 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:43:07,191 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:43:07,191 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:43:07,191 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:43:07,192 [5] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:43:07,192 [5] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:43:07,193 [5] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:43:07,194 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:43:07,194 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:43:07,195 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:43:07,195 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:43:07,195 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:43:07,196 [5] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:43:07,196 [5] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:43:07,238 [8] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:43:07,238 [8] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:43:07,239 [8] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:43:07,240 [8] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:43:07,241 [8] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:43:07,241 [8] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:43:07,242 [8] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:43:07,242 [8] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:43:07,243 [8] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:43:07,244 [8] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:43:07,245 [8] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:43:07,245 [8] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:43:07,246 [8] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:43:07,246 [8] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:43:07,247 [8] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:43:07,247 [8] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:43:07,248 [8] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:43:07,248 [8] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:43:07,249 [8] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:43:07,249 [8] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:43:07,250 [8] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:43:07,250 [8] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:43:07,251 [8] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:43:07,252 [8] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:43:07,253 [8] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:43:07,254 [8] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:43:07,263 [8] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'lavorazio';
declare @sid varchar(100); set @sid = 'uuluzis4zmktppx0qysjj2lj';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id, file_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id, t2.file_id
   from (select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)) t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 15:43:07,265 [8] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 15:43:07,267 [8] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 15:43:09,985 [8] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 12 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 15:43:10,020 [8] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , (select top 1 1 from dn_search_tasks where search_id = 12 and file_id = f.file_id) as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 12 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 15:43:10,947 [8] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join (select distinct search_id, task_id from dn_search_tasks) st on st.search_id = 12 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 15:43:26,572 [8] ERROR dn_lib.tools.log - error
System.NullReferenceException: Riferimento a un oggetto non impostato su un'istanza di oggetto.
   in deepanotes.notes.load_objects(Nullable`1 folder_id, Nullable`1 synch_folder_id, task_filter tf, Nullable`1 search_id) in c:\root\todd\git\dn\deepanotes\App_Code\notes.cs:riga 53
   in _notes.OnInit(EventArgs e) in c:\root\todd\git\dn\deepanotes\notes.aspx.cs:riga 272
2021-01-07 15:45:54,367 [5] INFO dn_lib.tools.log - reload core
2021-01-07 15:45:54,400 [5] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:45:54,403 [5] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:45:54,404 [5] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:45:54,405 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:45:54,406 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:45:54,407 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:45:54,408 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:45:54,409 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:45:54,411 [5] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:45:54,412 [5] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:45:54,415 [5] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:45:54,416 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:45:54,421 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:45:54,425 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:45:54,426 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:45:54,427 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:45:54,428 [5] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:45:54,429 [5] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:45:54,450 [5] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:45:54,453 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:45:54,455 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:45:54,456 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:45:54,457 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:45:54,458 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:45:54,459 [5] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:45:54,460 [5] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:45:54,521 [24] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:45:54,521 [24] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:45:54,522 [24] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:45:54,523 [24] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:45:54,523 [24] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:45:54,524 [24] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:45:54,525 [24] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:45:54,525 [24] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:45:54,526 [24] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:45:54,527 [24] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:45:54,527 [24] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:45:54,528 [24] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:45:54,529 [24] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:45:54,529 [24] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:45:54,530 [24] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:45:54,531 [24] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:45:54,531 [24] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:45:54,532 [24] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:45:54,533 [24] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:45:54,533 [24] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:45:54,534 [24] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:45:54,534 [24] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:45:54,535 [24] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:45:54,536 [24] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:45:54,536 [24] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:45:54,537 [24] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:45:54,619 [30] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:45:54,620 [30] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:45:54,621 [30] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:45:54,622 [30] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:45:54,623 [30] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:45:54,624 [30] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:45:54,625 [30] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:45:54,626 [30] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:45:54,627 [30] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:45:54,628 [30] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:45:54,629 [30] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:45:54,629 [30] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:45:54,630 [30] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:45:54,631 [30] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:45:54,631 [30] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:45:54,632 [30] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:45:54,633 [30] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:45:54,635 [30] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:45:54,636 [30] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:45:54,638 [30] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:45:54,639 [30] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:45:54,639 [30] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:45:54,640 [30] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:45:54,641 [30] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:45:54,642 [30] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:45:54,647 [30] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:45:54,679 [30] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 15:45:54,685 [30] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 15:45:54,690 [30] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 15:45:54,767 [30] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 15:45:54,842 [30] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 15:45:54,961 [30] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 15:45:55,192 [30] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 15:45:55,278 [30] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 15:45:55,280 [30] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 15:45:55,281 [30] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 15:46:01,347 [5] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:46:01,349 [5] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:46:01,350 [5] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:46:01,351 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:46:01,352 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:46:01,353 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:46:01,354 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:46:01,355 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:46:01,355 [5] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:46:01,356 [5] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:46:01,357 [5] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:46:01,358 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:46:01,358 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:46:01,359 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:46:01,359 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:46:01,360 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:46:01,361 [5] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:46:01,361 [5] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:46:01,362 [5] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:46:01,363 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:46:01,363 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:46:01,364 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:46:01,364 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:46:01,365 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:46:01,366 [5] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:46:01,367 [5] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:46:01,399 [30] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:46:01,400 [30] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:46:01,400 [30] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:46:01,401 [30] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:46:01,401 [30] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:46:01,402 [30] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:46:01,402 [30] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:46:01,403 [30] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:46:01,404 [30] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:46:01,413 [30] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:46:01,414 [30] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:46:01,414 [30] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:46:01,415 [30] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:46:01,415 [30] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:46:01,416 [30] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:46:01,417 [30] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:46:01,418 [30] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:46:01,418 [30] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:46:01,419 [30] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:46:01,419 [30] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:46:01,420 [30] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:46:01,421 [30] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:46:01,421 [30] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:46:01,422 [30] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:46:01,422 [30] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:46:01,424 [30] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:46:01,460 [24] INFO dn_lib.tools.log - reload config docs
2021-01-07 15:46:01,461 [24] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:46:01,462 [24] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:46:01,462 [24] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:46:01,463 [24] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:46:01,463 [24] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:46:01,464 [24] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:46:01,465 [24] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:46:01,465 [24] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:46:01,466 [24] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:46:01,467 [24] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:46:01,467 [24] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:46:01,468 [24] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:46:01,468 [24] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:46:01,468 [24] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:46:01,469 [24] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:46:01,469 [24] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:46:01,470 [24] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 15:46:01,470 [24] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 15:46:01,471 [24] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 15:46:01,471 [24] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 15:46:01,472 [24] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 15:46:01,472 [24] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 15:46:01,472 [24] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 15:46:01,473 [24] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 15:46:01,474 [24] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 15:46:01,483 [24] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'lavorazio';
declare @sid varchar(100); set @sid = 'o2fwpuw2get2ndqbxqcvgih1';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id, file_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id, t2.file_id
   from (select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)) t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 15:46:01,952 [24] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 15:46:01,954 [24] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 15:46:01,955 [24] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 13 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 15:46:02,004 [24] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , (select top 1 1 from dn_search_tasks where search_id = 13 and file_id = f.file_id) as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 13 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 15:46:02,059 [24] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join (select distinct search_id, task_id from dn_search_tasks) st on st.search_id = 13 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 15:46:09,524 [24] ERROR dn_lib.tools.log - error
System.NullReferenceException: Riferimento a un oggetto non impostato su un'istanza di oggetto.
   in deepanotes.notes.load_objects(Nullable`1 folder_id, Nullable`1 synch_folder_id, task_filter tf, Nullable`1 search_id) in c:\root\todd\git\dn\deepanotes\App_Code\notes.cs:riga 56
   in _notes.OnInit(EventArgs e) in c:\root\todd\git\dn\deepanotes\notes.aspx.cs:riga 272
2021-01-07 16:49:02,650 [61] INFO dn_lib.tools.log - reload core
2021-01-07 16:49:02,682 [61] INFO dn_lib.tools.log - reload config docs
2021-01-07 16:49:02,684 [61] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:49:02,685 [61] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:49:02,686 [61] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:49:02,687 [61] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:49:02,688 [61] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:49:02,690 [61] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:49:02,690 [61] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:49:02,691 [61] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:49:02,692 [61] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:49:02,693 [61] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:49:02,693 [61] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:49:02,694 [61] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:49:02,695 [61] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:49:02,696 [61] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:49:02,697 [61] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:49:02,698 [61] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:49:02,699 [61] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:49:02,708 [61] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:49:02,710 [61] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:49:02,712 [61] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:49:02,713 [61] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:49:02,714 [61] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:49:02,715 [61] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:49:02,716 [61] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:49:02,718 [61] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 16:49:02,750 [64] INFO dn_lib.tools.log - reload config docs
2021-01-07 16:49:02,751 [64] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:49:02,752 [64] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:49:02,753 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:49:02,754 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:49:02,755 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:49:02,756 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:49:02,756 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:49:02,757 [64] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:49:02,758 [64] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:49:02,758 [64] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:49:02,759 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:49:02,759 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:49:02,760 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:49:02,760 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:49:02,761 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:49:02,762 [64] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:49:02,762 [64] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:49:02,763 [64] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:49:02,764 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:49:02,765 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:49:02,766 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:49:02,766 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:49:02,767 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:49:02,767 [64] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:49:02,768 [64] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 16:49:02,799 [54] INFO dn_lib.tools.log - reload config docs
2021-01-07 16:49:02,801 [54] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:49:02,801 [54] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:49:02,802 [54] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:49:02,803 [54] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:49:02,804 [54] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:49:02,804 [54] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:49:02,805 [54] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:49:02,806 [54] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:49:02,807 [54] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:49:02,807 [54] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:49:02,808 [54] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:49:02,809 [54] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:49:02,810 [54] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:49:02,810 [54] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:49:02,811 [54] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:49:02,812 [54] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:49:02,812 [54] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:49:02,813 [54] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:49:02,814 [54] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:49:02,814 [54] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:49:02,815 [54] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:49:02,816 [54] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:49:02,816 [54] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:49:02,817 [54] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:49:02,820 [54] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 16:49:02,843 [54] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 16:49:02,847 [54] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:49:02,852 [54] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 16:49:02,916 [54] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 16:49:02,963 [54] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 16:49:03,071 [54] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 16:49:03,304 [54] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 16:49:03,388 [54] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 16:49:03,389 [54] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 16:49:03,390 [54] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 16:49:09,677 [60] INFO dn_lib.tools.log - reload config docs
2021-01-07 16:49:09,688 [60] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:49:09,689 [60] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:49:09,690 [60] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:49:09,691 [60] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:49:09,691 [60] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:49:09,692 [60] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:49:09,693 [60] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:49:09,694 [60] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:49:09,695 [60] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:49:09,695 [60] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:49:09,696 [60] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:49:09,696 [60] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:49:09,697 [60] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:49:09,698 [60] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:49:09,698 [60] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:49:09,699 [60] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:49:09,699 [60] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:49:09,700 [60] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:49:09,700 [60] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:49:09,701 [60] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:49:09,701 [60] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:49:09,702 [60] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:49:09,702 [60] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:49:09,703 [60] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:49:09,703 [60] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 16:49:09,748 [60] DEBUG dn_lib.tools.log - SQL: if not exists (select top 1 1 from users_cache where [user_id] = 0 and var_name = 'active-task-filter')
        insert into users_cache ([user_id], var_name, var_value)
          values (0, 'active-task-filter', '4')
        else update users_cache set var_value = substring('4', 1, 500), dt_upd = getdate()
          where [user_id] = 0 and var_name = 'active-task-filter'
2021-01-07 16:49:09,817 [58] INFO dn_lib.tools.log - reload config docs
2021-01-07 16:49:09,818 [58] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:49:09,819 [58] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:49:09,821 [58] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:49:09,822 [58] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:49:09,823 [58] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:49:09,824 [58] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:49:09,825 [58] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:49:09,826 [58] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:49:09,827 [58] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:49:09,827 [58] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:49:09,828 [58] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:49:09,830 [58] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:49:09,831 [58] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:49:09,832 [58] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:49:09,833 [58] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:49:09,834 [58] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:49:09,835 [58] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:49:09,835 [58] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:49:09,836 [58] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:49:09,837 [58] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:49:09,837 [58] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:49:09,838 [58] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:49:09,839 [58] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:49:09,840 [58] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:49:09,841 [58] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 16:49:09,849 [58] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 16:49:09,851 [58] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:49:09,852 [58] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:49:09,853 [58] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:49:09,854 [58] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:49:09,856 [58] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:49:09,857 [58] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:49:09,858 [58] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:49:09,859 [58] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:49:09,860 [58] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:49:09,861 [58] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:49:09,862 [58] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:49:09,863 [58] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:49:09,864 [58] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 16:49:09,926 [58] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 16:49:09,978 [58] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1  and t3.stato = 'fatto'
2021-01-07 16:49:10,080 [58] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 16:49:10,276 [58] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 16:49:10,278 [58] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 16:49:10,279 [58] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 16:49:10,280 [58] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 16:49:26,903 [64] INFO dn_lib.tools.log - reload config docs
2021-01-07 16:49:26,904 [64] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:49:26,905 [64] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:49:26,906 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:49:26,907 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:49:26,907 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:49:26,908 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:49:26,909 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:49:26,910 [64] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:49:26,911 [64] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:49:26,911 [64] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:49:26,911 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:49:26,912 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:49:26,912 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:49:26,913 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:49:26,913 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:49:26,914 [64] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:49:26,914 [64] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:49:26,915 [64] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:49:26,915 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:49:26,916 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:49:26,916 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:49:26,917 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:49:26,917 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:49:26,918 [64] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:49:26,918 [64] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 16:49:26,927 [64] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 221
2021-01-07 16:49:26,929 [64] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path , null as found_file       
      from vw_task_allegati a
      where a.task_id = 221
2021-01-07 16:51:34,074 [38] INFO dn_lib.tools.log - reload core
2021-01-07 16:51:34,107 [38] INFO dn_lib.tools.log - reload config docs
2021-01-07 16:51:34,109 [38] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:51:34,110 [38] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:51:34,111 [38] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:51:34,112 [38] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:51:34,113 [38] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:51:34,114 [38] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:51:34,114 [38] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:51:34,115 [38] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:51:34,116 [38] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:51:34,117 [38] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:51:34,118 [38] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:51:34,118 [38] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:51:34,120 [38] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:51:34,120 [38] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:51:34,121 [38] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:51:34,122 [38] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:51:34,123 [38] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:51:34,130 [38] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:51:34,132 [38] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:51:34,133 [38] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:51:34,134 [38] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:51:34,135 [38] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:51:34,136 [38] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:51:34,137 [38] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:51:34,138 [38] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 16:51:34,168 [64] INFO dn_lib.tools.log - reload config docs
2021-01-07 16:51:34,169 [64] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:51:34,170 [64] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:51:34,170 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:51:34,171 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:51:34,173 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:51:34,175 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:51:34,175 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:51:34,176 [64] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:51:34,177 [64] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:51:34,178 [64] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:51:34,178 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:51:34,179 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:51:34,180 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:51:34,181 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:51:34,182 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:51:34,182 [64] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:51:34,183 [64] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:51:34,184 [64] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:51:34,185 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:51:34,185 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:51:34,186 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:51:34,186 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:51:34,187 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:51:34,187 [64] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:51:34,188 [64] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 16:51:34,225 [39] INFO dn_lib.tools.log - reload config docs
2021-01-07 16:51:34,226 [39] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:51:34,227 [39] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:51:34,228 [39] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:51:34,229 [39] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:51:34,230 [39] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:51:34,231 [39] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:51:34,232 [39] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:51:34,233 [39] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:51:34,234 [39] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:51:34,234 [39] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:51:34,235 [39] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:51:34,236 [39] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:51:34,236 [39] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:51:34,237 [39] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:51:34,237 [39] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:51:34,238 [39] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:51:34,238 [39] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:51:34,241 [39] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:51:34,241 [39] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:51:34,241 [39] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:51:34,242 [39] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:51:34,244 [39] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:51:34,245 [39] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:51:34,246 [39] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:51:34,249 [39] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 16:51:34,280 [39] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 16:51:34,285 [39] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:51:34,286 [39] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:51:34,287 [39] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:51:34,288 [39] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:51:34,289 [39] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:51:34,290 [39] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:51:34,291 [39] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:51:34,292 [39] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:51:34,293 [39] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:51:34,294 [39] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:51:34,295 [39] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:51:34,296 [39] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:51:34,300 [39] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 16:51:34,317 [39] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 16:51:34,329 [39] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1  and t3.stato = 'fatto'
2021-01-07 16:51:34,359 [39] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 16:51:34,365 [39] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 16:51:34,450 [39] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 16:51:34,452 [39] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 16:51:34,453 [39] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 16:51:40,428 [64] INFO dn_lib.tools.log - reload config docs
2021-01-07 16:51:40,429 [64] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:51:40,430 [64] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:51:40,430 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:51:40,431 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:51:40,432 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:51:40,433 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:51:40,434 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:51:40,434 [64] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:51:40,435 [64] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:51:40,436 [64] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:51:40,437 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:51:40,438 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:51:40,439 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:51:40,439 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:51:40,440 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:51:40,440 [64] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:51:40,441 [64] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:51:40,442 [64] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:51:40,443 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:51:40,443 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:51:40,444 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:51:40,445 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:51:40,445 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:51:40,446 [64] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:51:40,447 [64] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 16:51:40,491 [64] DEBUG dn_lib.tools.log - SQL: if not exists (select top 1 1 from users_cache where [user_id] = 0 and var_name = 'active-task-filter')
        insert into users_cache ([user_id], var_name, var_value)
          values (0, 'active-task-filter', '6')
        else update users_cache set var_value = substring('6', 1, 500), dt_upd = getdate()
          where [user_id] = 0 and var_name = 'active-task-filter'
2021-01-07 16:51:40,566 [54] INFO dn_lib.tools.log - reload config docs
2021-01-07 16:51:40,567 [54] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:51:40,568 [54] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:51:40,569 [54] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:51:40,570 [54] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:51:40,571 [54] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:51:40,572 [54] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:51:40,573 [54] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:51:40,574 [54] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:51:40,574 [54] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:51:40,575 [54] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:51:40,575 [54] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:51:40,576 [54] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:51:40,576 [54] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:51:40,577 [54] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:51:40,577 [54] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:51:40,578 [54] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:51:40,578 [54] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:51:40,579 [54] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:51:40,579 [54] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:51:40,579 [54] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:51:40,579 [54] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:51:40,580 [54] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:51:40,580 [54] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:51:40,581 [54] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:51:40,581 [54] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 16:51:40,591 [54] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 16:51:40,592 [54] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:51:40,593 [54] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 16:51:40,594 [54] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 16:51:40,595 [54] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 16:51:40,613 [54] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 16:51:40,623 [54] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 16:51:40,624 [54] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 16:51:40,625 [54] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 16:51:40,626 [54] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 16:51:46,246 [39] INFO dn_lib.tools.log - reload config docs
2021-01-07 16:51:46,247 [39] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:51:46,248 [39] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:51:46,250 [39] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:51:46,251 [39] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:51:46,252 [39] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:51:46,253 [39] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:51:46,253 [39] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:51:46,254 [39] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:51:46,255 [39] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:51:46,256 [39] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:51:46,256 [39] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:51:46,257 [39] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:51:46,257 [39] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:51:46,258 [39] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:51:46,258 [39] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:51:46,259 [39] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:51:46,260 [39] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:51:46,260 [39] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:51:46,261 [39] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:51:46,261 [39] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:51:46,262 [39] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:51:46,262 [39] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:51:46,263 [39] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:51:46,263 [39] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:51:46,264 [39] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 16:51:46,274 [39] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 310
2021-01-07 16:51:46,276 [39] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path , null as found_file       
      from vw_task_allegati a
      where a.task_id = 310
2021-01-07 16:52:55,635 [63] INFO dn_lib.tools.log - reload core
2021-01-07 16:52:55,673 [63] INFO dn_lib.tools.log - reload config docs
2021-01-07 16:52:55,676 [63] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:52:55,679 [63] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:52:55,680 [63] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:52:55,682 [63] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:52:55,683 [63] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:52:55,684 [63] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:52:55,685 [63] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:52:55,686 [63] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:52:55,686 [63] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:52:55,687 [63] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:52:55,688 [63] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:52:55,688 [63] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:52:55,689 [63] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:52:55,690 [63] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:52:55,690 [63] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:52:55,691 [63] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:52:55,692 [63] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:52:55,710 [63] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:52:55,712 [63] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:52:55,713 [63] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:52:55,715 [63] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:52:55,716 [63] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:52:55,717 [63] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:52:55,718 [63] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:52:55,719 [63] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 16:52:55,791 [61] INFO dn_lib.tools.log - reload config docs
2021-01-07 16:52:55,793 [61] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:52:55,794 [61] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:52:55,795 [61] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:52:55,796 [61] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:52:55,797 [61] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:52:55,798 [61] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:52:55,798 [61] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:52:55,799 [61] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:52:55,800 [61] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:52:55,801 [61] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:52:55,801 [61] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:52:55,802 [61] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:52:55,802 [61] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:52:55,803 [61] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:52:55,803 [61] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:52:55,804 [61] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:52:55,804 [61] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:52:55,805 [61] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:52:55,806 [61] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:52:55,808 [61] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:52:55,810 [61] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:52:55,811 [61] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:52:55,811 [61] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:52:55,812 [61] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:52:55,813 [61] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 16:52:55,886 [62] INFO dn_lib.tools.log - reload config docs
2021-01-07 16:52:55,887 [62] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:52:55,888 [62] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:52:55,889 [62] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:52:55,890 [62] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:52:55,890 [62] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:52:55,891 [62] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:52:55,892 [62] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:52:55,892 [62] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:52:55,893 [62] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:52:55,894 [62] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:52:55,894 [62] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:52:55,895 [62] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:52:55,895 [62] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:52:55,895 [62] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:52:55,896 [62] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:52:55,896 [62] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:52:55,897 [62] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:52:55,897 [62] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:52:55,898 [62] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:52:55,899 [62] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:52:55,899 [62] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:52:55,900 [62] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:52:55,901 [62] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:52:55,902 [62] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:52:55,903 [62] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 16:52:55,928 [62] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 16:52:55,933 [62] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:52:55,938 [62] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 16:53:49,466 [62] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 16:54:28,939 [62] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 16:54:28,950 [62] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 16:54:28,960 [62] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 16:54:29,041 [62] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 16:54:29,043 [62] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 16:54:29,044 [62] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 16:58:18,095 [37] INFO dn_lib.tools.log - reload config docs
2021-01-07 16:58:18,096 [37] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:58:18,098 [37] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:58:18,099 [37] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:58:18,100 [37] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:58:18,100 [37] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:58:18,101 [37] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:58:18,102 [37] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:58:18,103 [37] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:58:18,103 [37] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:58:18,104 [37] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:58:18,104 [37] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:58:18,105 [37] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:58:18,105 [37] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:58:18,106 [37] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:58:18,107 [37] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:58:18,108 [37] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:58:18,108 [37] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:58:18,109 [37] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:58:18,110 [37] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:58:18,110 [37] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:58:18,110 [37] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:58:18,110 [37] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:58:18,111 [37] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:58:18,111 [37] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:58:18,112 [37] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 16:58:18,120 [37] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 16:58:18,122 [37] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:58:18,124 [37] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 16:58:18,125 [37] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 16:58:18,126 [37] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 16:58:18,142 [37] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 16:58:18,144 [37] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 16:58:18,145 [37] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 16:58:18,146 [37] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 16:58:18,147 [37] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 16:58:36,994 [5] INFO dn_lib.tools.log - reload core
2021-01-07 16:58:37,021 [5] INFO dn_lib.tools.log - reload config docs
2021-01-07 16:58:37,023 [5] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:58:37,024 [5] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:58:37,026 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:58:37,026 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:58:37,027 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:58:37,028 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:58:37,029 [5] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:58:37,030 [5] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:58:37,030 [5] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:58:37,031 [5] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:58:37,031 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:58:37,032 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:58:37,033 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:58:37,033 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:58:37,033 [5] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:58:37,034 [5] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:58:37,035 [5] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:58:37,041 [5] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:58:37,043 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:58:37,044 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:58:37,045 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:58:37,046 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:58:37,046 [5] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:58:37,047 [5] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:58:37,049 [5] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 16:58:37,082 [26] INFO dn_lib.tools.log - reload config docs
2021-01-07 16:58:37,083 [26] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:58:37,084 [26] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:58:37,085 [26] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:58:37,085 [26] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:58:37,087 [26] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:58:37,088 [26] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:58:37,089 [26] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:58:37,090 [26] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:58:37,091 [26] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:58:37,092 [26] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:58:37,092 [26] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:58:37,093 [26] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:58:37,093 [26] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:58:37,094 [26] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:58:37,094 [26] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:58:37,095 [26] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:58:37,095 [26] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:58:37,096 [26] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:58:37,096 [26] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:58:37,097 [26] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:58:37,097 [26] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:58:37,098 [26] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:58:37,098 [26] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:58:37,099 [26] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:58:37,099 [26] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 16:58:37,120 [59] INFO dn_lib.tools.log - reload config docs
2021-01-07 16:58:37,122 [59] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:58:37,123 [59] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:58:37,124 [59] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:58:37,125 [59] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:58:37,126 [59] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:58:37,126 [59] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:58:37,128 [59] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:58:37,129 [59] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:58:37,130 [59] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:58:37,131 [59] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:58:37,132 [59] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:58:37,133 [59] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:58:37,135 [59] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:58:37,136 [59] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:58:37,138 [59] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:58:37,139 [59] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:58:37,141 [59] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:58:37,141 [59] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:58:37,142 [59] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:58:37,143 [59] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:58:37,143 [59] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:58:37,144 [59] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:58:37,145 [59] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:58:37,145 [59] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:58:37,147 [59] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 16:58:37,167 [59] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 16:58:37,168 [59] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 16:58:37,170 [59] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 16:58:37,172 [59] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 16:58:37,175 [59] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 16:58:37,186 [59] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 16:58:37,197 [59] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 16:58:37,280 [59] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 16:58:37,281 [59] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 16:58:37,282 [59] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 16:58:43,041 [59] INFO dn_lib.tools.log - reload config docs
2021-01-07 16:58:43,042 [59] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:58:43,043 [59] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:58:43,044 [59] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:58:43,045 [59] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:58:43,045 [59] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:58:43,046 [59] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:58:43,047 [59] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:58:43,048 [59] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:58:43,049 [59] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:58:43,049 [59] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:58:43,050 [59] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:58:43,051 [59] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:58:43,052 [59] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:58:43,052 [59] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:58:43,053 [59] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:58:43,054 [59] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:58:43,055 [59] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 16:58:43,056 [59] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 16:58:43,057 [59] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 16:58:43,057 [59] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 16:58:43,058 [59] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 16:58:43,059 [59] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 16:58:43,060 [59] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 16:58:43,060 [59] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 16:58:43,061 [59] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 16:58:43,124 [59] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 310
2021-01-07 16:58:43,126 [59] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path , null as found_file       
      from vw_task_allegati a
      where a.task_id = 310
2021-01-07 17:03:56,099 [33] INFO dn_lib.tools.log - reload core
2021-01-07 17:03:56,126 [33] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:03:56,128 [33] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:03:56,129 [33] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:03:56,130 [33] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:03:56,143 [33] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:03:56,156 [33] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:03:56,174 [33] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:03:56,187 [33] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:03:56,200 [33] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:03:56,201 [33] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:03:56,204 [33] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:03:56,206 [33] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:03:56,207 [33] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:03:56,208 [33] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:03:56,208 [33] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:03:56,209 [33] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:03:56,210 [33] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:03:56,211 [33] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:03:56,218 [33] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:03:56,222 [33] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:03:56,224 [33] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:03:56,225 [33] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:03:56,226 [33] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:03:56,227 [33] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:03:56,228 [33] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:03:56,229 [33] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:04:04,607 [35] INFO dn_lib.tools.log - reload core
2021-01-07 17:04:04,632 [35] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:04:04,634 [35] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:04:04,634 [35] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:04:04,635 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:04:04,637 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:04:04,638 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:04:04,650 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:04:04,651 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:04:04,652 [35] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:04:04,653 [35] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:04:04,654 [35] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:04:04,655 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:04:04,655 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:04:04,656 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:04:04,656 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:04:04,657 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:04:04,657 [35] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:04:04,658 [35] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:04:04,662 [35] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:04:04,664 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:04:04,665 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:04:04,666 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:04:04,668 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:04:04,668 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:04:04,669 [35] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:04:04,671 [35] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:04:04,705 [49] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:04:04,707 [49] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:04:04,708 [49] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:04:04,709 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:04:04,709 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:04:04,710 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:04:04,712 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:04:04,712 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:04:04,713 [49] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:04:04,714 [49] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:04:04,714 [49] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:04:04,715 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:04:04,716 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:04:04,717 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:04:04,718 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:04:04,718 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:04:04,719 [49] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:04:04,719 [49] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:04:04,720 [49] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:04:04,720 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:04:04,721 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:04:04,721 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:04:04,722 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:04:04,722 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:04:04,722 [49] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:04:04,723 [49] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:04:05,413 [48] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:04:05,414 [48] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:04:05,415 [48] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:04:05,416 [48] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:04:05,417 [48] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:04:05,418 [48] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:04:05,419 [48] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:04:05,420 [48] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:04:05,421 [48] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:04:05,421 [48] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:04:05,422 [48] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:04:05,423 [48] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:04:05,423 [48] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:04:05,424 [48] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:04:05,424 [48] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:04:05,425 [48] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:04:05,426 [48] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:04:05,427 [48] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:04:05,428 [48] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:04:05,428 [48] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:04:05,429 [48] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:04:05,430 [48] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:04:05,430 [48] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:04:05,431 [48] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:04:05,432 [48] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:04:05,444 [48] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:04:05,467 [48] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 17:04:05,471 [48] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 17:04:05,475 [48] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 17:04:05,477 [48] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 17:04:05,480 [48] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 17:04:05,492 [48] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 17:04:05,502 [48] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 17:04:05,583 [48] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 17:04:05,585 [48] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 17:04:05,586 [48] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 17:04:31,717 [35] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:04:31,718 [35] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:04:31,719 [35] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:04:31,719 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:04:31,720 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:04:31,720 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:04:31,721 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:04:31,721 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:04:31,722 [35] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:04:31,722 [35] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:04:31,723 [35] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:04:31,723 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:04:31,724 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:04:31,724 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:04:31,725 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:04:31,725 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:04:31,725 [35] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:04:31,726 [35] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:04:31,726 [35] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:04:31,727 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:04:31,727 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:04:31,727 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:04:31,728 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:04:31,729 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:04:31,729 [35] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:04:31,730 [35] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:04:31,771 [35] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 310
2021-01-07 17:04:31,773 [35] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path , null as found_file       
       , (select top 1 1 from dn_tasks where task_id = a.task_id and file_id = a.file_id) as file_task
      from vw_task_allegati a
      where a.task_id = 310
2021-01-07 17:04:35,582 [46] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:04:35,583 [46] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:04:35,584 [46] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:04:35,585 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:04:35,586 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:04:35,586 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:04:35,587 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:04:35,587 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:04:35,588 [46] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:04:35,588 [46] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:04:35,589 [46] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:04:35,589 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:04:35,590 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:04:35,590 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:04:35,591 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:04:35,591 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:04:35,591 [46] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:04:35,592 [46] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:04:35,592 [46] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:04:35,593 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:04:35,594 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:04:35,595 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:04:35,595 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:04:35,596 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:04:35,596 [46] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:04:35,597 [46] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:04:35,606 [46] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 17:04:35,607 [46] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 17:04:35,608 [46] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 17:04:35,609 [46] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 17:04:35,610 [46] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 17:04:35,612 [46] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 17:04:35,614 [46] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 17:04:35,615 [46] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 17:04:35,615 [46] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 17:04:35,616 [46] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 17:05:12,762 [48] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:05:12,763 [48] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:05:12,764 [48] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:05:12,765 [48] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:05:12,767 [48] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:05:12,767 [48] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:05:12,768 [48] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:05:12,769 [48] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:05:12,770 [48] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:05:12,771 [48] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:05:12,772 [48] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:05:12,774 [48] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:05:12,775 [48] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:05:12,776 [48] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:05:12,777 [48] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:05:12,778 [48] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:05:12,779 [48] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:05:12,780 [48] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:05:12,780 [48] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:05:12,781 [48] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:05:12,781 [48] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:05:12,782 [48] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:05:12,782 [48] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:05:12,783 [48] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:05:12,783 [48] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:05:12,784 [48] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:05:12,806 [51] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:05:12,807 [51] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:05:12,808 [51] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:05:12,808 [51] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:05:12,809 [51] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:05:12,810 [51] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:05:12,810 [51] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:05:12,811 [51] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:05:12,812 [51] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:05:12,813 [51] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:05:12,813 [51] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:05:12,813 [51] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:05:12,814 [51] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:05:12,814 [51] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:05:12,815 [51] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:05:12,815 [51] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:05:12,816 [51] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:05:12,816 [51] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:05:12,817 [51] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:05:12,817 [51] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:05:12,818 [51] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:05:12,818 [51] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:05:12,819 [51] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:05:12,819 [51] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:05:12,820 [51] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:05:12,820 [51] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:05:12,830 [51] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 17:05:12,831 [51] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 17:05:12,832 [51] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, 1) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 17:05:12,838 [51] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 17:05:12,845 [51] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 17:05:12,862 [51] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 17:05:12,864 [51] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 17:05:12,865 [51] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 17:05:12,866 [51] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 17:05:12,868 [51] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 17:05:23,833 [46] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:05:23,834 [46] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:05:23,835 [46] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:05:23,837 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:05:23,838 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:05:23,839 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:05:23,840 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:05:23,840 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:05:23,841 [46] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:05:23,841 [46] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:05:23,842 [46] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:05:23,842 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:05:23,843 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:05:23,843 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:05:23,844 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:05:23,844 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:05:23,844 [46] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:05:23,845 [46] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:05:23,845 [46] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:05:23,846 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:05:23,846 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:05:23,847 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:05:23,848 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:05:23,848 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:05:23,849 [46] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:05:23,850 [46] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:05:23,861 [46] DEBUG dn_lib.tools.log - SQL: select local_path, synch_folder_id, title as name 
        from synch_folders where synch_folder_id = 1
2021-01-07 17:05:23,862 [46] DEBUG dn_lib.tools.log - SQL: select free_txt, stato, priorita, tipo, stima, (case when [default] = 1 then '1' else '0' end) as [default]
        from dn_task_free_labels 
2021-01-07 17:05:23,867 [46] DEBUG dn_lib.tools.log - SQL: insert into dn_folders (synch_folder_id, parent_id, folder_name, dt_ins, readed, dt_upd)
    values (1, null, '210107.orches.incorso.task', convert(datetime, convert(varchar, getdate(), 120), 120), 1, convert(datetime, convert(varchar, getdate(), 120), 120));select SCOPE_IDENTITY();
2021-01-07 17:05:23,877 [46] DEBUG dn_lib.tools.log - SQL: insert into dn_tasks (synch_folder_id, folder_id, title, [user], stato, dt_upd, readed, priorita, tipo, stima, dt_ins)
 select synch_folder_id, folder_id, 'orches', NULL, 'in_corso', dt_upd, 1, NULL, NULL, NULL, dt_ins
  from dn_folders where folder_id = 457;select SCOPE_IDENTITY();
2021-01-07 17:05:23,890 [51] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:05:23,891 [51] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:05:23,892 [51] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:05:23,893 [51] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:05:23,894 [51] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:05:23,894 [51] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:05:23,895 [51] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:05:23,895 [51] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:05:23,896 [51] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:05:23,896 [51] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:05:23,897 [51] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:05:23,897 [51] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:05:23,897 [51] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:05:23,898 [51] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:05:23,898 [51] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:05:23,899 [51] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:05:23,899 [51] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:05:23,900 [51] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:05:23,900 [51] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:05:23,901 [51] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:05:23,901 [51] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:05:23,901 [51] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:05:23,902 [51] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:05:23,903 [51] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:05:23,904 [51] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:05:23,905 [51] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:05:23,915 [51] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 17:05:23,916 [51] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 17:05:23,917 [51] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, 1) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 17:05:23,926 [51] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 17:05:23,933 [51] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 17:05:23,951 [51] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 17:05:23,955 [51] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 17:05:23,957 [51] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 17:05:23,958 [51] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 17:05:23,959 [51] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 17:05:34,148 [48] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:05:34,149 [48] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:05:34,150 [48] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:05:34,151 [48] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:05:34,152 [48] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:05:34,153 [48] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:05:34,153 [48] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:05:34,154 [48] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:05:34,155 [48] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:05:34,156 [48] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:05:34,157 [48] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:05:34,158 [48] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:05:34,159 [48] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:05:34,159 [48] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:05:34,160 [48] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:05:34,161 [48] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:05:34,162 [48] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:05:34,163 [48] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:05:34,164 [48] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:05:34,165 [48] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:05:34,165 [48] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:05:34,166 [48] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:05:34,167 [48] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:05:34,167 [48] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:05:34,168 [48] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:05:34,169 [48] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:05:34,180 [48] DEBUG dn_lib.tools.log - SQL: select t.task_id, t.synch_folder_id, t.folder_id, t.file_id, t.title, t.dt_upd, t.dt_readed, sf.local_path as synch_local_path
		    , replace(dbo.folder_path(isnull(t.folder_id, f.folder_id)), '/', '\') as folder_path, f.file_id as file_notes_id, f.file_name
       from dn_tasks t
       join synch_folders sf on sf.synch_folder_id = t.synch_folder_id
       left join dn_files f on f.file_id = t.file_id
	   where t.task_id = 311
2021-01-07 17:05:34,186 [48] DEBUG dn_lib.tools.log - SQL: declare @id bigint; declare @tp varchar(10); declare @cc int; declare @content_lwt varchar(25);
      select top 1 @id = file_id from dn_files where synch_folder_id = 1 and folder_id = 457 and file_name = 'yes.sql';
      if(@id is null)
      begin
        insert into dn_files (synch_folder_id, folder_id, file_name, extension, readed, dt_ins, dt_upd)
          values (1, 457, 'yes.sql', '.sql', 1, convert(datetime, '2021-01-07 17:05:34', 120), convert(datetime, '2021-01-07 17:05:34', 120));
        select @id = @@IDENTITY, @tp = 'insert', @cc = 1;  
      end
      else 
      begin
       update dn_files set readed = 1 where file_id = @id;
       set ROWCOUNT 0;
       update dn_files set dt_ins = convert(datetime, '2021-01-07 17:05:34', 120), dt_upd = convert(datetime, '2021-01-07 17:05:34', 120) 
        where file_id = @id and ( isnull(dt_ins, getdate()) <> isnull(convert(datetime, '2021-01-07 17:05:34', 120), getdate())
         or isnull(dt_upd, getdate()) <> isnull(convert(datetime, '2021-01-07 17:05:34', 120), getdate()));
       select @tp = 'update', @cc = @@ROWCOUNT;
       select @content_lwt = convert(varchar, dt_upd, 120) from dn_files_contents where file_id = @id;
      end
      select @id, @tp, @cc, @content_lwt;
2021-01-07 17:05:34,195 [48] DEBUG dn_lib.tools.log - SQL: select distinct lower(nome) as nome from users
2021-01-07 17:05:34,197 [48] DEBUG dn_lib.tools.log - SQL: select free_txt, stato, priorita, tipo, stima, (case when [default] = 1 then '1' else '0' end) as [default]
        from dn_task_free_labels 
2021-01-07 17:05:34,198 [48] DEBUG dn_lib.tools.log - SQL: select file_name, type_info from dn_files_info
2021-01-07 17:05:34,200 [48] DEBUG dn_lib.tools.log - SQL: select extension, des_extension, open_comment, close_comment, type_content from dn_files_types
2021-01-07 17:05:34,202 [48] DEBUG dn_lib.tools.log - SQL: delete from dn_files_contents where file_id = 722;
        insert into dn_files_contents (file_id, extension, content, dt_ins, dt_upd)
          values (722, '.sql', @content, convert(datetime, '2021-01-07 17:05:34', 120), convert(datetime, '2021-01-07 17:05:34', 120));
2021-01-07 17:05:34,415 [46] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:05:34,416 [46] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:05:34,417 [46] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:05:34,419 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:05:34,421 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:05:34,422 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:05:34,422 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:05:34,423 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:05:34,424 [46] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:05:34,425 [46] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:05:34,425 [46] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:05:34,426 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:05:34,426 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:05:34,427 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:05:34,427 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:05:34,428 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:05:34,428 [46] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:05:34,429 [46] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:05:34,429 [46] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:05:34,430 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:05:34,430 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:05:34,431 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:05:34,431 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:05:34,432 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:05:34,432 [46] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:05:34,433 [46] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:05:34,443 [46] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 311
2021-01-07 17:05:34,445 [46] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path , null as found_file       
       , (select top 1 1 from dn_tasks where task_id = a.task_id and file_id = a.file_id) as file_task
      from vw_task_allegati a
      where a.task_id = 311
2021-01-07 17:05:43,331 [7] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:05:43,335 [7] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:05:43,336 [7] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:05:43,337 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:05:43,338 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:05:43,339 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:05:43,340 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:05:43,341 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:05:43,342 [7] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:05:43,343 [7] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:05:43,343 [7] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:05:43,344 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:05:43,344 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:05:43,345 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:05:43,346 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:05:43,346 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:05:43,347 [7] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:05:43,348 [7] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:05:43,349 [7] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:05:43,349 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:05:43,350 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:05:43,350 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:05:43,351 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:05:43,351 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:05:43,352 [7] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:05:43,353 [7] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:05:43,362 [7] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 310
2021-01-07 17:05:43,363 [7] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path , null as found_file       
       , (select top 1 1 from dn_tasks where task_id = a.task_id and file_id = a.file_id) as file_task
      from vw_task_allegati a
      where a.task_id = 310
2021-01-07 17:07:37,126 [51] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:07:37,127 [51] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:07:37,128 [51] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:07:37,129 [51] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:07:37,130 [51] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:07:37,131 [51] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:07:37,132 [51] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:07:37,133 [51] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:07:37,134 [51] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:07:37,135 [51] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:07:37,136 [51] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:07:37,136 [51] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:07:37,137 [51] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:07:37,137 [51] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:07:37,138 [51] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:07:37,138 [51] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:07:37,138 [51] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:07:37,139 [51] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:07:37,139 [51] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:07:37,140 [51] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:07:37,140 [51] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:07:37,141 [51] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:07:37,141 [51] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:07:37,141 [51] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:07:37,142 [51] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:07:37,143 [51] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:07:37,150 [51] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 17:07:37,152 [51] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 17:07:37,152 [51] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, 1) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 17:07:37,154 [51] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 17:07:37,155 [51] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, 1) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 17:07:37,172 [51] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 17:07:37,175 [51] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 17:07:37,176 [51] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 17:07:37,177 [51] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 17:07:37,179 [51] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 17:07:41,360 [46] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:07:41,361 [46] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:07:41,362 [46] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:07:41,363 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:07:41,364 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:07:41,366 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:07:41,367 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:07:41,367 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:07:41,368 [46] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:07:41,369 [46] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:07:41,369 [46] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:07:41,370 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:07:41,370 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:07:41,371 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:07:41,371 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:07:41,372 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:07:41,372 [46] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:07:41,373 [46] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:07:41,373 [46] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:07:41,374 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:07:41,374 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:07:41,375 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:07:41,375 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:07:41,376 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:07:41,376 [46] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:07:41,377 [46] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:07:41,389 [7] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:07:41,390 [7] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:07:41,390 [7] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:07:41,391 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:07:41,391 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:07:41,392 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:07:41,392 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:07:41,393 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:07:41,394 [7] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:07:41,394 [7] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:07:41,394 [7] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:07:41,395 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:07:41,395 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:07:41,396 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:07:41,396 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:07:41,397 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:07:41,397 [7] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:07:41,398 [7] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:07:41,399 [7] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:07:41,400 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:07:41,401 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:07:41,401 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:07:41,401 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:07:41,402 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:07:41,402 [7] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:07:41,402 [7] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:07:41,411 [7] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 17:07:41,412 [7] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 17:07:41,413 [7] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 17:07:41,420 [7] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 17:07:41,426 [7] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 17:07:41,444 [7] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 17:07:41,446 [7] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 17:07:41,448 [7] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 17:07:41,449 [7] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 17:07:41,449 [7] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 17:07:45,814 [35] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:07:45,816 [35] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:07:45,817 [35] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:07:45,818 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:07:45,819 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:07:45,819 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:07:45,821 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:07:45,822 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:07:45,822 [35] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:07:45,823 [35] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:07:45,824 [35] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:07:45,825 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:07:45,825 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:07:45,826 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:07:45,826 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:07:45,827 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:07:45,827 [35] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:07:45,828 [35] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:07:45,828 [35] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:07:45,829 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:07:45,829 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:07:45,830 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:07:45,830 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:07:45,831 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:07:45,831 [35] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:07:45,832 [35] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:07:45,841 [35] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 310
2021-01-07 17:07:45,842 [35] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path , null as found_file       
       , (select top 1 1 from dn_tasks where task_id = a.task_id and file_id = a.file_id) as file_task
      from vw_task_allegati a
      where a.task_id = 310
2021-01-07 17:08:23,328 [35] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:08:23,329 [35] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:08:23,330 [35] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:08:23,331 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:08:23,333 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:08:23,333 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:08:23,335 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:08:23,336 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:08:23,337 [35] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:08:23,337 [35] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:08:23,338 [35] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:08:23,339 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:08:23,340 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:08:23,340 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:08:23,341 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:08:23,341 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:08:23,342 [35] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:08:23,342 [35] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:08:23,343 [35] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:08:23,344 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:08:23,344 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:08:23,345 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:08:23,346 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:08:23,346 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:08:23,347 [35] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:08:23,347 [35] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:08:28,979 [32] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:08:28,981 [32] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:08:28,982 [32] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:08:28,983 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:08:28,984 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:08:28,985 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:08:28,986 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:08:28,987 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:08:28,988 [32] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:08:28,988 [32] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:08:28,989 [32] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:08:28,989 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:08:28,990 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:08:28,991 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:08:28,992 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:08:28,992 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:08:28,993 [32] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:08:28,993 [32] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:08:28,994 [32] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:08:28,994 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:08:28,995 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:08:28,995 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:08:28,996 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:08:28,996 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:08:28,997 [32] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:08:28,997 [32] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:08:29,006 [32] DEBUG dn_lib.tools.log - SQL: select t.task_id, t.synch_folder_id, t.folder_id, t.file_id, t.title, t.dt_upd, t.dt_readed, sf.local_path as synch_local_path
		    , replace(dbo.folder_path(isnull(t.folder_id, f.folder_id)), '/', '\') as folder_path, f.file_id as file_notes_id, f.file_name
       from dn_tasks t
       join synch_folders sf on sf.synch_folder_id = t.synch_folder_id
       left join dn_files f on f.file_id = t.file_id
	   where t.task_id = 311
2021-01-07 17:08:29,008 [32] DEBUG dn_lib.tools.log - SQL: select f.folder_id, replace((select local_path from synch_folders where synch_folder_id = f.synch_folder_id) 
        + isnull(dbo.folder_path(f.folder_id), '\') + f.file_name , '/', '\') as file_path
       from dn_files f where f.file_id = 721
2021-01-07 17:08:29,012 [32] DEBUG dn_lib.tools.log - SQL: declare @id int;
      insert into dn_files (synch_folder_id, folder_id, file_name, dt_ins , readed, dt_upd, extension)
   select 1 as synch_folder_id, 457 as folder_id, 'script.incorso.task.sql' as file_name
    , convert(datetime, convert(varchar, getdate(), 120), 120) as dt_ins, readed, convert(datetime, convert(varchar, getdate(), 120), 120) as dt_upd, extension
   from dn_files where file_id = 721;
 
   select @id = @@IDENTITY;  
 
   insert into dn_files_contents (file_id, extension, content, dt_ins, dt_upd)
   select @id as file_id, extension, content, convert(datetime, convert(varchar, getdate(), 120), 120) as dt_ins 
    , convert(datetime, convert(varchar, getdate(), 120), 120) as dt_upd
    from dn_files_contents where file_id = 721;
2021-01-07 17:08:29,235 [49] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:08:29,237 [49] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:08:29,238 [49] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:08:29,239 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:08:29,241 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:08:29,242 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:08:29,243 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:08:29,244 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:08:29,245 [49] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:08:29,246 [49] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:08:29,247 [49] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:08:29,247 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:08:29,248 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:08:29,249 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:08:29,249 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:08:29,250 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:08:29,251 [49] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:08:29,251 [49] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:08:29,251 [49] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:08:29,252 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:08:29,252 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:08:29,253 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:08:29,253 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:08:29,254 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:08:29,254 [49] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:08:29,255 [49] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:08:29,264 [49] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 311
2021-01-07 17:08:29,265 [49] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path , null as found_file       
       , (select top 1 1 from dn_tasks where task_id = a.task_id and file_id = a.file_id) as file_task
      from vw_task_allegati a
      where a.task_id = 311
2021-01-07 17:08:29,293 [7] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:08:29,295 [7] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:08:29,296 [7] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:08:29,297 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:08:29,298 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:08:29,299 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:08:29,300 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:08:29,301 [7] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:08:29,302 [7] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:08:29,302 [7] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:08:29,303 [7] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:08:29,303 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:08:29,304 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:08:29,304 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:08:29,305 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:08:29,305 [7] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:08:29,307 [7] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:08:29,307 [7] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:08:29,308 [7] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:08:29,309 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:08:29,309 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:08:29,310 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:08:29,311 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:08:29,312 [7] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:08:29,312 [7] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:08:29,313 [7] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:08:29,323 [7] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 310
2021-01-07 17:08:29,324 [7] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path , null as found_file       
       , (select top 1 1 from dn_tasks where task_id = a.task_id and file_id = a.file_id) as file_task
      from vw_task_allegati a
      where a.task_id = 310
2021-01-07 17:08:41,118 [32] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:08:41,120 [32] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:08:41,122 [32] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:08:41,123 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:08:41,124 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:08:41,125 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:08:41,126 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:08:41,126 [32] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:08:41,127 [32] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:08:41,127 [32] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:08:41,128 [32] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:08:41,128 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:08:41,129 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:08:41,129 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:08:41,130 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:08:41,130 [32] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:08:41,131 [32] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:08:41,131 [32] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:08:41,132 [32] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:08:41,132 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:08:41,133 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:08:41,133 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:08:41,134 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:08:41,134 [32] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:08:41,135 [32] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:08:41,135 [32] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:08:41,144 [32] DEBUG dn_lib.tools.log - SQL: select f.folder_id, replace((select local_path from synch_folders where synch_folder_id = f.synch_folder_id) 
        + isnull(dbo.folder_path(f.folder_id), '\') + f.file_name , '/', '\') as file_path
       from dn_files f where f.file_id = 723
2021-01-07 17:08:41,148 [32] DEBUG dn_lib.tools.log - SQL: update dn_files set file_name = left('badabemmm.sql', 150)
        where file_id = 723
2021-01-07 17:10:09,432 [33] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:10:09,434 [33] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:10:09,436 [33] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:10:09,437 [33] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:10:09,438 [33] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:10:09,439 [33] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:10:09,440 [33] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:10:09,441 [33] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:10:09,441 [33] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:10:09,442 [33] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:10:09,442 [33] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:10:09,443 [33] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:10:09,443 [33] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:10:09,444 [33] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:10:09,444 [33] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:10:09,445 [33] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:10:09,445 [33] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:10:09,446 [33] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:10:09,446 [33] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:10:09,447 [33] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:10:09,447 [33] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:10:09,448 [33] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:10:09,448 [33] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:10:09,449 [33] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:10:09,449 [33] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:10:09,450 [33] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:10:09,463 [47] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:10:09,464 [47] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:10:09,464 [47] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:10:09,465 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:10:09,466 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:10:09,466 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:10:09,467 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:10:09,468 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:10:09,469 [47] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:10:09,469 [47] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:10:09,470 [47] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:10:09,470 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:10:09,471 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:10:09,471 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:10:09,472 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:10:09,472 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:10:09,472 [47] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:10:09,473 [47] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:10:09,474 [47] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:10:09,474 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:10:09,475 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:10:09,475 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:10:09,476 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:10:09,476 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:10:09,477 [47] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:10:09,477 [47] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:10:09,489 [49] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:10:09,490 [49] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:10:09,491 [49] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:10:09,492 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:10:09,492 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:10:09,493 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:10:09,494 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:10:09,494 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:10:09,494 [49] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:10:09,495 [49] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:10:09,495 [49] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:10:09,496 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:10:09,496 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:10:09,497 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:10:09,497 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:10:09,498 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:10:09,498 [49] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:10:09,499 [49] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:10:09,499 [49] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:10:09,500 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:10:09,500 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:10:09,501 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:10:09,501 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:10:09,502 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:10:09,502 [49] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:10:09,503 [49] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:10:09,513 [49] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'orco';
declare @sid varchar(100); set @sid = 'aogwsdc2rnkaizsxkyg3ot20';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id, file_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id, t2.file_id
   from (select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)) t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 17:10:09,538 [49] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 17:10:09,539 [49] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 17:10:09,540 [49] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 14 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 17:10:09,554 [49] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , (select top 1 1 from dn_search_tasks where search_id = 14 and file_id = f.file_id) as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 14 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 17:10:09,579 [49] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join (select distinct search_id, task_id from dn_search_tasks) st on st.search_id = 14 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 17:10:09,596 [49] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 17:10:09,599 [49] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 17:10:09,600 [49] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 17:10:09,601 [49] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 17:10:09,602 [49] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 17:10:14,264 [29] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:10:14,265 [29] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:10:14,266 [29] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:10:14,267 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:10:14,267 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:10:14,268 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:10:14,269 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:10:14,269 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:10:14,270 [29] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:10:14,271 [29] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:10:14,272 [29] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:10:14,273 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:10:14,273 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:10:14,274 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:10:14,274 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:10:14,275 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:10:14,275 [29] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:10:14,276 [29] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:10:14,276 [29] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:10:14,277 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:10:14,277 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:10:14,278 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:10:14,278 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:10:14,279 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:10:14,279 [29] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:10:14,280 [29] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:10:14,289 [29] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 311
2021-01-07 17:10:14,290 [29] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path , (select top 1 1 from dn_search_tasks where search_id = 14 and file_id = a.file_id) as found_file       
       , (select top 1 1 from dn_tasks where task_id = a.task_id and file_id = a.file_id) as file_task
      from vw_task_allegati a
      where a.task_id = 311
2021-01-07 17:10:16,658 [47] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:10:16,660 [47] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:10:16,662 [47] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:10:16,664 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:10:16,665 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:10:16,667 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:10:16,668 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:10:16,669 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:10:16,670 [47] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:10:16,671 [47] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:10:16,672 [47] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:10:16,672 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:10:16,673 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:10:16,674 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:10:16,674 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:10:16,674 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:10:16,675 [47] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:10:16,675 [47] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:10:16,676 [47] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:10:16,677 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:10:16,677 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:10:16,677 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:10:16,678 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:10:16,678 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:10:16,679 [47] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:10:16,679 [47] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:10:16,688 [47] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 310
2021-01-07 17:10:16,689 [47] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path , (select top 1 1 from dn_search_tasks where search_id = 14 and file_id = a.file_id) as found_file       
       , (select top 1 1 from dn_tasks where task_id = a.task_id and file_id = a.file_id) as file_task
      from vw_task_allegati a
      where a.task_id = 310
2021-01-07 17:10:23,613 [35] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:10:23,615 [35] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:10:23,616 [35] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:10:23,617 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:10:23,618 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:10:23,619 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:10:23,620 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:10:23,621 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:10:23,622 [35] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:10:23,623 [35] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:10:23,623 [35] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:10:23,623 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:10:23,624 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:10:23,625 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:10:23,625 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:10:23,626 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:10:23,626 [35] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:10:23,627 [35] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:10:23,627 [35] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:10:23,628 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:10:23,628 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:10:23,628 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:10:23,629 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:10:23,630 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:10:23,630 [35] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:10:23,631 [35] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:10:23,640 [35] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'orco';
declare @sid varchar(100); set @sid = 'aogwsdc2rnkaizsxkyg3ot20';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id, file_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id, t2.file_id
   from (select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)) t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 17:10:23,641 [35] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 17:10:23,642 [35] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 17:10:23,643 [35] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 14 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 17:10:23,644 [35] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , (select top 1 1 from dn_search_tasks where search_id = 14 and file_id = f.file_id) as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 14 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 17:10:23,645 [35] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.folder_id = t3.folder_id and t3.file_id is null) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join (select distinct search_id, task_id from dn_search_tasks) st on st.search_id = 14 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 17:10:23,646 [35] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 17:10:23,649 [35] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 17:10:23,650 [35] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 17:10:23,652 [35] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 17:10:23,652 [35] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 17:18:45,472 [17] INFO dn_lib.tools.log - reload core
2021-01-07 17:18:45,505 [17] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:18:45,507 [17] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:18:45,508 [17] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:18:45,509 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:18:45,511 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:18:45,512 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:18:45,520 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:18:45,528 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:18:45,530 [17] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:18:45,531 [17] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:18:45,533 [17] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:18:45,533 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:18:45,534 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:18:45,536 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:18:45,536 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:18:45,537 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:18:45,538 [17] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:18:45,539 [17] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:18:45,545 [17] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:18:45,547 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:18:45,549 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:18:45,550 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:18:45,551 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:18:45,552 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:18:45,553 [17] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:18:45,558 [17] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:18:45,587 [17] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'orco';
declare @sid varchar(100); set @sid = 'aogwsdc2rnkaizsxkyg3ot20';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id, file_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id, t2.file_id
   from (select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)) t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 17:18:45,590 [17] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 17:18:45,592 [17] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 17:18:45,596 [17] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 14 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 17:18:45,599 [17] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , (select top 1 1 from dn_search_tasks where search_id = 14 and file_id = f.file_id) as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 14 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 17:18:45,603 [17] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.task_id = t3.task_id 
          and not exists (select top 1 1 from dn_files_info where file_name = f2.file_name)) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join (select distinct search_id, task_id from dn_search_tasks) st on st.search_id = 14 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 17:18:45,630 [17] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 17:18:45,641 [17] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 17:18:45,721 [17] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 17:18:45,722 [17] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 17:18:45,724 [17] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 17:21:21,451 [17] INFO dn_lib.tools.log - reload core
2021-01-07 17:21:21,477 [17] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:21:21,478 [17] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:21:21,478 [17] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:21:21,479 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:21:21,481 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:21:21,484 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:21:21,492 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:21:21,493 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:21:21,495 [17] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:21:21,496 [17] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:21:21,497 [17] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:21:21,499 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:21:21,499 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:21:21,501 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:21:21,502 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:21:21,503 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:21:21,503 [17] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:21:21,504 [17] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:21:21,508 [17] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:21:21,510 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:21:21,511 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:21:21,512 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:21:21,513 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:21:21,515 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:21:21,516 [17] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:21:21,518 [17] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:21:21,551 [23] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:21:21,552 [23] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:21:21,553 [23] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:21:21,554 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:21:21,555 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:21:21,556 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:21:21,557 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:21:21,557 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:21:21,558 [23] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:21:21,558 [23] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:21:21,559 [23] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:21:21,560 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:21:21,560 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:21:21,561 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:21:21,561 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:21:21,562 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:21:21,562 [23] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:21:21,563 [23] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:21:21,563 [23] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:21:21,565 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:21:21,566 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:21:21,568 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:21:21,568 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:21:21,569 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:21:21,570 [23] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:21:21,570 [23] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:21:21,604 [47] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:21:21,605 [47] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:21:21,606 [47] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:21:21,606 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:21:21,607 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:21:21,608 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:21:21,609 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:21:21,610 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:21:21,611 [47] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:21:21,613 [47] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:21:21,613 [47] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:21:21,614 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:21:21,615 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:21:21,616 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:21:21,616 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:21:21,617 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:21:21,618 [47] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:21:21,618 [47] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:21:21,619 [47] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:21:21,620 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:21:21,620 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:21:21,621 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:21:21,622 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:21:21,623 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:21:21,623 [47] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:21:21,625 [47] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:21:21,648 [47] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 17:21:21,651 [47] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 17:21:21,653 [47] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 17:21:21,720 [47] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 17:21:21,768 [47] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.task_id = t3.task_id 
          and not exists (select top 1 1 from dn_files_info where file_name = f2.file_name)) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 17:21:21,913 [47] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 17:21:22,144 [47] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 17:21:22,187 [47] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 17:21:22,188 [47] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 17:21:22,190 [47] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 17:21:28,099 [17] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:21:28,100 [17] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:21:28,101 [17] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:21:28,102 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:21:28,103 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:21:28,104 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:21:28,105 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:21:28,105 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:21:28,106 [17] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:21:28,106 [17] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:21:28,107 [17] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:21:28,107 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:21:28,107 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:21:28,108 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:21:28,108 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:21:28,109 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:21:28,110 [17] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:21:28,110 [17] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:21:28,111 [17] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:21:28,112 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:21:28,112 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:21:28,113 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:21:28,114 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:21:28,114 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:21:28,115 [17] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:21:28,115 [17] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:21:28,138 [23] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:21:28,138 [23] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:21:28,139 [23] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:21:28,140 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:21:28,141 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:21:28,142 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:21:28,143 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:21:28,143 [23] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:21:28,144 [23] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:21:28,145 [23] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:21:28,145 [23] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:21:28,146 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:21:28,147 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:21:28,147 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:21:28,148 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:21:28,148 [23] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:21:28,148 [23] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:21:28,149 [23] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:21:28,149 [23] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:21:28,150 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:21:28,150 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:21:28,151 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:21:28,151 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:21:28,152 [23] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:21:28,152 [23] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:21:28,153 [23] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:21:28,164 [47] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:21:28,165 [47] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:21:28,165 [47] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:21:28,166 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:21:28,167 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:21:28,167 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:21:28,168 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:21:28,168 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:21:28,169 [47] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:21:28,170 [47] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:21:28,170 [47] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:21:28,171 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:21:28,171 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:21:28,171 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:21:28,172 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:21:28,172 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:21:28,173 [47] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:21:28,173 [47] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:21:28,173 [47] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:21:28,174 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:21:28,175 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:21:28,175 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:21:28,176 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:21:28,176 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:21:28,177 [47] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:21:28,177 [47] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:21:28,185 [47] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'lavorazio';
declare @sid varchar(100); set @sid = 'nidy5dn4fffiy4ltru5iuxbz';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id, file_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id, t2.file_id
   from (select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)) t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 17:21:28,636 [47] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 17:21:28,637 [47] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 17:21:28,638 [47] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 15 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 17:21:28,683 [47] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , (select top 1 1 from dn_search_tasks where search_id = 15 and file_id = f.file_id) as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 15 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 17:21:28,734 [47] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.task_id = t3.task_id 
          and not exists (select top 1 1 from dn_files_info where file_name = f2.file_name)) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join (select distinct search_id, task_id from dn_search_tasks) st on st.search_id = 15 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 17:21:28,789 [47] ERROR dn_lib.tools.log - error
System.NullReferenceException: Riferimento a un oggetto non impostato su un'istanza di oggetto.
   in deepanotes.notes.load_objects(Nullable`1 folder_id, Nullable`1 synch_folder_id, task_filter tf, Nullable`1 search_id) in c:\root\todd\git\dn\deepanotes\App_Code\notes.cs:riga 54
   in _notes.OnInit(EventArgs e) in c:\root\todd\git\dn\deepanotes\notes.aspx.cs:riga 272
2021-01-07 17:22:34,315 [49] INFO dn_lib.tools.log - reload core
2021-01-07 17:22:34,347 [49] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:22:34,349 [49] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:22:34,350 [49] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:22:34,351 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:22:34,353 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:22:34,355 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:22:34,363 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:22:34,365 [49] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:22:34,373 [49] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:22:34,374 [49] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:22:34,375 [49] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:22:34,376 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:22:34,376 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:22:34,378 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:22:34,378 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:22:34,379 [49] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:22:34,380 [49] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:22:34,382 [49] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:22:34,398 [49] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:22:34,400 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:22:34,400 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:22:34,401 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:22:34,403 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:22:34,404 [49] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:22:34,405 [49] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:22:34,407 [49] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:22:34,465 [35] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:22:34,466 [35] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:22:34,467 [35] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:22:34,468 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:22:34,470 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:22:34,471 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:22:34,472 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:22:34,473 [35] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:22:34,474 [35] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:22:34,475 [35] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:22:34,475 [35] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:22:34,476 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:22:34,477 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:22:34,477 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:22:34,478 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:22:34,479 [35] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:22:34,479 [35] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:22:34,480 [35] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:22:34,481 [35] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:22:34,482 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:22:34,483 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:22:34,483 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:22:34,484 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:22:34,486 [35] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:22:34,487 [35] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:22:34,488 [35] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:22:34,552 [47] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:22:34,553 [47] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:22:34,554 [47] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:22:34,555 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:22:34,556 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:22:34,556 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:22:34,557 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:22:34,558 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:22:34,558 [47] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:22:34,559 [47] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:22:34,559 [47] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:22:34,560 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:22:34,560 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:22:34,561 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:22:34,562 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:22:34,563 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:22:34,564 [47] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:22:34,565 [47] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:22:34,565 [47] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:22:34,566 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:22:34,566 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:22:34,567 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:22:34,568 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:22:34,568 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:22:34,570 [47] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:22:34,574 [47] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:22:34,597 [47] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 17:22:34,602 [47] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 17:22:34,607 [47] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 17:22:34,671 [47] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 17:22:34,722 [47] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.task_id = t3.task_id 
          and not exists (select top 1 1 from dn_files_info where file_name = f2.file_name)) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 17:22:34,854 [47] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 17:22:35,118 [47] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 17:22:35,219 [47] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 17:22:35,221 [47] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 17:22:35,222 [47] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 17:22:52,067 [47] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:22:52,069 [47] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:22:52,070 [47] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:22:52,071 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:22:52,072 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:22:52,073 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:22:52,075 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:22:52,076 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:22:52,076 [47] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:22:52,077 [47] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:22:52,077 [47] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:22:52,078 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:22:52,079 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:22:52,080 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:22:52,080 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:22:52,082 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:22:52,083 [47] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:22:52,084 [47] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:22:52,085 [47] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:22:52,086 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:22:52,087 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:22:52,088 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:22:52,089 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:22:52,090 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:22:52,090 [47] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:22:52,091 [47] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:22:52,126 [40] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:22:52,127 [40] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:22:52,128 [40] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:22:52,128 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:22:52,129 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:22:52,129 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:22:52,130 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:22:52,130 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:22:52,131 [40] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:22:52,131 [40] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:22:52,132 [40] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:22:52,133 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:22:52,133 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:22:52,134 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:22:52,135 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:22:52,135 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:22:52,136 [40] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:22:52,137 [40] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:22:52,137 [40] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:22:52,138 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:22:52,139 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:22:52,140 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:22:52,140 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:22:52,141 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:22:52,141 [40] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:22:52,142 [40] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:22:52,177 [47] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:22:52,178 [47] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:22:52,179 [47] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:22:52,180 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:22:52,181 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:22:52,182 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:22:52,183 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:22:52,184 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:22:52,185 [47] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:22:52,186 [47] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:22:52,188 [47] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:22:52,189 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:22:52,189 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:22:52,190 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:22:52,190 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:22:52,191 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:22:52,192 [47] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:22:52,192 [47] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:22:52,193 [47] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:22:52,194 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:22:52,194 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:22:52,195 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:22:52,196 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:22:52,197 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:22:52,198 [47] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:22:52,199 [47] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:22:52,209 [47] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'lavorazio';
declare @sid varchar(100); set @sid = 'nidy5dn4fffiy4ltru5iuxbz';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id, file_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id, t2.file_id
   from (select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)) t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 17:22:52,211 [47] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 17:22:52,212 [47] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 17:22:52,214 [47] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 15 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 17:22:52,252 [47] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , (select top 1 1 from dn_search_tasks where search_id = 15 and file_id = f.file_id) as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 15 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 17:22:52,287 [47] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.task_id = t3.task_id 
          and not exists (select top 1 1 from dn_files_info where file_name = f2.file_name)) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join (select distinct search_id, task_id from dn_search_tasks) st on st.search_id = 15 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 17:23:05,538 [47] ERROR dn_lib.tools.log - error
System.NullReferenceException: Riferimento a un oggetto non impostato su un'istanza di oggetto.
   in deepanotes.notes.load_objects(Nullable`1 folder_id, Nullable`1 synch_folder_id, task_filter tf, Nullable`1 search_id) in c:\root\todd\git\dn\deepanotes\App_Code\notes.cs:riga 55
   in _notes.OnInit(EventArgs e) in c:\root\todd\git\dn\deepanotes\notes.aspx.cs:riga 272
2021-01-07 17:24:07,429 [21] INFO dn_lib.tools.log - reload core
2021-01-07 17:24:07,703 [21] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:24:07,705 [21] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:24:07,706 [21] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:24:07,707 [21] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:24:07,708 [21] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:24:07,709 [21] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:24:07,718 [21] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:24:07,720 [21] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:24:07,723 [21] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:24:07,724 [21] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:24:07,727 [21] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:24:07,728 [21] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:24:07,728 [21] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:24:07,730 [21] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:24:07,731 [21] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:24:07,732 [21] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:24:07,733 [21] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:24:07,733 [21] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:24:07,755 [21] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:24:07,757 [21] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:24:07,759 [21] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:24:07,760 [21] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:24:07,761 [21] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:24:07,762 [21] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:24:07,763 [21] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:24:07,765 [21] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:24:07,839 [47] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:24:07,840 [47] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:24:07,841 [47] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:24:07,841 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:24:07,842 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:24:07,842 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:24:07,843 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:24:07,844 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:24:07,845 [47] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:24:07,846 [47] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:24:07,847 [47] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:24:07,848 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:24:07,848 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:24:07,849 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:24:07,849 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:24:07,850 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:24:07,850 [47] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:24:07,851 [47] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:24:07,851 [47] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:24:07,852 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:24:07,853 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:24:07,853 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:24:07,854 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:24:07,855 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:24:07,855 [47] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:24:07,856 [47] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:24:07,949 [40] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:24:07,950 [40] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:24:07,950 [40] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:24:07,951 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:24:07,952 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:24:07,953 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:24:07,954 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:24:07,956 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:24:07,957 [40] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:24:07,958 [40] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:24:07,959 [40] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:24:07,959 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:24:07,960 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:24:07,960 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:24:07,961 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:24:07,961 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:24:07,962 [40] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:24:07,962 [40] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:24:07,963 [40] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:24:07,964 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:24:07,964 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:24:07,965 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:24:07,966 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:24:07,966 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:24:07,967 [40] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:24:07,972 [40] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:24:07,999 [40] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 17:24:08,005 [40] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 17:24:08,010 [40] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 17:24:08,097 [40] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 17:24:08,159 [40] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.task_id = t3.task_id 
          and not exists (select top 1 1 from dn_files_info where file_name = f2.file_name)) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 17:24:08,324 [40] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 17:24:08,587 [40] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 17:24:08,677 [40] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 17:24:08,678 [40] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 17:24:08,679 [40] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 17:24:19,304 [47] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:24:19,305 [47] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:24:19,306 [47] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:24:19,307 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:24:19,308 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:24:19,309 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:24:19,310 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:24:19,310 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:24:19,311 [47] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:24:19,312 [47] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:24:19,312 [47] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:24:19,313 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:24:19,314 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:24:19,315 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:24:19,315 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:24:19,316 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:24:19,317 [47] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:24:19,317 [47] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:24:19,319 [47] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:24:19,319 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:24:19,320 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:24:19,320 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:24:19,321 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:24:19,321 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:24:19,322 [47] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:24:19,323 [47] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:24:19,355 [40] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:24:19,356 [40] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:24:19,357 [40] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:24:19,357 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:24:19,358 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:24:19,358 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:24:19,359 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:24:19,359 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:24:19,360 [40] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:24:19,360 [40] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:24:19,361 [40] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:24:19,361 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:24:19,362 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:24:19,362 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:24:19,362 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:24:19,363 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:24:19,363 [40] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:24:19,364 [40] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:24:19,364 [40] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:24:19,365 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:24:19,365 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:24:19,366 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:24:19,366 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:24:19,367 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:24:19,367 [40] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:24:19,368 [40] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:24:19,403 [47] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:24:19,404 [47] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:24:19,404 [47] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:24:19,405 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:24:19,406 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:24:19,407 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:24:19,407 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:24:19,408 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:24:19,409 [47] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:24:19,409 [47] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:24:19,410 [47] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:24:19,410 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:24:19,411 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:24:19,411 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:24:19,412 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:24:19,412 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:24:19,413 [47] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:24:19,413 [47] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:24:19,414 [47] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:24:19,415 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:24:19,415 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:24:19,416 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:24:19,417 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:24:19,417 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:24:19,418 [47] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:24:19,419 [47] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:24:19,428 [47] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'lavorazio';
declare @sid varchar(100); set @sid = 'nidy5dn4fffiy4ltru5iuxbz';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id, file_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id, t2.file_id
   from (select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)) t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 17:24:19,429 [47] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 17:24:19,430 [47] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 17:24:19,431 [47] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 15 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 17:24:19,464 [47] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , (select top 1 1 from dn_search_tasks where search_id = 15 and file_id = f.file_id) as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 15 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 17:24:19,498 [47] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.task_id = t3.task_id 
          and not exists (select top 1 1 from dn_files_info where file_name = f2.file_name)) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join (select distinct search_id, task_id from dn_search_tasks) st on st.search_id = 15 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 17:24:31,817 [47] ERROR dn_lib.tools.log - error
System.NullReferenceException: Riferimento a un oggetto non impostato su un'istanza di oggetto.
   in deepanotes.notes.load_objects(Nullable`1 folder_id, Nullable`1 synch_folder_id, task_filter tf, Nullable`1 search_id) in c:\root\todd\git\dn\deepanotes\App_Code\notes.cs:riga 55
   in _notes.OnInit(EventArgs e) in c:\root\todd\git\dn\deepanotes\notes.aspx.cs:riga 272
2021-01-07 17:26:34,365 [60] INFO dn_lib.tools.log - reload core
2021-01-07 17:26:34,397 [60] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:26:34,400 [60] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:26:34,401 [60] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:26:34,402 [60] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:26:34,409 [60] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:26:34,410 [60] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:26:34,420 [60] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:26:34,422 [60] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:26:34,423 [60] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:26:34,424 [60] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:26:34,425 [60] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:26:34,426 [60] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:26:34,428 [60] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:26:34,429 [60] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:26:34,431 [60] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:26:34,432 [60] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:26:34,433 [60] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:26:34,434 [60] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:26:34,452 [60] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:26:34,455 [60] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:26:34,456 [60] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:26:34,457 [60] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:26:34,459 [60] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:26:34,460 [60] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:26:34,461 [60] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:26:34,465 [60] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:26:34,521 [47] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:26:34,522 [47] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:26:34,523 [47] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:26:34,524 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:26:34,524 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:26:34,525 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:26:34,526 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:26:34,526 [47] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:26:34,527 [47] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:26:34,527 [47] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:26:34,528 [47] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:26:34,528 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:26:34,528 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:26:34,529 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:26:34,530 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:26:34,531 [47] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:26:34,532 [47] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:26:34,533 [47] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:26:34,533 [47] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:26:34,534 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:26:34,534 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:26:34,534 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:26:34,535 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:26:34,535 [47] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:26:34,536 [47] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:26:34,536 [47] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:26:34,604 [37] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:26:34,605 [37] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:26:34,606 [37] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:26:34,606 [37] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:26:34,607 [37] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:26:34,608 [37] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:26:34,609 [37] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:26:34,610 [37] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:26:34,610 [37] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:26:34,611 [37] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:26:34,612 [37] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:26:34,612 [37] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:26:34,613 [37] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:26:34,614 [37] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:26:34,615 [37] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:26:34,616 [37] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:26:34,617 [37] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:26:34,617 [37] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:26:34,618 [37] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:26:34,619 [37] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:26:34,621 [37] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:26:34,621 [37] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:26:34,622 [37] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:26:34,623 [37] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:26:34,624 [37] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:26:34,627 [37] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:26:34,651 [37] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 17:26:34,655 [37] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 17:26:34,660 [37] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 17:26:34,740 [37] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 17:27:44,870 [37] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.task_id = t3.task_id 
          and not exists (select top 1 1 from dn_files_info where file_name = f2.file_name)) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 17:27:45,002 [37] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 17:27:45,258 [37] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 17:27:45,344 [37] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 17:27:45,346 [37] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 17:27:45,347 [37] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 17:27:53,846 [46] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:27:53,847 [46] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:27:53,848 [46] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:27:53,850 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:27:53,851 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:27:53,852 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:27:53,854 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:27:53,855 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:27:53,856 [46] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:27:53,857 [46] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:27:53,857 [46] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:27:53,858 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:27:53,859 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:27:53,860 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:27:53,861 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:27:53,861 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:27:53,862 [46] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:27:53,862 [46] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:27:53,863 [46] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:27:53,863 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:27:53,864 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:27:53,864 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:27:53,865 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:27:53,865 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:27:53,866 [46] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:27:53,867 [46] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:27:53,899 [37] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:27:53,900 [37] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:27:53,901 [37] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:27:53,902 [37] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:27:53,902 [37] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:27:53,902 [37] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:27:53,903 [37] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:27:53,904 [37] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:27:53,904 [37] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:27:53,905 [37] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:27:53,905 [37] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:27:53,905 [37] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:27:53,906 [37] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:27:53,906 [37] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:27:53,907 [37] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:27:53,907 [37] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:27:53,908 [37] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:27:53,908 [37] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:27:53,909 [37] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:27:53,909 [37] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:27:53,910 [37] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:27:53,910 [37] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:27:53,911 [37] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:27:53,911 [37] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:27:53,912 [37] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:27:53,912 [37] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:27:53,947 [46] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:27:53,948 [46] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:27:53,948 [46] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:27:53,949 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:27:53,950 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:27:53,950 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:27:53,951 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:27:53,952 [46] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:27:53,952 [46] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:27:53,953 [46] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:27:53,953 [46] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:27:53,953 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:27:53,954 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:27:53,954 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:27:53,955 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:27:53,955 [46] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:27:53,956 [46] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:27:53,956 [46] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:27:53,956 [46] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:27:53,957 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:27:53,957 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:27:53,958 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:27:53,958 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:27:53,959 [46] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:27:53,959 [46] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:27:53,960 [46] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:27:53,968 [46] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'lavorazio';
declare @sid varchar(100); set @sid = 'nidy5dn4fffiy4ltru5iuxbz';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id, file_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id, t2.file_id
   from (select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)) t2

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 17:27:53,970 [46] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 17:27:53,971 [46] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 17:27:53,972 [46] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 15 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 17:27:54,008 [46] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , (select top 1 1 from dn_search_tasks where search_id = 15 and file_id = f.file_id) as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 15 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 17:27:54,043 [46] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.task_id = t3.task_id 
          and not exists (select top 1 1 from dn_files_info where file_name = f2.file_name)) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join (select distinct search_id, task_id from dn_search_tasks) st on st.search_id = 15 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 17:32:31,931 [46] ERROR dn_lib.tools.log - error
System.NullReferenceException: Riferimento a un oggetto non impostato su un'istanza di oggetto.
   in deepanotes.notes.load_objects(Nullable`1 folder_id, Nullable`1 synch_folder_id, task_filter tf, Nullable`1 search_id) in c:\root\todd\git\dn\deepanotes\App_Code\notes.cs:riga 55
   in _notes.OnInit(EventArgs e) in c:\root\todd\git\dn\deepanotes\notes.aspx.cs:riga 272
2021-01-07 17:40:19,046 [17] INFO dn_lib.tools.log - reload core
2021-01-07 17:40:19,082 [17] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:40:19,084 [17] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:19,085 [17] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:19,086 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:19,088 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:19,090 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:19,100 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:19,102 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:19,103 [17] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:19,104 [17] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:19,106 [17] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:19,107 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:19,108 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:19,110 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:19,110 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:19,111 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:19,113 [17] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:19,114 [17] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:19,120 [17] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:19,123 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:19,124 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:19,125 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:19,126 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:19,127 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:19,128 [17] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:19,129 [17] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:40:19,161 [51] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:40:19,163 [51] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:19,164 [51] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:19,165 [51] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:19,166 [51] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:19,167 [51] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:19,168 [51] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:19,168 [51] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:19,169 [51] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:19,170 [51] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:19,171 [51] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:19,171 [51] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:19,172 [51] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:19,173 [51] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:19,173 [51] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:19,174 [51] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:19,174 [51] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:19,175 [51] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:19,175 [51] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:19,176 [51] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:19,177 [51] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:19,177 [51] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:19,178 [51] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:19,179 [51] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:19,180 [51] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:19,181 [51] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:40:19,216 [64] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:40:19,217 [64] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:19,218 [64] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:19,219 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:19,219 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:19,221 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:19,222 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:19,223 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:19,224 [64] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:19,224 [64] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:19,225 [64] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:19,226 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:19,227 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:19,227 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:19,228 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:19,230 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:19,230 [64] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:19,231 [64] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:19,232 [64] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:19,233 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:19,233 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:19,234 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:19,235 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:19,236 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:19,236 [64] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:19,248 [64] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:40:19,273 [64] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 17:40:19,277 [64] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 17:40:19,285 [64] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 17:40:19,348 [64] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 17:40:19,393 [64] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.task_id = t3.task_id 
          and not exists (select top 1 1 from dn_files_info where file_name = f2.file_name)) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 17:40:19,534 [64] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 17:40:19,759 [64] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 17:40:19,845 [64] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 17:40:19,847 [64] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 17:40:19,848 [64] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 17:40:25,099 [61] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:40:25,100 [61] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:25,101 [61] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:25,102 [61] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:25,103 [61] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:25,104 [61] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:25,105 [61] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:25,106 [61] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:25,107 [61] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:25,108 [61] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:25,109 [61] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:25,109 [61] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:25,110 [61] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:25,111 [61] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:25,111 [61] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:25,112 [61] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:25,112 [61] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:25,113 [61] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:25,113 [61] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:25,114 [61] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:25,114 [61] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:25,115 [61] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:25,116 [61] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:25,117 [61] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:25,117 [61] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:25,118 [61] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:40:25,141 [29] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:40:25,142 [29] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:25,143 [29] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:25,144 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:25,144 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:25,145 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:25,146 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:25,146 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:25,147 [29] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:25,148 [29] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:25,148 [29] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:25,149 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:25,149 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:25,150 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:25,150 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:25,151 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:25,151 [29] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:25,152 [29] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:25,152 [29] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:25,153 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:25,153 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:25,154 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:25,154 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:25,154 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:25,155 [29] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:25,155 [29] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:40:25,165 [17] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:40:25,166 [17] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:25,167 [17] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:25,168 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:25,168 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:25,169 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:25,169 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:25,170 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:25,171 [17] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:25,171 [17] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:25,172 [17] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:25,172 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:25,172 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:25,173 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:25,173 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:25,174 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:25,174 [17] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:25,175 [17] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:25,175 [17] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:25,176 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:25,176 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:25,177 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:25,178 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:25,179 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:25,180 [17] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:25,181 [17] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:40:25,189 [17] DEBUG dn_lib.tools.log - SQL: declare @txt varchar(max); set @txt = 'lavorazio';
declare @sid varchar(100); set @sid = 'um5nzqk5hqmf0xiydamdu5lb';
declare @id int; 

select @id = search_id from dn_search_text where session_id = @sid and search_text = @txt;

if @id is null 
begin

 if not exists (select top 1 1 from dn_search_text where session_id = @sid)
 begin
  insert into dn_search_text (session_id, search_text)
   values (@sid, @txt);
   select @id = @@IDENTITY;  
 end
 else
 begin
  select @id = search_id from dn_search_text where session_id = @sid;
  update dn_search_text set search_text = @txt, dt_ins = getdate() where search_id = @id;
  delete from dn_search_tasks where search_id = @id; 
  delete from dn_search_folders where search_id = @id;
 end

 insert into dn_search_tasks (search_id, synch_folder_id, task_id, folder_id, file_id)
  select distinct @id as search_id, t2.synch_folder_id, t2.task_id, t2.folder_id, t2.file_id
   from (select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks t where t.title like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, null as file_id 
	 from dn_tasks_notes n
	 join dn_tasks t on t.task_id = n.task_id
	 where n.content like '%' + @txt + '%'
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id 
	 from dn_files f
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where f.file_name like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)
	union select t.task_id, t.synch_folder_id, t.folder_id, f.file_id
	 from dn_files_contents fc 
	 join dn_files f on f.file_id = fc.file_id
	 join dn_tasks t on t.folder_id = f.folder_id or t.file_id = f.file_id
	 where fc.content like '%' + @txt + '%'
    and not exists (select top 1 1 from dn_tasks_notes where file_id = f.file_id)) t2
    
 update st set st.folder_id = f.folder_id
  from dn_search_tasks st
  join dn_tasks t on t.task_id = st.task_id
  join dn_files f on f.file_id = t.file_id
  where st.search_id = @id and t.file_id is not null 

 insert into dn_search_folders (search_id, synch_folder_id, folder_id)
  select @id as search_id, sf.synch_folder_id, null as folder_id
   from synch_folders sf
   join (select distinct synch_folder_id from dn_search_tasks) t on t.synch_folder_id = sf.synch_folder_id
  union select @id as search_id, fp.synch_folder_id, fp.folder_id
   from (select distinct folder_id from dn_search_tasks) t
  cross apply [dbo].[folder_parents](t.folder_id) fp; 

 delete t from dn_search_tasks t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete t from dn_search_folders t
  join dn_search_text s on t.search_id = s.search_id and datediff(hour, s.dt_ins, getdate()) > 5;
 
 delete from dn_search_text where datediff(hour, dt_ins, getdate()) > 5;

end

select @id as search_id, count(*) as cc from dn_search_tasks where search_id = @id;


2021-01-07 17:40:25,640 [17] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 17:40:25,642 [17] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 17:40:25,643 [17] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      join dn_search_folders sf on sf.search_id = 16 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 17:40:25,689 [17] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , (select top 1 1 from dn_search_tasks where search_id = 16 and file_id = f.file_id) as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        join dn_search_folders sf on sf.search_id = 16 
          and sf.synch_folder_id = ft.synch_folder_id and isnull(sf.folder_id, 0) = isnull(ft.folder_id, 0)
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 17:40:25,741 [17] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.task_id = t3.task_id 
          and not exists (select top 1 1 from dn_files_info where file_name = f2.file_name)) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    join (select distinct search_id, task_id from dn_search_tasks) st on st.search_id = 16 and st.task_id = t.task_id
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 17:40:25,791 [17] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 17:40:25,808 [17] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 17:40:25,810 [17] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 17:40:25,811 [17] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 17:40:25,813 [17] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
2021-01-07 17:40:31,418 [40] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:40:31,419 [40] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:31,420 [40] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:31,421 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:31,421 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:31,422 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:31,423 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:31,424 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:31,425 [40] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:31,425 [40] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:31,426 [40] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:31,426 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:31,427 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:31,428 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:31,428 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:31,429 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:31,429 [40] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:31,430 [40] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:31,430 [40] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:31,431 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:31,431 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:31,432 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:31,432 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:31,433 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:31,434 [40] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:31,434 [40] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:40:31,476 [40] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 357
2021-01-07 17:40:31,478 [40] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path , (select top 1 1 from dn_search_tasks where search_id = 16 and file_id = a.file_id) as found_file       
       , (select top 1 1 from dn_tasks where task_id = a.task_id and file_id = a.file_id) as file_task
      from vw_task_allegati a
      where a.task_id = 357
2021-01-07 17:40:52,589 [17] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:40:52,590 [17] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:52,591 [17] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:52,592 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:52,593 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:52,593 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:52,594 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:52,595 [17] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:52,596 [17] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:52,596 [17] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:52,597 [17] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:52,597 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:52,598 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:52,598 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:52,599 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:52,599 [17] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:52,600 [17] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:52,600 [17] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:52,601 [17] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:52,601 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:52,602 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:52,602 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:52,603 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:52,603 [17] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:52,604 [17] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:52,604 [17] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:40:52,613 [17] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 482
2021-01-07 17:40:52,614 [17] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path , (select top 1 1 from dn_search_tasks where search_id = 16 and file_id = a.file_id) as found_file       
       , (select top 1 1 from dn_tasks where task_id = a.task_id and file_id = a.file_id) as file_task
      from vw_task_allegati a
      where a.task_id = 482
2021-01-07 17:40:58,302 [40] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:40:58,303 [40] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:58,304 [40] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:58,305 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:58,306 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:58,307 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:58,308 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:58,309 [40] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:58,310 [40] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:58,311 [40] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:58,312 [40] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:58,312 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:58,312 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:58,313 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:58,314 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:58,314 [40] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:58,315 [40] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:58,315 [40] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:40:58,316 [40] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:40:58,316 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:40:58,317 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:40:58,317 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:40:58,318 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:40:58,318 [40] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:40:58,319 [40] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:40:58,319 [40] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:40:58,328 [40] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 350
2021-01-07 17:40:58,329 [40] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path , (select top 1 1 from dn_search_tasks where search_id = 16 and file_id = a.file_id) as found_file       
       , (select top 1 1 from dn_tasks where task_id = a.task_id and file_id = a.file_id) as file_task
      from vw_task_allegati a
      where a.task_id = 350
2021-01-07 17:41:02,227 [64] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:41:02,228 [64] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:41:02,230 [64] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:41:02,231 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:41:02,232 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:41:02,233 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:41:02,234 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:41:02,234 [64] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:41:02,235 [64] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:41:02,236 [64] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:41:02,236 [64] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:41:02,237 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:41:02,237 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:41:02,238 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:41:02,238 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:41:02,239 [64] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:41:02,239 [64] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:41:02,240 [64] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:41:02,240 [64] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:41:02,241 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:41:02,241 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:41:02,242 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:41:02,242 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:41:02,243 [64] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:41:02,243 [64] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:41:02,244 [64] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:41:02,252 [64] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 317
2021-01-07 17:41:02,254 [64] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path , (select top 1 1 from dn_search_tasks where search_id = 16 and file_id = a.file_id) as found_file       
       , (select top 1 1 from dn_tasks where task_id = a.task_id and file_id = a.file_id) as file_task
      from vw_task_allegati a
      where a.task_id = 317
2021-01-07 17:41:15,802 [29] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:41:15,804 [29] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:41:15,805 [29] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:41:15,806 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:41:15,807 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:41:15,809 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:41:15,809 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:41:15,810 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:41:15,810 [29] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:41:15,811 [29] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:41:15,811 [29] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:41:15,812 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:41:15,813 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:41:15,813 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:41:15,814 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:41:15,814 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:41:15,814 [29] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:41:15,815 [29] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:41:15,815 [29] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:41:15,816 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:41:15,816 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:41:15,817 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:41:15,817 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:41:15,818 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:41:15,818 [29] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:41:15,819 [29] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:41:15,828 [29] DEBUG dn_lib.tools.log - SQL: select content from dn_tasks_notes 
       where task_id = 335
2021-01-07 17:41:15,829 [29] DEBUG dn_lib.tools.log - SQL: select a.file_id, a.file_name, a.extension, a.http_path , (select top 1 1 from dn_search_tasks where search_id = 16 and file_id = a.file_id) as found_file       
       , (select top 1 1 from dn_tasks where task_id = a.task_id and file_id = a.file_id) as file_task
      from vw_task_allegati a
      where a.task_id = 335
2021-01-07 17:41:27,183 [29] INFO dn_lib.tools.log - reload config docs
2021-01-07 17:41:27,184 [29] INFO dn_lib.tools.log - load xml config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:41:27,185 [29] INFO dn_lib.tools.log - load xml config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:41:27,186 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:41:27,187 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:41:27,188 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:41:27,189 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:41:27,191 [29] INFO dn_lib.tools.log - load xml config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:41:27,191 [29] INFO dn_lib.tools.log - load xml config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:41:27,192 [29] INFO dn_lib.tools.log - load vars doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:41:27,192 [29] INFO dn_lib.tools.log - load vars doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:41:27,193 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:41:27,194 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:41:27,194 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:41:27,195 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:41:27,195 [29] INFO dn_lib.tools.log - load vars doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:41:27,196 [29] INFO dn_lib.tools.log - load vars doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:41:27,196 [29] INFO dn_lib.tools.log - load config doc: \defs\blocks.xml - C:\root\todd\git\dn\deepanotes\defs\blocks.xml
2021-01-07 17:41:27,197 [29] INFO dn_lib.tools.log - load config doc: \defs\cmds.xml - C:\root\todd\git\dn\deepanotes\defs\cmds.xml
2021-01-07 17:41:27,197 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-base.xml - C:\root\todd\git\dn\deepanotes\defs\lib-base.xml
2021-01-07 17:41:27,198 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-conns.xml - C:\root\todd\git\dn\deepanotes\defs\lib-conns.xml
2021-01-07 17:41:27,198 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-notes.xml - C:\root\todd\git\dn\deepanotes\defs\lib-notes.xml
2021-01-07 17:41:27,199 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-synch.xml - C:\root\todd\git\dn\deepanotes\defs\lib-synch.xml
2021-01-07 17:41:27,200 [29] INFO dn_lib.tools.log - load config doc: \defs\lib-vars.xml - C:\root\todd\git\dn\deepanotes\defs\lib-vars.xml
2021-01-07 17:41:27,201 [29] INFO dn_lib.tools.log - load config doc: \defs\users.xml - C:\root\todd\git\dn\deepanotes\defs\users.xml
2021-01-07 17:41:27,202 [29] DEBUG dn_lib.tools.log - SQL: open conn 'Data Source=localhost;Initial Catalog=deepanotes;User ID=sa;Password=Molina32!'
2021-01-07 17:41:27,211 [29] DEBUG dn_lib.tools.log - SQL: select task_filter_id, filter_title, filter_notes, filter_def, filter_class
 from dn_tasks_filters order by filter_order
2021-01-07 17:41:27,213 [29] DEBUG dn_lib.tools.log - SQL: select var_name, var_value 
          from users_cache where [user_id] = 0 and var_name in ('active-task-filter')
2021-01-07 17:41:27,213 [29] DEBUG dn_lib.tools.log - SQL: select ft.tp, ft.synch_folder_id, ft.folder_id, ft.parent_id, ft.title
       , ft.des, ft.http_path, ft.lvl, dbo.folder_path(ft.folder_id) as folder_path
       , (select top 1 1 from dn_tasks where folder_id = ft.folder_id) as is_task
      from dbo.fnc_dn_folders(null, null) ft
      
      order by ft.synch_folder_id, ft.lvl, ft.title
2021-01-07 17:41:27,276 [29] DEBUG dn_lib.tools.log - SQL: select f.synch_folder_id, f.file_id, f.folder_id, f.file_name, f.dt_ins , null as found_file
       from dn_files f
       where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
        
	      where ft.synch_folder_id = f.synch_folder_id 
          and isnull(ft.folder_id, 0) = isnull(f.folder_id, 0))
2021-01-07 17:41:27,320 [29] DEBUG dn_lib.tools.log - SQL: select t3.*
      , tst.stato, tst.[order] as stato_order, isnull(tst.class, 'light') as stato_class, isnull(tst.title_plurale, '') as stato_title_plurale, isnull(tst.title_singolare, '') as stato_title_singolare
      , tp.priorita, tp.[order] as priorita_order, isnull(tp.class, 'light') as priorita_class, isnull(tp.title_plurale, '') as priorita_title_plurale, isnull(tp.title_singolare, '') as priorita_title_singolare
      , tt.tipo, tt.[order] as tipo_order, isnull(tt.class, 'light') as tipo_class, isnull(tt.title_plurale, '') as tipo_title_plurale, isnull(tt.title_singolare, '') as tipo_title_singolare
      , ts.stima, ts.[days] as stima_days, isnull(ts.class, 'light') as stima_class, isnull(ts.title_plurale, '') as stima_title_plurale, isnull(ts.title_singolare, '') as stima_title_singolare
      , (select top 1 1 from dn_tasks_notes where task_id = t3.task_id) as task_notes
      , (select top 1 1 from vw_task_allegati f2 where f2.task_id = t3.task_id 
          and not exists (select top 1 1 from dn_files_info where file_name = f2.file_name)) as task_files
  from (select t2.*, datediff(day, t2.dt_ref, getdate()) as diff_days
    from (select t.task_id, t.synch_folder_id, isnull(t.folder_id, f.folder_id) as folder_id
	   , t.file_id, t.title, t.[user], t.stato, t.priorita, t.tipo, t.stima, t.dt_ins, t.dt_upd
     , (case when t.dt_ins > t.dt_upd then t.dt_ins else t.dt_upd end) as dt_ref
	  from dn_tasks t
    
	  left join dn_files f on f.file_id = t.file_id
    where (null is null or (null is not null and t.task_id = null)) ) t2
    where exists (select top 1 1 from dbo.fnc_dn_folders(null, null) ft 
	    where  ft.synch_folder_id = t2.synch_folder_id 
       and isnull(ft.folder_id, 0) = isnull(t2.folder_id, 0))) t3
   left join dn_task_stato tst on tst.stato = t3.stato
   left join dn_task_priorita tp on tp.priorita = t3.priorita
   left join dn_task_tipo tt on tt.tipo = t3.tipo
   left join dn_task_stima ts on ts.stima = t3.stima
   where 1 = 1 
2021-01-07 17:41:27,437 [29] DEBUG dn_lib.tools.log - SQL: select title_singolare, stato from dn_task_stato order by [order]
2021-01-07 17:41:27,673 [29] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, priorita as [value], [order] from dn_task_priorita
      ) t order by t.[order]
2021-01-07 17:41:27,675 [29] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [days]
       union select title_singolare as title, stima as [value], [days] from dn_task_stima 
       ) t order by t.[days]
2021-01-07 17:41:27,676 [29] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value], -1 as [order]
       union select title_singolare as title, tipo as [value], [order] from dn_task_tipo
       ) t order by t.[order]
2021-01-07 17:41:27,677 [29] DEBUG dn_lib.tools.log - SQL: select t.title, t.[value]
      from (select '' as title, '' as [value]
       union select nome as title, nome as [value] from users
       ) t order by 2
